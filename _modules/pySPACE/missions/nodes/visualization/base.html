<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pySPACE.missions.nodes.visualization.base &mdash; pySPACE documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/pySPACE.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '1.3 release',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../../../_static/pyspace-logo.ico"/>
    <link rel="top" title="pySPACE documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">pySPACE documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../../index.html">
              <img class="logo" src="../../../../../_static/pyspace-logo_small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pySPACE.missions.nodes.visualization.base</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; Base class for visualization nodes</span>

<span class="sd">**Classes**</span>
<span class="sd"> </span>
<span class="sd"> :VisualizationBase: </span>
<span class="sd">     This node can be used as a base to visualize instances of the data as</span>
<span class="sd">     time series. To use the functionality of this node in a child node</span>
<span class="sd">     you just have to create one function, which is _plotValues:</span>
<span class="sd">     </span>
<span class="sd">     **Parameters of `_plotValues`**</span>

<span class="sd">         :values:     dict  TimeSeries values, e.g.::</span>

<span class="sd">                           {&#39;Standard&#39;: TimeSeries(...),&#39;Target&#39;  : TimeSeries(...)}</span>

<span class="sd">         :plot_label: str   Plot-Label</span>
<span class="sd">         :fig_num:    int   Figure-number for ?</span>
<span class="sd">         :store_dir:  str   Directory to store the plots</span>
<span class="sd">         :counter:    int   Plot counter for all trials</span>
<span class="sd">    </span>
<span class="sd">    Inside this function you can perform any plot you want.</span>
<span class="sd">     </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pylab</span>
    <span class="n">pylab_import_error</span><span class="o">=</span><span class="bp">False</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">pylab_import_error</span><span class="o">=</span><span class="bp">True</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">pySPACE.missions.nodes.base_node</span> <span class="kn">import</span> <span class="n">BaseNode</span>
<span class="kn">from</span> <span class="nn">pySPACE.tools.filesystem</span> <span class="kn">import</span> <span class="n">create_directory</span>

<span class="kn">from</span> <span class="nn">pySPACE.missions.nodes.type_manipulation</span> <span class="kn">import</span> <span class="n">type_conversion</span>
<span class="kn">from</span> <span class="nn">pySPACE.resources.data_types.prediction_vector</span> <span class="kn">import</span> <span class="n">PredictionVector</span>
<span class="kn">from</span> <span class="nn">pySPACE.resources.data_types.feature_vector</span> <span class="kn">import</span> <span class="n">FeatureVector</span>
<span class="kn">from</span> <span class="nn">pySPACE.resources.data_types.time_series</span> <span class="kn">import</span> <span class="n">TimeSeries</span>


<div class="viewcode-block" id="VisualizationBase"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase">[docs]</a><span class="k">class</span> <span class="nc">VisualizationBase</span><span class="p">(</span><span class="n">BaseNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Base node for visualization</span>
<span class="sd">    </span>
<span class="sd">    If you want to use the functionality you can inherit from it, like, e.g.,</span>
<span class="sd">    ElectrodeCoordinationPlotNode does. See the module documentation for details.</span>
<span class="sd">    </span>
<span class="sd">    This base class provides the following functionality:</span>

<span class="sd">        - you can insert this node at any place in your node chain</span>
<span class="sd">        - you can optionally plot single trials and/or averages (the latter also accumulating over time)</span>
<span class="sd">        - you can either plot in online or in offline mode (see below)</span>
<span class="sd">        - data is sorted according to labels</span>
<span class="sd">        - optionally training and test data are distinguished</span>
<span class="sd">        - feature vectors are automatically transferred to time series</span>
<span class="sd">        - prediction vectors are evaluated according to the transformation they were generated from</span>
<span class="sd">        - optionally you can add backward computing of previous transformations (e.g. spatial filters) to get better visualizations</span>
<span class="sd">        - electrodes come with defined positions</span>
<span class="sd">        - history values can be taken into account for plot</span>
<span class="sd">       </span>
<span class="sd">    The node has a number of parameters to define what should be plotted, e.g.</span>
<span class="sd">    whether to plot single trials, accumulated average and/or average, or </span>
<span class="sd">    to plot training vs test data, or to constrain to a certain label.</span>
<span class="sd">    </span>
<span class="sd">    Basically, there are two modes of plotting and storing the data: the</span>
<span class="sd">    offline mode (default) and the online mode. In the offline mode, the</span>
<span class="sd">    plotting is performed at the end and the plots are saved into the result_dir,</span>
<span class="sd">    specified for the store method in pySPACE. In the online mode, the plotting is</span>
<span class="sd">    performed as soon as the information is available and the user can specify</span>
<span class="sd">    the directory to store the data with the parameter user_dir.</span>
<span class="sd">          </span>
<span class="sd">    .. note::</span>
<span class="sd">      - Currently the data labels which are also given in the figure&#39;s title</span>
<span class="sd">        are based on the tag from the data.</span>
<span class="sd">      - If you use a splitter node previous to this node,</span>
<span class="sd">        the information of the different splits is also handled separately.</span>
<span class="sd">      - This node is not changing the data as such!</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        Be careful when configuring matplotlib!</span>
<span class="sd">        Interactive matplotlib-backends are not compatible between offline and online, </span>
<span class="sd">        when using live environment.</span>
<span class="sd">        Without the live environment, successful matplotlib backends</span>
<span class="sd">        used on a Mac were *Agg* (not interactive) and *MacOSX*. When using the live</span>
<span class="sd">        package, a working interactive matplotlib backend should be *GTKAgg*.</span>
<span class="sd">        You can change the matplotlib backend</span>
<span class="sd">        by modifying the *matplotlibrc* file in *.matplotlib* in</span>
<span class="sd">        your home directory, e.g. *backend : GTKAgg*.</span>
<span class="sd">    </span>
<span class="sd">   **Parameters**</span>
<span class="sd">   </span>
<span class="sd">    :General parameters:</span>
<span class="sd">    </span>
<span class="sd">        :rand_initial_fig:</span>
<span class="sd">            This option is useful when using the visualisation node multiple</span>
<span class="sd">            times within a node chain and getting the plots directly</span>
<span class="sd">            printed on-screen. The initial figure number is randomized between</span>
<span class="sd">            1 and 10000, so each visualisation node most likely plots into</span>
<span class="sd">            different figure windows.</span>
<span class="sd">            </span>
<span class="sd">            (*optional, default: True*)</span>
<span class="sd">    </span>
<span class="sd">        :online:</span>
<span class="sd">            The computation is performed in &quot;online&quot; mode, i.e. the plots are</span>
<span class="sd">            generated in the execution period of the node. If you additionally </span>
<span class="sd">            store the data, the user_dir is used (see below).</span>
<span class="sd">            On the other hand, if the &quot;offline&quot; mode is used the plots are</span>
<span class="sd">            generated after all computations have been performed and the default</span>
<span class="sd">            way of saving the data is used.</span>
<span class="sd">        </span>
<span class="sd">            (*optional, default: False*)</span>
<span class="sd">        </span>
<span class="sd">    :Limit the amount of data:</span>
<span class="sd">    </span>
<span class="sd">        :limit2class:</span>
<span class="sd">            List of strings. Only the data belonging to class labels in the</span>
<span class="sd">            list are plotted.</span>
<span class="sd">        </span>
<span class="sd">            .. note:: If there is no match, no plot will be generated!</span>
<span class="sd">    </span>
<span class="sd">            (*optional, default: None*)</span>
<span class="sd">    </span>
<span class="sd">        :request_training:</span>
<span class="sd">            Has to be True if you want to plot data belonging to the training</span>
<span class="sd">            set. If you are only interested in test data, you can set this</span>
<span class="sd">            parameter to False.</span>
<span class="sd">        </span>
<span class="sd">            (*optional, default: True*)</span>
<span class="sd">    </span>
<span class="sd">        :request_test:</span>
<span class="sd">            Has to be True if you want to plot data belonging to the test set.</span>
<span class="sd">            </span>
<span class="sd">            (*optional, default: True*)</span>
<span class="sd">    </span>
<span class="sd">        :time_stamps:</span>
<span class="sd">            Specify which points in time should be included in visualization.</span>
<span class="sd">            With the default option, all available time stamps are displayed.</span>
<span class="sd">            The time_stamps are computed with respect to the timeshift option</span>
<span class="sd">            (see below), i.e. in a data window of 600 ms length, with</span>
<span class="sd">            timeshift = -200 and time_stamps = [200], the data at 400 ms in the</span>
<span class="sd">            original window is displayed.</span>
<span class="sd">        </span>
<span class="sd">            (*optional, default: [-1]*)</span>
<span class="sd">            </span>
<span class="sd">    :Influence the way how the data is plotted:</span>
<span class="sd">    </span>
<span class="sd">        :averaging:</span>
<span class="sd">            If this is true, all samples are averaged and the plot is created</span>
<span class="sd">            using this average. The average is performed with respect to the</span>
<span class="sd">            class labels.</span>
<span class="sd">        </span>
<span class="sd">            (*optional, default: True*)</span>
<span class="sd">        </span>
<span class="sd">        :accum_avg:</span>
<span class="sd">            If this is true, you will see the average accumulating with trials</span>
<span class="sd">            in a separate window. Again, this average is computed for each class</span>
<span class="sd">            separately.</span>
<span class="sd">        </span>
<span class="sd">            (*optional, default: False*)</span>
<span class="sd">        </span>
<span class="sd">        :single_trial:</span>
<span class="sd">            If this is true, single trials are plotted.</span>
<span class="sd">        </span>
<span class="sd">            (*optional, default: False*)</span>
<span class="sd">        </span>
<span class="sd">        :separate_training_and_test:</span>
<span class="sd">            When this option is True, training and test data are separately</span>
<span class="sd">            treated as if they belong to different classes. Therefore, if</span>
<span class="sd">            you have two original classes and set this option to True, </span>
<span class="sd">            your plot will consist of four subplots. </span>
<span class="sd">        </span>
<span class="sd">            .. note:: Setting this option</span>
<span class="sd">                to True will force request_training and request_test to True.</span>
<span class="sd">        </span>
<span class="sd">            (*optional, default: False*)</span>
<span class="sd">        </span>
<span class="sd">        :timeshift:</span>
<span class="sd">            This parameter shifts the labels of the time axis. If, e.g.,</span>
<span class="sd">            timeshift = -1000, the axis would show [-1000, 1000] instead of</span>
<span class="sd">            [0, 2000].</span>
<span class="sd">            Adjust this according to how the windowing was performed - usually</span>
<span class="sd">            one would want to have the marker at time 0.</span>
<span class="sd">    </span>
<span class="sd">            (*optional, default: 0*)</span>
<span class="sd">        </span>
<span class="sd">        :physiological_arrangement:</span>
<span class="sd">            This parameter</span>
<span class="sd">            controls whether the plots are arranged according to physiological</span>
<span class="sd">            positions. Otherwise this parameter has no effect.</span>
<span class="sd">            </span>
<span class="sd">            (*optional, default: True*)</span>
<span class="sd">        </span>
<span class="sd">        :history_index:</span>
<span class="sd">            This parameter only has effects if the node is used with a</span>
<span class="sd">            prediction vector (i.e. after a classification). Then the predictor</span>
<span class="sd">            property of the prediction vector is always scanned for a</span>
<span class="sd">            FeatureVector for plotting (if it is not found, then the history is</span>
<span class="sd">            scanned for another prediction vector). The parameter history_index</span>
<span class="sd">            now introduces a further switch:</span>
<span class="sd">            When set (between 1 and infinity), it specifies the depth in the</span>
<span class="sd">            history where the history is additionally used for the plot output</span>
<span class="sd">            (i.e. the corresponding node used keep_in_history=True). When the</span>
<span class="sd">            history is not used for something else, this depth is usually 1. The</span>
<span class="sd">            values usually correspond to the original feature values and are of</span>
<span class="sd">            type TimeSeries or FeatureVector. Then, the product of feature value</span>
<span class="sd">            and weight (i.e. the feature vector from the predictor) is computed</span>
<span class="sd">            for each data point. The result is finally plotted </span>
<span class="sd">            as topography.</span>
<span class="sd">            </span>
<span class="sd">            (*optional, default: None*)</span>
<span class="sd">            </span>
<span class="sd">        :use_SF:</span>
<span class="sd">            When the node gets a FeatureVector or PredictionVector this option</span>
<span class="sd">            controls whether the transformation of a preceding spatial filter</span>
<span class="sd">            (SF) is taken into account. If True, all *artificial* channels of</span>
<span class="sd">            the filter are transformed back to their original electrode</span>
<span class="sd">            counterparts. For full flexibility in what should be plotted, this</span>
<span class="sd">            option can be combined with *history_index*, *use_FN*, *SF_channels*</span>
<span class="sd">            and *use_transformation*.</span>
<span class="sd">            </span>
<span class="sd">            (*optional, default: True*)</span>
<span class="sd">        </span>
<span class="sd">        :use_FN:</span>
<span class="sd">            documentation in progress</span>
<span class="sd">            </span>
<span class="sd">            (*optional, default: True*)</span>
<span class="sd">        </span>
<span class="sd">        :SF_channels:</span>
<span class="sd">            documentation in progress</span>
<span class="sd">            </span>
<span class="sd">            (*optional, default: All*)</span>

<span class="sd">        :use_transformation:</span>
<span class="sd">            documentation in progress</span>
<span class="sd">            </span>
<span class="sd">            (*optional, default: False*)</span>
<span class="sd">        </span>
<span class="sd">    :Saving Options:</span>
<span class="sd">    </span>
<span class="sd">        :store:</span>
<span class="sd">            If this is true, the graphics are stored</span>
<span class="sd">            to the persistency directory at the end of the run.</span>
<span class="sd">        </span>
<span class="sd">            (*optional, default: False*)</span>
<span class="sd">        </span>
<span class="sd">        :user_dir:</span>
<span class="sd">            This option is only active, if plotting is in online mode</span>
<span class="sd">            (online=True) and store=True. Then the user can specify where the</span>
<span class="sd">            data should be stored.</span>
<span class="sd">            </span>
<span class="sd">            (*optional, default: &#39;./&#39;*)</span>
<span class="sd">                    </span>
<span class="sd">        :create_movie:</span>
<span class="sd">            If this is True, a video of the average signals is created. Does</span>
<span class="sd">            require the ffmpeg library. The video is created from plots in the</span>
<span class="sd">            store_dir.</span>
<span class="sd">            </span>
<span class="sd">            .. note:: Enforces store=True.</span>
<span class="sd">    </span>
<span class="sd">            (*optional, default: False*)</span>
<span class="sd">    </span>
<span class="sd">        :store_data:</span>
<span class="sd">            With this additional option, you can store the data that has been</span>
<span class="sd">            used for plotting. The folder will be the same where the pictures</span>
<span class="sd">            are in. This option has no effect, if :store: is set to False.</span>
<span class="sd">        </span>
<span class="sd">            (*optional, default: False*)</span>
<span class="sd">                              </span>
<span class="sd">    :Author: Sirko Straube (sirko.straube@dfki.de)</span>
<span class="sd">    :Date of Last Revision: 2013/01/01</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="VisualizationBase.__init__"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">request_training</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">request_test</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">separate_training_and_test</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">averaging</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">accum_avg</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">single_trial</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">time_stamps</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">store</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">store_data</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">create_movie</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">timeshift</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">online</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">user_dir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
                 <span class="n">limit2class</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">physiological_arrangement</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">history_index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">use_FN</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">use_SF</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">SF_channels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">use_transformation</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">rand_initial_fig</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">covariancing</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Used to initialize the environment.</span>
<span class="sd">           Called by VisualizationBase child-node.</span>
<span class="sd">           </span>
<span class="sd">           Parameters:    See description above.</span>
<span class="sd">           Returns:       Nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#should training and test data be handled separately</span>
        <span class="k">if</span> <span class="n">separate_training_and_test</span><span class="p">:</span>
            <span class="c1">#if yes: all data has to be requested</span>
            <span class="n">request_training</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">request_test</span> <span class="o">=</span> <span class="bp">True</span>
            
        <span class="c1">#modify request_training accordingly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_training</span> <span class="o">=</span> <span class="n">request_training</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">VisualizationBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">rand_initial_fig</span><span class="p">:</span>
            <span class="n">initial_fig_num</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_fig_num</span><span class="o">=</span><span class="mi">0</span>

        <span class="k">if</span> <span class="n">create_movie</span><span class="p">:</span>
            <span class="c1">#store the graphics to the persistency directory used in store_state</span>
            <span class="n">store</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">store</span><span class="p">:</span>
            <span class="n">store_data</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1">#if plots are stored in online mode a directory is either specified or</span>
        <span class="c1">#data is stored in execution path</span>
        <span class="k">if</span> <span class="n">online</span> <span class="ow">and</span> <span class="n">store</span><span class="p">:</span>
            <span class="c1">#is user_dir not set explicitly? </span>
            <span class="k">if</span> <span class="n">user_dir</span> <span class="o">==</span> <span class="s1">&#39;./&#39;</span><span class="p">:</span>
                <span class="c1">#set the user directory to the execution-path</span>
                <span class="n">user_dir</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

            <span class="c1">#add a folder with a timestamp</span>
            <span class="n">user_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">user_dir</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H_%M_%S&quot;</span><span class="p">)</span> <span class="o">+</span> \
                        <span class="s1">&#39;_Visualization_Plot/&#39;</span><span class="p">)</span>
            
            <span class="n">create_directory</span><span class="p">(</span><span class="n">user_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">user_dir</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#either offline plotting or store=False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_permanent_attributes</span><span class="p">(</span>
            <span class="n">request_training</span><span class="o">=</span><span class="n">request_training</span><span class="p">,</span>
                <span class="n">request_test</span><span class="o">=</span><span class="n">request_test</span><span class="p">,</span>
                <span class="n">separate_training_and_test</span><span class="o">=</span><span class="n">separate_training_and_test</span><span class="p">,</span>
                <span class="n">averaging</span><span class="o">=</span><span class="n">averaging</span><span class="p">,</span>
                <span class="n">accum_avg</span><span class="o">=</span><span class="n">accum_avg</span><span class="p">,</span>
                <span class="n">single_trial</span><span class="o">=</span><span class="n">single_trial</span><span class="p">,</span>
                <span class="n">time_stamps</span><span class="o">=</span><span class="n">time_stamps</span><span class="p">,</span>
                <span class="n">create_movie</span><span class="o">=</span><span class="n">create_movie</span><span class="p">,</span>
                <span class="n">timeshift</span><span class="o">=</span><span class="n">timeshift</span><span class="p">,</span>
                <span class="n">online</span><span class="o">=</span><span class="n">online</span><span class="p">,</span>
                <span class="n">limit2class</span><span class="o">=</span><span class="n">limit2class</span><span class="p">,</span>
                <span class="n">user_dir</span><span class="o">=</span><span class="n">user_dir</span><span class="p">,</span>
                <span class="n">store_data</span><span class="o">=</span><span class="n">store_data</span><span class="p">,</span>
                <span class="n">store</span> <span class="o">=</span> <span class="n">store</span><span class="p">,</span>
                <span class="n">trial_counter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">avg_values</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                <span class="n">accum_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(),</span>
                <span class="n">st_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(),</span>
                <span class="n">label_counter</span><span class="o">=</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
                <span class="n">skipped_trials</span><span class="o">=</span><span class="nb">list</span><span class="p">(),</span>  <span class="c1">#list of not evaluated trials</span>
                <span class="c1"># whenever _execute was called</span>
                <span class="n">current_trafo_TS</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">physiological_arrangement</span><span class="o">=</span><span class="n">physiological_arrangement</span><span class="p">,</span>
                <span class="n">history_index</span><span class="o">=</span><span class="n">history_index</span><span class="p">,</span>
                <span class="n">use_FN</span><span class="o">=</span><span class="n">use_FN</span><span class="p">,</span>
                <span class="n">use_SF</span><span class="o">=</span><span class="n">use_SF</span><span class="p">,</span>
                <span class="n">SF_channels</span><span class="o">=</span><span class="n">SF_channels</span><span class="p">,</span>
                <span class="n">use_transformation</span><span class="o">=</span><span class="n">use_transformation</span><span class="p">,</span>
                <span class="n">initial_fig_num</span><span class="o">=</span><span class="n">initial_fig_num</span><span class="p">,</span>
                <span class="n">covariancing</span><span class="o">=</span><span class="n">covariancing</span><span class="p">,</span>
                <span class="p">)</span></div>
    
<div class="viewcode-block" id="VisualizationBase.is_trainable"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase.is_trainable">[docs]</a>    <span class="k">def</span> <span class="nf">is_trainable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns whether this node is trainable.</span>
<span class="sd">            Method of base_node overwritten.</span>
<span class="sd">            </span>
<span class="sd">            Returns:       bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_training</span></div>
    
<div class="viewcode-block" id="VisualizationBase.is_supervised"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase.is_supervised">[docs]</a>    <span class="k">def</span> <span class="nf">is_supervised</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns whether this node requires supervised training.</span>
<span class="sd">            Method of base_node overwritten.</span>
<span class="sd">            </span>
<span class="sd">            Returns:       bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_training</span></div>
     
<div class="viewcode-block" id="VisualizationBase._train"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase._train">[docs]</a>    <span class="k">def</span> <span class="nf">_train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">data</span><span class="p">,</span>    <span class="c1">#TimeSeries, FeatureVector or PredictionVector</span>
                        <span class="c1">#      Data to work with.</span>
               <span class="n">label</span><span class="p">):</span>  <span class="c1">#str   class label</span>
        <span class="sd">&quot;&quot;&quot; Every data instance that is passing this function </span>
<span class="sd">            gets a flag.</span>
<span class="sd">            </span>
<span class="sd">            Returns:       nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#notice that instance is training data</span>
        <span class="n">data</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;Training&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span></div>
     
<div class="viewcode-block" id="VisualizationBase._execute"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase._execute">[docs]</a>    <span class="k">def</span> <span class="nf">_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>  <span class="c1"># data = pySPACE data instance</span>
        <span class="sd">&quot;&quot;&quot; This function performs a couple of operations:</span>
<span class="sd">            No matter what kind of data is arriving,</span>
<span class="sd">            the data is transformed into TimeSeries (for more information see below).  </span>
<span class="sd">            </span>
<span class="sd">            The main purpose of this function is to sort the data internally according</span>
<span class="sd">            to the applied and intended label (consisting maximally of &quot;Training&quot; or &quot;Test&quot;</span>
<span class="sd">            plus the actual class label) with respect to what should be plotted (single</span>
<span class="sd">            trial, average or accumulated average). In the end different the list of</span>
<span class="sd">            single_trials (st_list) and/or trials used for averaging (accum_list) are</span>
<span class="sd">            filled with respect to the evaluated label in this function.</span>
<span class="sd">            Accordingly separate counters are increased.</span>
<span class="sd">            </span>
<span class="sd">            These lists and counters can be easily used by any visualisation child node. </span>
<span class="sd">        </span>
<span class="sd">            Data instance will be skipped, if</span>
<span class="sd">            o limit2class is set and the the current label of the data is different</span>
<span class="sd">            o we got training-data, but request_training is False</span>
<span class="sd">            o we got test-data, but request_test is False</span>
<span class="sd">            </span>
<span class="sd">            A list of skipped trials is built.</span>
<span class="sd">            </span>
<span class="sd">            If it has been set:</span>
<span class="sd">            The flag data.specs[&#39;Training&#39;]=True is evaluated and deleted afterwards.</span>
<span class="sd">            </span>
<span class="sd">            Two representations of the data can be computed:</span>
<span class="sd">            o single trial data (=data)</span>
<span class="sd">            o a running average (=accum_avg)</span>

<span class="sd">            In the online mode, the data is plotted here in the execute function</span>
<span class="sd">            (except average), otherwise in store_state.</span>
<span class="sd">                        </span>
<span class="sd">            Called by base_node.</span>
<span class="sd">            </span>
<span class="sd">            .. note::</span>
<span class="sd">                Currently the label is based on the tag.</span>
<span class="sd">                This should be fixed in the near future!</span>
<span class="sd">                </span>
<span class="sd">            Returns:       unmodified data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">pylab_import_error</span> <span class="ow">and</span> <span class="ow">not</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">online</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_plotValues&quot;</span><span class="p">)):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase::Pylab could not be imported. &quot;</span>
                          <span class="s2">&quot;Plotting not supported.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="c1">#convert any datatype internally into TimeSeries</span>
        <span class="c1">#evaluate the datatype and prepare data accordingly</span>
        <span class="n">dattype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dattype</span> <span class="o">==</span> <span class="n">TimeSeries</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_transformation</span><span class="p">:</span>
                <span class="c1"># TimeSeries are used as they are</span>
                <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># TODO: back-transform data!</span>
                <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="n">dattype</span> <span class="o">==</span> <span class="n">FeatureVector</span><span class="p">:</span>
            <span class="c1"># Feature Vectors are transformed into TimeSeries</span>
            <span class="n">prepared_data</span> <span class="o">=</span> \
                <span class="n">type_conversion</span><span class="o">.</span><span class="n">FeatureVector2TimeSeriesNode</span><span class="p">()</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1">#if previous data transformations should be included</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_transformation</span><span class="p">:</span>
                <span class="n">prepared_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prepare_FV</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dattype</span> <span class="o">==</span> <span class="n">PredictionVector</span><span class="p">:</span>
            <span class="c1"># Prediction Vectors are checked for a FeatureVector as predictor</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">prepared_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_prediction</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="n">prepared_data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">prepared_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: Unsupported data type &quot;</span> <span class="o">+</span> \
                              <span class="nb">str</span><span class="p">(</span><span class="n">dattype</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;! Plotting ignored!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1">#should never occur</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: Unsupported data type &quot;</span> <span class="o">+</span> \
                          <span class="nb">str</span><span class="p">(</span><span class="n">dattype</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;! Plotting ignored!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="c1">#start...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1">#get the label from the tag</span>
        <span class="n">curr_label</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1">#training-data? </span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;Training&#39;</span><span class="p">):</span>
            <span class="n">training_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;Training&#39;</span><span class="p">]</span>
            <span class="c1">#in case splits are used, this information has to be deleted</span>
            <span class="k">del</span> <span class="n">data</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;Training&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#we are dealing with test data</span>
            <span class="n">training_data</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit2class</span><span class="p">:</span>
            <span class="c1"># is the current label not the one the user is interested in?</span>
            <span class="k">if</span> <span class="n">curr_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit2class</span><span class="p">:</span>
                <span class="c1">#skip it</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skipped_trials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data</span>

        <span class="c1">#distinguish between training and test data?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate_training_and_test</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">training_data</span><span class="p">:</span>
                <span class="n">curr_label</span> <span class="o">+=</span> <span class="s1">&#39;_Training&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">curr_label</span> <span class="o">+=</span> <span class="s1">&#39;_Test&#39;</span>
                
        <span class="c1">#do we have data that we not requested?</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_training_execution_phase</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_training</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">training_data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_test</span><span class="p">):</span>
            <span class="c1">#skip it!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipped_trials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span> 
        
        <span class="c1">#is averaging of the data intended?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">averaging</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">accum_avg</span><span class="p">:</span>
            <span class="c1">#first time...</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">curr_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_values</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">avg_values</span><span class="p">[</span><span class="n">curr_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_counter</span><span class="p">[</span><span class="n">curr_label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1">#all other times...</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># collecting and updating list with respect to current label</span>
                <span class="n">accumulated_value</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">avg_values</span><span class="p">[</span><span class="n">curr_label</span><span class="p">]</span> \
                    <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_counter</span><span class="p">[</span><span class="n">curr_label</span><span class="p">]</span> \
                    <span class="o">+</span> <span class="n">prepared_data</span>
                    
                <span class="bp">self</span><span class="o">.</span><span class="n">label_counter</span><span class="p">[</span><span class="n">curr_label</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">avg_values</span><span class="p">[</span><span class="n">curr_label</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">accumulated_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_counter</span><span class="p">[</span><span class="n">curr_label</span><span class="p">]</span>
                
            <span class="c1">#plotting intended?</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accum_avg</span><span class="p">:</span>
                <span class="c1">#store the data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accum_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_values</span><span class="p">))</span>
                <span class="c1">#plots in online mode?</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">online</span><span class="p">:</span>
                    <span class="c1">#only possible if child has implemented the plot function</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_plotValues&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_plotValues</span><span class="p">(</span>
                            <span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_values</span><span class="p">,</span>
                            <span class="n">plot_label</span><span class="o">=</span><span class="s2">&quot;accum_avg_no_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span><span class="p">),</span>
                            <span class="n">fig_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fig_num</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>
                            <span class="n">store_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_dir</span><span class="p">,</span>
                            <span class="n">counter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: The node you are using for visualisation &quot;</span> \
                                      <span class="s2">&quot;has no function _plotValues! This is most likely not what you intended!&quot;</span> \
                                      <span class="s2">&quot;Plotting ignored!&quot;</span><span class="p">)</span>
        
        <span class="c1">#single trials intended?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_trial</span><span class="p">:</span>
            <span class="c1">#collect them...</span>
            <span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">values</span><span class="p">[</span><span class="n">curr_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">st_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            
            <span class="c1">#plots in online mode?</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">online</span><span class="p">:</span>
                <span class="c1">#only possible if child has implemented the plot function</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_plotValues&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_plotValues</span><span class="p">(</span>
                        <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">plot_label</span><span class="o">=</span><span class="s2">&quot;single_trial_no_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span><span class="p">),</span>
                        <span class="n">fig_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fig_num</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">store_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_dir</span><span class="p">,</span>
                        <span class="n">counter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: The node you are using for visualisation &quot;</span> \
                                  <span class="s2">&quot;has no function _plotValues! This is most likely not what you intended!&quot;</span> \
                                  <span class="s2">&quot;Plotting ignored!&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">data</span></div>
    
<div class="viewcode-block" id="VisualizationBase.store_state"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase.store_state">[docs]</a>    <span class="k">def</span> <span class="nf">store_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">result_dir</span><span class="p">,</span>     <span class="c1">#string of results dir</span>
                    <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>    <span class="c1">#None or int: number in node chain        </span>
        <span class="sd">&quot;&quot;&quot; Stores the plots to the *result_dir* and is used for offline</span>
<span class="sd">            plotting and for plotting of average values (online and offline).</span>
<span class="sd">            Plots offline-data for every trial which has not been skipped.</span>
<span class="sd">            Optionally creates movies based on the stored images.</span>
<span class="sd">            </span>
<span class="sd">            Called by base_node.</span>
<span class="sd">            </span>
<span class="sd">            Returns:       Nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">:</span>
            <span class="c1">#set the specific directory for this particular node</span>
            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
            <span class="c1">#do we have an index-number?</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c1">#add the index-number...</span>
                <span class="n">node_dir</span> <span class="o">+=</span> <span class="s2">&quot;_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">create_directory</span><span class="p">(</span><span class="n">node_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#no specific directory</span>
            <span class="n">node_dir</span><span class="o">=</span><span class="bp">None</span>
        <span class="c1">#offline mode?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">online</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">single_trial</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">accum_avg</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_plotValues&quot;</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: The node you are using for visualisation &quot;</span> \
                              <span class="s2">&quot;has no function _plotValues! This is most likely not what you intended!&quot;</span> \
                              <span class="s2">&quot;Plotting ignored!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">trial_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">trial_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped_trials</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_trial</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_plotValues</span><span class="p">(</span>
                                <span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">st_list</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span>
                                <span class="n">plot_label</span><span class="o">=</span><span class="s2">&quot;single_trial_no_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trial_num</span><span class="p">),</span>
                                <span class="n">fig_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fig_num</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
                                <span class="n">store_dir</span><span class="o">=</span><span class="n">node_dir</span><span class="p">,</span>
                                <span class="n">counter</span><span class="o">=</span><span class="n">trial_num</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accum_avg</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_plotValues</span><span class="p">(</span>
                                <span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">accum_list</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span>
                                <span class="n">plot_label</span><span class="o">=</span><span class="s2">&quot;accum_avg_no_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">trial_num</span><span class="p">),</span>
                                <span class="n">fig_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fig_num</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>
                                <span class="n">store_dir</span><span class="o">=</span><span class="n">node_dir</span><span class="p">,</span>
                                <span class="n">counter</span><span class="o">=</span><span class="n">trial_num</span><span class="p">)</span>
                        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="c1">#plotting of the whole average or storage of the movie may also be possible in online mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">online</span><span class="p">:</span>
            <span class="c1">#set or change the the specific directory for the node to the</span>
            <span class="c1">#execution-path with a timestamp (see __init__)</span>
            <span class="n">node_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_dir</span>
            
        <span class="c1">#is averaging intended?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">averaging</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_values</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: One of your averages has no &quot;</span> \
                              <span class="s2">&quot;instances! Plotting ignored!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_plotValues&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_plotValues</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_values</span><span class="p">,</span>
                                     <span class="n">plot_label</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">,</span>
                                     <span class="n">fig_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fig_num</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">store_dir</span><span class="o">=</span><span class="n">node_dir</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: The node you are using for visualisation &quot;</span> \
                                  <span class="s2">&quot;has no function _plotValues! This is most likely not what you intended!&quot;</span> \
                                  <span class="s2">&quot;Plotting ignored!&quot;</span><span class="p">)</span>
        
        <span class="c1">#Finally create a movie if specified</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_movie</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_data</span><span class="p">:</span>
            <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_trial</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">prefixes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;single_trial_no_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trial</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accum_avg</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_counter</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">prefixes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;accum_avg_no_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trial</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">averaging</span><span class="p">:</span>
                <span class="n">prefixes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;average&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_movie</span><span class="p">(</span><span class="n">prefixes</span><span class="o">=</span><span class="n">prefixes</span><span class="p">,</span>
                               <span class="n">directory</span><span class="o">=</span><span class="n">node_dir</span><span class="p">)</span>
        <span class="c1">#close the figure windows</span>
        <span class="n">pylab</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="VisualizationBase._create_movie"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase._create_movie">[docs]</a>    <span class="k">def</span> <span class="nf">_create_movie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">prefixes</span><span class="p">,</span>     <span class="c1">#[str]  List of prefixes for the movies to create</span>
                      <span class="n">directory</span><span class="p">):</span>   <span class="c1">#str    Directory for the node</span>
        <span class="sd">&quot;&quot;&quot; Creates movies based on the stored plots.</span>

<span class="sd">            Creates movies in the directory for the node. Movies will be created</span>
<span class="sd">            for those files with the given prefix. One movie for each prefix.</span>
<span class="sd">            Filename extensions may vary. See &quot;man convert&quot; for further</span>
<span class="sd">            informations.</span>
<span class="sd">            </span>
<span class="sd">            Returns:       Nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#store current path</span>
        <span class="n">former_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        
        <span class="c1">#go to node dir </span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s%s</span><span class="s2">_*&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">prefix</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">file_list</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="n">file_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span> <span class="c1">#note: check list sorting - there may still be a bug &gt; leading zeros might still miss</span>
                <span class="k">for</span> <span class="n">file_str</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
                    <span class="c1">#convert format to temporary JPG and scale the image with x=2048</span>
                    <span class="c1">#save it in four-digit format</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;convert </span><span class="si">%s</span><span class="s2"> -resize 2048 </span><span class="si">%s%s%04d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_str</span><span class="p">,</span>
                                    <span class="n">directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">counter</span><span class="p">))</span>
                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1">#create an mp4-video-file with FPS=10, Bitrate=1800 based on the</span>
                    <span class="c1">#files in four-digit format</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;ffmpeg -r 10 -b 1800 -i </span><span class="si">%04d</span><span class="s2">.jpg &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span>
                          <span class="s2">&quot;.mp4&quot;</span><span class="p">)</span>
                
                <span class="c1">#remove the temporary JPGs</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">counter</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%04d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
          
        <span class="c1">#change dir back to old one</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">former_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="VisualizationBase._inc_train"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase._inc_train">[docs]</a>    <span class="k">def</span> <span class="nf">_inc_train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">class_label</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># todo: insert sparse_update switch</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="n">class_label</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span> <span class="o">=</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="VisualizationBase._prepare_prediction"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase._prepare_prediction">[docs]</a>    <span class="k">def</span> <span class="nf">_prepare_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span> <span class="c1">#PredictionVector    Data to work with.</span>
        <span class="sd">&quot;&quot;&quot; Convert prediction vector to time series object for visualization</span>

<span class="sd">        Using the function *get_previous_transformations* the node history is</span>
<span class="sd">        searched for the respective transformation parametrizations and then</span>
<span class="sd">        the transformations are combined tog et a complete picture of the</span>
<span class="sd">        data processing chain.</span>

<span class="sd">        A special case is, when the</span>
<span class="sd">        :class:`~pySPACE.missions.nodes.meta.flow_node.BacktransformationNode`</span>


<span class="sd">        **Parameters**</span>

<span class="sd">            :data: This is a Prediction Vector, which might contain data in its</span>
<span class="sd">                   history component which is used for multiplication with</span>
<span class="sd">                   the transformation or which is used as sample for</span>
<span class="sd">                   calculating the derivative of the processing chain for the</span>
<span class="sd">                   backtransformation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c1">#needed only once</span>
            <span class="n">transformation_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_previous_transformations</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">transformation_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">classifier</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;generic_backtransformation&quot;</span><span class="p">:</span>
                <span class="n">current_trafo</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">current_trafo</span><span class="p">)</span> <span class="o">==</span> <span class="n">FeatureVector</span><span class="p">:</span>
                    <span class="n">current_trafo_TS</span> <span class="o">=</span> <span class="n">type_conversion</span><span class="o">.</span>\
                        <span class="n">FeatureVector2TimeSeriesNode</span><span class="p">()</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">current_trafo</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">current_trafo</span><span class="p">)</span> <span class="o">==</span> <span class="n">TimeSeries</span><span class="p">:</span>
                    <span class="n">current_trafo_TS</span> <span class="o">=</span> <span class="n">current_trafo</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariancing</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">shape</span>
                    <span class="n">covariance</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">new_TS_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
                        <span class="n">covariance</span><span class="p">,</span> <span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                    <span class="n">current_trafo_TS</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">replace_data</span><span class="p">(</span>
                        <span class="n">current_trafo_TS</span><span class="p">,</span> <span class="n">new_TS_array</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">classifier</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;linear classifier&quot;</span><span class="p">:</span>
                <span class="n">classifier_FV</span> <span class="o">=</span> <span class="n">FeatureVector</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">classifier</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                              <span class="n">feature_names</span><span class="o">=</span><span class="n">classifier</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">current_trafo</span> <span class="o">=</span> <span class="n">classifier_FV</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_FN</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">FN</span> <span class="o">=</span> <span class="n">transformation_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                        <span class="k">assert</span><span class="p">(</span><span class="n">FN</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;feature normalization&quot;</span><span class="p">)</span>
                        <span class="k">assert</span><span class="p">(</span><span class="n">classifier</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">FN</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="s2">&quot;VisualizationBase:: Feature names do not match!&quot;</span>
                        <span class="n">FN_FV</span> <span class="o">=</span> <span class="n">FeatureVector</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">FN</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                              <span class="n">feature_names</span> <span class="o">=</span> <span class="n">FN</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">current_trafo</span> <span class="o">=</span> <span class="n">FeatureVector</span><span class="p">(</span><span class="n">current_trafo</span><span class="o">*</span><span class="n">FN_FV</span><span class="p">,</span>
                                              <span class="n">feature_names</span> <span class="o">=</span> <span class="n">FN_FV</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: Did not get any feature normalization!&quot;</span><span class="p">)</span>
                        <span class="k">pass</span> <span class="c1">#raise</span>
                <span class="n">current_trafo_TS</span> <span class="o">=</span> <span class="n">type_conversion</span><span class="o">.</span><span class="n">FeatureVector2TimeSeriesNode</span><span class="p">()</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">current_trafo</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_SF</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># TODO CHECK fitting of channel names</span>
                        <span class="n">SF</span> <span class="o">=</span> <span class="n">transformation_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">SF</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;spatial filter&quot;</span><span class="p">:</span>
                            <span class="n">SF</span> <span class="o">=</span> <span class="n">transformation_list</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                        <span class="k">assert</span><span class="p">(</span><span class="n">SF</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;spatial filter&quot;</span><span class="p">)</span>
                        <span class="n">new_channel_names</span> <span class="o">=</span> <span class="n">SF</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">SF_trafo</span> <span class="o">=</span> <span class="n">SF</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">current_trafo_TS</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">current_trafo_TS</span><span class="p">,</span><span class="n">SF_trafo</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
                                            <span class="n">channel_names</span> <span class="o">=</span> <span class="n">new_channel_names</span><span class="p">,</span>
                                            <span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: Did not get any spatial filter!&quot;</span><span class="p">)</span>
                        <span class="k">pass</span> <span class="c1">#raise</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: &quot;</span><span class="o">+</span>
                              <span class="s2">&quot;Did not get any classifier transformation!&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span>
            <span class="c1"># the reordering should have been done in the type conversion</span>
            <span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">channel_names</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span><span class="o">=</span><span class="n">current_trafo_TS</span>
        <span class="n">prepared_prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_index</span><span class="p">:</span>
            <span class="n">found_in_history</span><span class="o">=</span><span class="bp">False</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_history</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prepared_history</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">history_index</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">prepared_history</span><span class="p">)</span><span class="o">==</span><span class="n">FeatureVector</span><span class="p">:</span>
                        <span class="n">prepared_history</span><span class="o">=</span><span class="n">type_conversion</span><span class="o">.</span><span class="n">FeatureVector2TimeSeriesNode</span><span class="p">()</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">prepared_history</span><span class="p">)</span>
                    <span class="n">found_in_history</span><span class="o">=</span><span class="bp">True</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="n">found_in_history</span><span class="p">:</span>
                <span class="n">prepared_history</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">channel_names</span><span class="p">)</span>
                <span class="n">prepared_prediction</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">prepared_prediction</span><span class="p">)</span><span class="o">*</span><span class="n">prepared_history</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;VisualizationBase:: No FeatureVector or TimeSeries found in history. Parameter history_index ignored!&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">prepared_prediction</span></div>

<div class="viewcode-block" id="VisualizationBase._prepare_FV"><a class="viewcode-back" href="../../../../../api/generated/pySPACE.missions.nodes.visualization.base.html#pySPACE.missions.nodes.visualization.base.VisualizationBase._prepare_FV">[docs]</a>    <span class="k">def</span> <span class="nf">_prepare_FV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert FeatureVector into TimeSeries and use it for plotting.</span>

<span class="sd">        .. note:: This function is not yet working as it should be.</span>
<span class="sd">                  Work in progress.</span>
<span class="sd">                  Commit due to LRP-Demo (DLR Review)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># visualization of transformation or history data times visualization</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">transformation_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_previous_transformations</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">transformation_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1">#first element is previous node</span>

            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">transformation_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_FN</span> <span class="ow">and</span> <span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;feature normalization&quot;</span><span class="p">:</span>
                    <span class="c1"># visualize Feature normalization scaling as feature vector</span>
                    <span class="n">FN_FV</span> <span class="o">=</span> <span class="n">FeatureVector</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">feature_names</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span> <span class="o">=</span> <span class="n">type_conversion</span><span class="o">.</span><span class="n">FeatureVector2TimeSeriesNode</span><span class="p">()</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">FN_FV</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">channel_names</span><span class="p">))</span>
                    <span class="k">break</span>


                <span class="c1"># visualize spatial filter as times series,</span>
                <span class="c1"># where the time axis is the number of channel or virtual</span>
                <span class="c1"># channel name</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_SF</span> <span class="ow">and</span> <span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;spatial filter&quot;</span><span class="p">:</span>
                    <span class="n">new_channel_names</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">SF_trafo</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">SF_trafo</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                <span class="n">channel_names</span> <span class="o">=</span> <span class="n">new_channel_names</span><span class="p">,</span>
                                <span class="n">sampling_frequency</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span><span class="o">.</span><span class="n">channel_names</span><span class="p">))</span>
                    <span class="k">break</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_trafo_TS</span></div></div>

<span class="c1">#    def _get_electrode_coordinates(self, coordinates):</span>
<span class="c1">#        &quot;&quot;&quot; </span>
<span class="c1">#        Convert the polar coordinates of the electrode positions</span>
<span class="c1">#        to cart of the physiologically</span>
<span class="c1">#        arranged plots. As the position specification also requires a height</span>
<span class="c1">#        and width, these values are also passed. Height and width are tuned</span>
<span class="c1">#        manually such that the resulting plots look nice. </span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        </span>
<span class="c1">#        # coordinate transformation</span>
<span class="c1">#        x = (coordinates[0] *</span>
<span class="c1">#             pylab.cos(coordinates[1] / 180 * pylab.pi) + 110) / 245</span>
<span class="c1">#        y = (coordinates[0] *</span>
<span class="c1">#             pylab.sin(coordinates[1] / 180 * pylab.pi) + 110) / 245</span>
<span class="c1">#        w = .07</span>
<span class="c1">#        h = .065</span>
<span class="c1">#    #        if self.shrink_plots:</span>
<span class="c1">#    #            w *= 1.2</span>
<span class="c1">#    #            h *= 0.9</span>
<span class="c1">#    #            x *= 4.0/3.0</span>
<span class="c1">#    #            y *= 4.0/3.0</span>
<span class="c1">#        </span>
<span class="c1">#        return [x, y, w, h]</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">pySPACE documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, pySPACE Developer Team.
      Last updated on Sep 04, 2016.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.2.
    </div>
  </body>
</html>