<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pySPACE.tools.memory_profiling &#8212; pySPACE documentation</title>
    
    <link rel="stylesheet" href="../../../_static/pySPACE.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.3 release',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/pyspace-logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pySPACE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/pyspace-logo_small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pySPACE.tools.memory_profiling</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">External profiling code Imported by Jan-Hendrik Metzen</span>

<span class="sd">    .. todo:: &quot;pySPACE.tools.memory_profiling&quot;</span>
<span class="sd">                is bad documented (usage is unclear) and not importable. Delete?</span>

<span class="sd">    This module exposes 10 functions and 2 classes to obtain lengths</span>
<span class="sd">    and sizes of Python objects (for Python 2.2 or later [1]).</span>

<span class="sd">    The main changes in this version are new function  calcsize(),</span>
<span class="sd">    use  gc.get_objects() to get all objects and improvements in</span>
<span class="sd">    this documentation.</span>

<span class="sd">Public Functions [2]</span>

<span class="sd">   Function  asizeof calculates the combined (approximate) size</span>
<span class="sd">   in bytes of one or several Python objects.</span>

<span class="sd">   Function  asizesof returns a tuple containing the (approximate)</span>
<span class="sd">   size in bytes for each given Python object separately.</span>

<span class="sd">   Function  asized returns for each object an instance of class</span>
<span class="sd">   Asized containing all the size information of the object and a</span>
<span class="sd">   tuple with the referents.</span>

<span class="sd">   Functions  basicsize and  itemsize return the basic respectively</span>
<span class="sd">   item size of the given object.</span>

<span class="sd">   Function  flatsize returns the flat size of a Python object in</span>
<span class="sd">   bytes defined as the basic size plus the item size times the</span>
<span class="sd">   length of the given object.</span>

<span class="sd">   Function  leng returns the length of an object, like standard</span>
<span class="sd">   len but extended for several types, e.g. the  leng of a multi-</span>
<span class="sd">   precision int (or long) is the number of digits [3].  The length</span>
<span class="sd">   of most mutable sequence objects includes an estimate of the</span>
<span class="sd">   over-allocation and therefore, the  leng value may differ from</span>
<span class="sd">   the standard  len result.</span>

<span class="sd">   Function  refs returns (a generator for) the referents of the</span>
<span class="sd">   given object, i.e. the objects referenced by the given object.</span>

<span class="sd">   Function  calcsize is equivalent to standard  struct.calcsize</span>
<span class="sd">   but handles format characters &#39;z&#39; for signed C type  Py_ssize_t</span>
<span class="sd">   and &#39;Z&#39; for unsigned C type  size_t.</span>

<span class="sd">   Certain classes are known to be sub-classes of or to behave as</span>
<span class="sd">   dict objects.  Function  adict can be used to install other</span>
<span class="sd">   class objects to be treated like dict.</span>

<span class="sd">Public Classes [2]</span>

<span class="sd">   An instance of class  Asized is returned for each object sized</span>
<span class="sd">   with the  asized function or method.</span>

<span class="sd">   Class  Asizer can be used to accumulate the results of several</span>
<span class="sd">   asizeof or  asizesof calls.  After creating an  Asizer instance,</span>
<span class="sd">   use methods  asizeof and  asizesof to size additional objects.</span>

<span class="sd">   Call methods  exclude_refs and/or  exclude_types to exclude</span>
<span class="sd">   references to or instances or types of certain objects.</span>

<span class="sd">   Use one of the  print\_... methods to report the statistics.</span>

<span class="sd">Duplicate Objects</span>

<span class="sd">   Any duplicate, given objects are sized only once and the size</span>
<span class="sd">   is included in the combined total only once.  But functions</span>
<span class="sd">   asizesof and  asized do return a size value respectively an</span>
<span class="sd">   Asized instance for each given object, the same for duplicates.</span>

<span class="sd">Definitions [4]</span>

<span class="sd">   The size of an object is defined as the sum of the flat size</span>
<span class="sd">   of the object plus the sizes of any referents.  Referents are</span>
<span class="sd">   visited recursively up to a given limit.  However, the size</span>
<span class="sd">   of objects referenced multiple times is included only once.</span>

<span class="sd">   The flat size of an object is defined as the basic size of the</span>
<span class="sd">   object plus the item size times the number of allocated items.</span>
<span class="sd">   The flat size does include the size for the items (references</span>
<span class="sd">   to the referents), but not the referents themselves.</span>

<span class="sd">   The flat size returned by function  flatsize equals the result</span>
<span class="sd">   of the  asizeof function with options code=True, ignored=False,</span>
<span class="sd">   limit=0 and option  align set to the same value.</span>

<span class="sd">   The accurate flat size for an object is obtained from function</span>
<span class="sd">   sys.getsizeof() where available.  Otherwise, the length and</span>
<span class="sd">   size of sequence objects as dicts, lists, sets, etc. is based</span>
<span class="sd">   on an estimate for the number of allocated items.  As a result,</span>
<span class="sd">   the reported length and size may substantially differ from the</span>
<span class="sd">   actual length and size.</span>

<span class="sd">   The basic and item sizes are obtained from the __basicsize__</span>
<span class="sd">   respectively __itemsize__ attribute of the (type of the) object.</span>
<span class="sd">   Where necessary (e.g. sequence objects), a zero __itemsize__</span>
<span class="sd">   is replaced by the size of a corresponding C type.</span>

<span class="sd">   The basic size (of GC managed objects) objects includes the</span>
<span class="sd">   overhead for Python&#39;s garbage collector (GC) as well as the</span>
<span class="sd">   space needed for refcounts (only in certain Python builds).</span>

<span class="sd">   Optionally, sizes can be aligned to any power of 2 multiple.</span>

<span class="sd">Size of (byte)code</span>

<span class="sd">   The (byte)code size of objects as classes, functions, methods,</span>
<span class="sd">   modules, etc. can be included by setting option  code.</span>

<span class="sd">   Iterators are handled similar to sequences: iterated object(s)</span>
<span class="sd">   are sized like referents if the recursion limit permits.  Also,</span>
<span class="sd">   function  gc.get_referents() must return the referent object</span>
<span class="sd">   of iterators.</span>

<span class="sd">   Generators are sized as (byte)code only, but generated objects</span>
<span class="sd">   are never sized.</span>

<span class="sd">Old- and New-style Classes</span>

<span class="sd">   All old- and new-style class, instance and type objects, are</span>
<span class="sd">   handled uniformly such that (a) instance and class objects can</span>
<span class="sd">   be distinguished and (b) instances of different old-style</span>
<span class="sd">   classes can be dealt with separately.</span>

<span class="sd">   Class and type objects are represented as &lt;class ....* def&gt;</span>
<span class="sd">   respectively as &lt;type ... def&gt; where an &#39;*&#39; indicates an old-</span>
<span class="sd">   style class and the  def suffix marks the definition object.</span>
<span class="sd">   Instances of old-style classes are shown as new-style ones but</span>
<span class="sd">   with an &#39;*&#39; at the end of the name, like &lt;class module.name*&gt;.</span>

<span class="sd">Ignored Objects</span>

<span class="sd">   To avoid excessive sizes, several object types are ignored [4]</span>
<span class="sd">   by default, e.g. built-in functions, built-in types and classes</span>
<span class="sd">   [5], function globals and module referents.  However, any</span>
<span class="sd">   instances thereof are sized and module objects will be sized</span>
<span class="sd">   when passed as given objects.  Ignored object types are included</span>
<span class="sd">   if option  ignored is set accordingly.</span>

<span class="sd">   In addition, many __...__ attributes of callable objects are</span>
<span class="sd">   ignored, except crucial ones, e.g. class attributes __dict__,</span>
<span class="sd">   __doc__, __name__ and __slots__.  For more details, see the</span>
<span class="sd">   type-specific _..._refs() and _len_...() functions below.</span>

<span class="sd">   Option  all can be used to size all Python objects and/or get</span>
<span class="sd">   the referents from  gc.get_referents() and override the type-</span>
<span class="sd">   specific __..._refs() functions.</span>

<span class="sd">.. note::</span>

<span class="sd">   [1] Tested with Python 2.2.3, 2.3.7, 2.4.5, 2.5.1, 2.5.2, 2.6.2,</span>
<span class="sd">       3.0.1 or 3.1a2 on CentOS 4.6, SuSE 9.3, MacOS X 10.4.11 Tiger</span>
<span class="sd">       (Intel) and 10.3.9 Panther (PPC), Solaris 10 (Opteron) and</span>
<span class="sd">       Windows XP all 32-bit Python and on RHEL 3u7 and Solaris 10</span>
<span class="sd">       (Opteron) both 64-bit Python.</span>

<span class="sd">   [2] The functions and classes in this module are not thread-safe.</span>

<span class="sd">   [3] See Python source file .../Include/longinterp.h for the</span>
<span class="sd">       C typedef of digit used in multi-precision int (or long)</span>
<span class="sd">       objects.  The size of digit in bytes can be obtained in</span>
<span class="sd">       Python from the int (or long) __itemsize__ attribute.</span>
<span class="sd">       Function  leng (rather _len_int) below deterimines the</span>
<span class="sd">       number of digits from the int (or long) value.</span>

<span class="sd">   [4] These definitions and other assumptions are rather arbitrary</span>
<span class="sd">       and may need corrections or adjustments.</span>

<span class="sd">   [5] Types and classes are considered built-in if the module of</span>
<span class="sd">       the type or class is listed in  _builtin_modules below.</span>

<span class="sd">Original BSD license::</span>

<span class="sd">    ---------------------------------------------------------------------</span>
<span class="sd">           Copyright (c) 2002-2009 -- ProphICy Semiconductor, Inc.</span>
<span class="sd">                            All rights reserved.</span>

<span class="sd">     Redistribution and use in source and binary forms, with or without</span>
<span class="sd">     modification, are permitted provided that the following conditions</span>
<span class="sd">     are met:</span>

<span class="sd">     - Redistributions of source code must retain the above copyright</span>
<span class="sd">       notice, this list of conditions and the following disclaimer.</span>

<span class="sd">     - Redistributions in binary form must reproduce the above copyright</span>
<span class="sd">       notice, this list of conditions and the following disclaimer in</span>
<span class="sd">       the documentation and/or other materials provided with the</span>
<span class="sd">       distribution.</span>

<span class="sd">     - Neither the name of ProphICy Semiconductor, Inc. nor the names</span>
<span class="sd">       of its contributors may be used to endorse or promote products</span>
<span class="sd">       derived from this software without specific prior written</span>
<span class="sd">       permission.</span>

<span class="sd">     THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="sd">     &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="sd">     LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span>
<span class="sd">     FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE</span>
<span class="sd">     COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<span class="sd">     INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<span class="sd">     (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="sd">     SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
<span class="sd">     HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,</span>
<span class="sd">     STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<span class="sd">     ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED</span>
<span class="sd">     OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="sd">    ---------------------------------------------------------------------</span>

<span class="sd">This is the latest, enhanced version of the asizeof.py recipes at</span>
<span class="sd">&lt;http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/546530&gt;</span>
<span class="sd">&lt;http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/544288&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>  <span class="c1">#PYCHOK expected</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">generators</span>  <span class="c1">#PYCHOK for yield in Python 2.2</span>

<span class="kn">from</span> <span class="nn">inspect</span>    <span class="k">import</span> <span class="n">isbuiltin</span><span class="p">,</span> <span class="n">isclass</span><span class="p">,</span> <span class="n">iscode</span><span class="p">,</span> <span class="n">isframe</span><span class="p">,</span> \
                       <span class="n">isfunction</span><span class="p">,</span> <span class="n">ismethod</span><span class="p">,</span> <span class="n">ismodule</span><span class="p">,</span> <span class="n">stack</span>
<span class="kn">from</span> <span class="nn">math</span>       <span class="k">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">os</span>         <span class="k">import</span> <span class="n">linesep</span>
<span class="kn">from</span> <span class="nn">struct</span>     <span class="k">import</span> <span class="n">calcsize</span> <span class="k">as</span> <span class="n">_calcsize</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span>    <span class="k">as</span>     <span class="nn">Types</span>
<span class="kn">import</span> <span class="nn">weakref</span>  <span class="k">as</span>     <span class="nn">Weakref</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;5.12 (Apr 27, 2009)&#39;</span>
<span class="n">__all__</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adict&#39;</span><span class="p">,</span> <span class="s1">&#39;asized&#39;</span><span class="p">,</span> <span class="s1">&#39;asizeof&#39;</span><span class="p">,</span> <span class="s1">&#39;asizesof&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Asized&#39;</span><span class="p">,</span> <span class="s1">&#39;Asizer&#39;</span><span class="p">,</span>  <span class="c1"># classes</span>
               <span class="s1">&#39;basicsize&#39;</span><span class="p">,</span> <span class="s1">&#39;flatsize&#39;</span><span class="p">,</span> <span class="s1">&#39;itemsize&#39;</span><span class="p">,</span> <span class="s1">&#39;leng&#39;</span><span class="p">,</span> <span class="s1">&#39;refs&#39;</span><span class="p">,</span>
               <span class="s1">&#39;calcsize&#39;</span><span class="p">]</span>  <span class="c1"># handles &#39;z&#39; and &#39;Z&#39;</span>

 <span class="c1"># any classes or types in modules listed in _builtin_modules are</span>
 <span class="c1"># considered built-in and ignored by default, as built-in functions</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">_builtin_modules</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="s1">&#39;types&#39;</span><span class="p">,</span> <span class="ne">Exception</span><span class="o">.</span><span class="n">__module__</span><span class="p">)</span>  <span class="c1"># , &#39;weakref&#39;</span>
<span class="k">else</span><span class="p">:</span>  <span class="c1"># treat this very module as built-in</span>
    <span class="n">_builtin_modules</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="s1">&#39;types&#39;</span><span class="p">,</span> <span class="ne">Exception</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="n">__name__</span><span class="p">)</span>  <span class="c1"># , &#39;weakref&#39;</span>

 <span class="c1"># sizes of some primitive C types</span>
 <span class="c1"># XXX len(pack(T, 0)) == Struct(T).size == _calcsize(T)</span>
 <span class="c1"># but type/class Struct only available since Python 2.5</span>
<span class="n">_sizeof_Cbyte</span>  <span class="o">=</span> <span class="n">_calcsize</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>  <span class="c1"># sizeof(unsigned char)</span>
<span class="n">_sizeof_Clong</span>  <span class="o">=</span> <span class="n">_calcsize</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>  <span class="c1"># sizeof(long)</span>
<span class="n">_sizeof_Cvoidp</span> <span class="o">=</span> <span class="n">_calcsize</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>  <span class="c1"># sizeof(void*)</span>

 <span class="c1"># sizeof(long) != sizeof(ssize_t) on LLP64</span>
<span class="k">if</span> <span class="n">_sizeof_Clong</span> <span class="o">&lt;</span> <span class="n">_sizeof_Cvoidp</span><span class="p">:</span>
    <span class="n">_Zz</span> <span class="o">=</span> <span class="s1">&#39;PP&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_Zz</span> <span class="o">=</span> <span class="s1">&#39;Ll&#39;</span>

<div class="viewcode-block" id="calcsize"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.calcsize">[docs]</a><span class="k">def</span> <span class="nf">calcsize</span><span class="p">(</span><span class="n">fmt</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;struct.calcsize() handling &#39;z&#39; for signed Py_ssize_t and &#39;Z&#39; for unsigned size_t.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_calcsize</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">_Zz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">_Zz</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span></div>

 <span class="c1"># defaults for some basic sizes with &#39;z&#39; for C Py_ssize_t</span>
<span class="n">_sizeof_CPyCodeObject</span>   <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;Pz10P5i0P&#39;</span><span class="p">)</span>    <span class="c1"># sizeof(PyCodeObject)</span>
<span class="n">_sizeof_CPyFrameObject</span>  <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;Pzz13P63i0P&#39;</span><span class="p">)</span>  <span class="c1"># sizeof(PyFrameObject)</span>
<span class="n">_sizeof_CPyModuleObject</span> <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;PzP0P&#39;</span><span class="p">)</span>        <span class="c1"># sizeof(PyModuleObject)</span>

 <span class="c1"># defaults for some item sizes with &#39;z&#39; for C Py_ssize_t</span>
<span class="n">_sizeof_CPyDictEntry</span>    <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;z2P&#39;</span><span class="p">)</span>  <span class="c1"># sizeof(PyDictEntry)</span>
<span class="n">_sizeof_Csetentry</span>       <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;lP&#39;</span><span class="p">)</span>   <span class="c1"># sizeof(setentry)</span>

 <span class="c1"># XXX use sys.int_info.sizeof_digit in Python 3.1</span>
<span class="k">try</span><span class="p">:</span>  <span class="c1"># C typedef digit for multi-precision int (or long)</span>
    <span class="n">_sizeof_Cdigit</span> <span class="o">=</span> <span class="n">long</span><span class="o">.</span><span class="n">__itemsize__</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># no long in Python 3.0</span>
    <span class="n">_sizeof_Cdigit</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">__itemsize__</span>
<span class="k">if</span> <span class="n">_sizeof_Cdigit</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;sizeof(</span><span class="si">%s</span><span class="s1">) bad: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;digit&#39;</span><span class="p">,</span> <span class="n">_sizeof_Cdigit</span><span class="p">))</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># sizeof(unicode_char)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># no unicode() in Python 3.0</span>
    <span class="n">u</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;unicode-internal&#39;</span><span class="p">)</span>  <span class="c1"># see .../Lib/test/test_sys.py</span>
<span class="n">_sizeof_Cunicode</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="k">del</span> <span class="n">u</span>
<span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">_sizeof_Cunicode</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxunicode</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;sizeof(</span><span class="si">%s</span><span class="s1">) bad: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;unicode&#39;</span><span class="p">,</span> <span class="n">_sizeof_Cunicode</span><span class="p">))</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;maxsize&#39;</span><span class="p">):</span>  <span class="c1"># new in Python 2.6</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>  <span class="c1"># check sizeof(size_t)</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">Z</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;sizeof(</span><span class="si">%s</span><span class="s1">) bad: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;size_t&#39;</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
    <span class="k">del</span> <span class="n">Z</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># size of GC header, sizeof(PyGC_Head)</span>
    <span class="kn">import</span> <span class="nn">_testcapi</span> <span class="k">as</span> <span class="nn">t</span>
    <span class="n">_sizeof_CPyGC_Head</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">SIZEOF_PYGC_HEAD</span>  <span class="c1"># new in Python 2.6</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>  <span class="c1"># sizeof(PyGC_Head)</span>
     <span class="c1"># alignment should be to sizeof(long double) but there</span>
     <span class="c1"># is no way to obtain that value, assume twice double</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">_sizeof_CPyGC_Head</span> <span class="o">=</span> <span class="p">(</span><span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;2Pz&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">t</span>
<span class="k">del</span> <span class="n">t</span>

 <span class="c1"># size of refcounts (Python debug build only)</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;gettotalrefcount&#39;</span><span class="p">):</span>
    <span class="n">_sizeof_Crefcounts</span> <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;2z&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_sizeof_Crefcounts</span> <span class="o">=</span> <span class="mi">0</span>

 <span class="c1"># some flags from .../Include/object.h</span>
<span class="n">_Py_TPFLAGS_HEAPTYPE</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span>  <span class="mi">9</span>  <span class="c1"># Py_TPFLAGS_HEAPTYPE</span>
<span class="n">_Py_TPFLAGS_HAVE_GC</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span>  <span class="c1"># Py_TPFLAGS_HAVE_GC</span>

<span class="n">_Type_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>  <span class="c1"># == type and new-style class type</span>


 <span class="c1"># compatibility functions for more uniform</span>
 <span class="c1"># behavior across Python version 2.2 thu 3.0</span>

<span class="k">def</span> <span class="nf">_items</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1"># dict only</span>
    <span class="sd">&#39;&#39;&#39;Return iter-/generator, preferably.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;iteritems&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">)()</span>

<span class="k">def</span> <span class="nf">_keys</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1"># dict only</span>
    <span class="sd">&#39;&#39;&#39;Return iter-/generator, preferably.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;iterkeys&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">)()</span>

<span class="k">def</span> <span class="nf">_values</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1"># dict only</span>
    <span class="sd">&#39;&#39;&#39;Use iter-/generator, preferably.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;itervalues&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="p">)()</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># callable() builtin</span>
    <span class="n">_callable</span> <span class="o">=</span> <span class="n">callable</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># callable() removed in Python 3.0</span>
    <span class="k">def</span> <span class="nf">_callable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Substitute for callable().&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># get &#39;all&#39; current objects</span>
    <span class="kn">from</span> <span class="nn">gc</span> <span class="k">import</span> <span class="n">get_objects</span> <span class="k">as</span> <span class="n">_getobjects</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">_getobjects</span><span class="p">():</span>
         <span class="c1"># modules first, globals and stack</span>
         <span class="c1"># (may contain duplicate objects)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_values</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span>
               <span class="nb">globals</span><span class="p">(),</span> <span class="n">stack</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getrecursionlimit</span><span class="p">()))</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># get &#39;all&#39; referents of objects</span>
      <span class="c1"># note that gc.get_referents()</span>
      <span class="c1"># returns () for dict...-iterators</span>
    <span class="kn">from</span> <span class="nn">gc</span> <span class="k">import</span> <span class="n">get_referents</span> <span class="k">as</span> <span class="n">_getreferents</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># no get_referents() in Python 2.2</span>
    <span class="k">def</span> <span class="nf">_getreferents</span><span class="p">(</span><span class="n">unused</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">()</span>  <span class="c1"># sorry, no refs</span>

 <span class="c1"># sys.getsizeof() new in Python 2.6</span>
<span class="n">_getsizeof</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;getsizeof&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># str intern()</span>
    <span class="n">_intern</span> <span class="o">=</span> <span class="n">intern</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># no intern() in Python 3.0</span>
    <span class="k">def</span> <span class="nf">_intern</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span>

<span class="k">def</span> <span class="nf">_kwds</span><span class="p">(</span><span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># no dict(key=value, ...) in Python 2.2</span>
    <span class="sd">&#39;&#39;&#39;Return name=value pairs as keywords dict.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">kwds</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># sorted() builtin</span>
    <span class="n">_sorted</span> <span class="o">=</span> <span class="nb">sorted</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># no sorted() in Python 2.2</span>
    <span class="k">def</span> <span class="nf">_sorted</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Partial substitute for missing sorted().&#39;&#39;&#39;</span>
        <span class="n">vals</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># inplace OK</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">vals</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># sum() builtin</span>
    <span class="n">_sum</span> <span class="o">=</span> <span class="nb">sum</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># no sum() in Python 2.2</span>
    <span class="k">def</span> <span class="nf">_sum</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Partial substitute for missing sum().&#39;&#39;&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">s</span>


 <span class="c1"># private functions</span>

<span class="k">def</span> <span class="nf">_basicsize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">heap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get non-zero basicsize of type,</span>
<span class="sd">       including the header sizes.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;__basicsize__&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">base</span><span class="p">)</span>
     <span class="c1"># include gc header size</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">_Type_type</span><span class="p">:</span>
       <span class="n">h</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="s1">&#39;__flags__&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">_Py_TPFLAGS_HAVE_GC</span>
    <span class="k">elif</span> <span class="n">heap</span><span class="p">:</span>  <span class="c1"># type, allocated on heap</span>
       <span class="n">h</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># None has no __flags__ attr</span>
       <span class="n">h</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__flags__&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">_Py_TPFLAGS_HEAPTYPE</span>
    <span class="k">if</span> <span class="n">h</span><span class="p">:</span>
       <span class="n">s</span> <span class="o">+=</span> <span class="n">_sizeof_CPyGC_Head</span>
     <span class="c1"># include reference counters</span>
    <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="n">_sizeof_Crefcounts</span>

<span class="k">def</span> <span class="nf">_derive_typedef</span><span class="p">(</span><span class="n">typ</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return single, existing super type typedef or None.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_values</span><span class="p">(</span><span class="n">_typedefs</span><span class="p">)</span> <span class="k">if</span> <span class="n">_issubclass</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">type</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">_dir2</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pref</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">excl</span><span class="o">=</span><span class="p">(),</span> <span class="n">slots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">itor</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return an attribute name, object 2-tuple for certain</span>
<span class="sd">       attributes or for the &#39;__slots__&#39; attributes of the</span>
<span class="sd">       given object, but not both.  Any iterator referent</span>
<span class="sd">       objects are returned with the given name if the</span>
<span class="sd">       latter is non-empty.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">slots</span><span class="p">:</span>  <span class="c1"># __slots__ attrs</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">slots</span><span class="p">):</span>
             <span class="c1"># collect all inherited __slots__ attrs</span>
             <span class="c1"># from list, tuple, or dict __slots__,</span>
             <span class="c1"># while removing any duplicate attrs</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">mro</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">slots</span><span class="p">,</span> <span class="p">()):</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                        <span class="n">s</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
             <span class="c1"># assume __slots__ tuple/list</span>
             <span class="c1"># is holding the attr values</span>
            <span class="k">yield</span> <span class="n">slots</span><span class="p">,</span> <span class="n">_Slots</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># _keys(s)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">t</span>  <span class="c1"># attr name, value</span>
    <span class="k">elif</span> <span class="n">itor</span><span class="p">:</span>  <span class="c1"># iterator referents</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>  <span class="c1"># iter(obj)</span>
            <span class="k">yield</span> <span class="n">itor</span><span class="p">,</span> <span class="n">o</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># regular attrs</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">pref</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excl</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
               <span class="k">yield</span> <span class="n">a</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_infer_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return True for likely dict object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">ats</span> <span class="ow">in</span> <span class="p">((</span><span class="s1">&#39;__len__&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;has_key&#39;</span><span class="p">,</span>     <span class="s1">&#39;items&#39;</span><span class="p">,</span>     <span class="s1">&#39;keys&#39;</span><span class="p">,</span>     <span class="s1">&#39;values&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;__len__&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;has_key&#39;</span><span class="p">,</span> <span class="s1">&#39;iteritems&#39;</span><span class="p">,</span> <span class="s1">&#39;iterkeys&#39;</span><span class="p">,</span> <span class="s1">&#39;itervalues&#39;</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ats</span><span class="p">:</span>  <span class="c1"># no all(&lt;generator_expression&gt;) in Python 2.2</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># all True</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">_isdictclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return True for known dict objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">__name__</span> <span class="ow">in</span> <span class="n">_dict_classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="p">())</span>

<span class="k">def</span> <span class="nf">_issubclass</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">sup</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Safe issubclass().</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">sup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">object</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">sup</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">_itemsize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get non-zero itemsize of type.</span>
<span class="sd">    &#39;&#39;&#39;</span>
     <span class="c1"># replace zero value with default</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;__itemsize__&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span>

<span class="k">def</span> <span class="nf">_kwdstr</span><span class="p">(</span><span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Keyword arguments as a string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_sorted</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kv</span> <span class="k">for</span> <span class="n">kv</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="n">kwds</span><span class="p">)]))</span>  <span class="c1"># [] for Python 2.2</span>

<span class="k">def</span> <span class="nf">_lengstr</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Object length as a string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">leng</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># no len</span>
       <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">_len</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1"># extended</span>
       <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39; leng </span><span class="si">%d</span><span class="s1">!&#39;</span> <span class="o">%</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39; leng </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">_nameof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dflt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the name of an object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="n">dflt</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_objs</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">unused</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the given or &#39;all&#39; objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">all</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">objs</span> <span class="ow">or</span> <span class="p">()</span>
    <span class="k">elif</span> <span class="nb">all</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># &#39;all&#39; objects</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">objs</span> <span class="ow">or</span> <span class="n">_getobjects</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="nb">all</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">t</span>

<span class="k">def</span> <span class="nf">_p100</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return percentage as string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">part</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">r</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%.*f%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prec</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;n/a&#39;</span>

<span class="k">def</span> <span class="nf">_plural</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return &#39;s&#39; if plural.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">_power2</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Find the next power of 2.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">:</span>
        <span class="n">p2</span> <span class="o">+=</span> <span class="n">p2</span>
    <span class="k">return</span> <span class="n">p2</span>

<span class="k">def</span> <span class="nf">_prepr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Prettify and clip long repr() string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="n">clip</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># remove &lt;&#39;&#39;&gt;</span>

<span class="k">def</span> <span class="nf">_printf</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Formatted print.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">print3opts</span><span class="p">:</span>  <span class="c1"># like Python 3.0</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">print3opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">print3opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="o">*</span><span class="n">ats</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific attribute objects of an object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">named</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ats</span><span class="p">:</span>  <span class="c1"># cf. inspect.getmembers()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">_NamedRef</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>  <span class="c1"># kwds are _dir2() args</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">_dir2</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">_NamedRef</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ats</span><span class="p">:</span>  <span class="c1"># cf. inspect.getmembers()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                <span class="k">yield</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>  <span class="c1"># kwds are _dir2() args</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">_dir2</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">o</span>

<span class="k">def</span> <span class="nf">_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Clip long repr() string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># safe repr()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">clip</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">clip</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[:</span><span class="n">h</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;....&#39;</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">_SI</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return size as SI string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">K</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="s1">&#39;KMGPTE&#39;</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">/=</span> <span class="n">K</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="n">K</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39; or </span><span class="si">%.1f</span><span class="s1"> </span><span class="si">%s%s</span><span class="s1">B&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">_SI2</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return size as regular plus SI string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">_SI</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

 <span class="c1"># type-specific referent functions</span>

<span class="k">def</span> <span class="nf">_class_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a class object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">,</span>  <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__mro__&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;__name__&#39;</span><span class="p">,</span>  <span class="s1">&#39;__slots__&#39;</span><span class="p">,</span> <span class="s1">&#39;__weakref__&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_co_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a code object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="n">pref</span><span class="o">=</span><span class="s1">&#39;co_&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_dict_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return key and value objects of a dict/proxy.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">named</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">_NamedRef</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># key</span>
            <span class="k">yield</span> <span class="n">_NamedRef</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">k</span>
            <span class="k">yield</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">_enum_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of an enumerate object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_exc_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of an Exception object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
     <span class="c1"># .message raises DeprecationWarning in Python 2.6</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span>  <span class="c1"># , &#39;message&#39;, &#39;mixed&#39;</span>

<span class="k">def</span> <span class="nf">_file_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a file object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_frame_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a frame object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="n">pref</span><span class="o">=</span><span class="s1">&#39;f_&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_func_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a function or lambda object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">,</span>
                             <span class="n">pref</span><span class="o">=</span><span class="s1">&#39;func_&#39;</span><span class="p">,</span> <span class="n">excl</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;func_globals&#39;</span><span class="p">,))</span>

<span class="k">def</span> <span class="nf">_gen_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the referent(s) of a generator object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
     <span class="c1"># only some gi_frame attrs</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;gi_frame&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;f_locals&#39;</span><span class="p">,</span> <span class="s1">&#39;f_code&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_im_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a method object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">,</span>
                             <span class="n">pref</span><span class="o">=</span><span class="s1">&#39;im_&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_inst_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a class instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span>
                             <span class="n">slots</span><span class="o">=</span><span class="s1">&#39;__slots__&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_iter_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the referent(s) of an iterator object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">_getreferents</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># special case</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="n">itor</span><span class="o">=</span><span class="n">_nameof</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;iteref&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_module_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a module object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
     <span class="c1"># ignore this very module</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="n">__name__</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>
     <span class="c1"># module is essentially a dict</span>
    <span class="k">return</span> <span class="n">_dict_refs</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">named</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_prop_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a property object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="n">pref</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_seq_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">unused</span><span class="p">):</span>  <span class="c1"># named unused for PyChecker</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a frozen/set, list, tuple and xrange object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">obj</span>  <span class="c1"># XXX for r in obj: yield r</span>

<span class="k">def</span> <span class="nf">_stat_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return referents of a os.stat object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="n">pref</span><span class="o">=</span><span class="s1">&#39;st_&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_statvfs_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return referents of a os.statvfs object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="n">pref</span><span class="o">=</span><span class="s1">&#39;f_&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_tb_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a traceback object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="n">pref</span><span class="o">=</span><span class="s1">&#39;tb_&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_type_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return specific referents of a type object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__mro__&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;__slots__&#39;</span><span class="p">,</span> <span class="s1">&#39;__weakref__&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_weak_refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">unused</span><span class="p">):</span>  <span class="c1"># named unused for PyChecker</span>
    <span class="sd">&#39;&#39;&#39;Return weakly referent object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># ignore &#39;key&#39; of KeyedRef</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">obj</span><span class="p">(),)</span>
    <span class="k">except</span><span class="p">:</span>  <span class="c1"># XXX ReferenceError</span>
        <span class="k">return</span> <span class="p">()</span>  <span class="c1">#PYCHOK OK</span>

<span class="n">_all_refs</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_class_refs</span><span class="p">,</span>   <span class="n">_co_refs</span><span class="p">,</span>   <span class="n">_dict_refs</span><span class="p">,</span>  <span class="n">_enum_refs</span><span class="p">,</span>
                   <span class="n">_exc_refs</span><span class="p">,</span>     <span class="n">_file_refs</span><span class="p">,</span> <span class="n">_frame_refs</span><span class="p">,</span> <span class="n">_func_refs</span><span class="p">,</span>
                   <span class="n">_gen_refs</span><span class="p">,</span>     <span class="n">_im_refs</span><span class="p">,</span>   <span class="n">_inst_refs</span><span class="p">,</span>  <span class="n">_iter_refs</span><span class="p">,</span>
                   <span class="n">_module_refs</span><span class="p">,</span>  <span class="n">_prop_refs</span><span class="p">,</span> <span class="n">_seq_refs</span><span class="p">,</span>   <span class="n">_stat_refs</span><span class="p">,</span>
                   <span class="n">_statvfs_refs</span><span class="p">,</span> <span class="n">_tb_refs</span><span class="p">,</span>   <span class="n">_type_refs</span><span class="p">,</span>  <span class="n">_weak_refs</span><span class="p">)</span>


 <span class="c1"># type-specific length functions</span>

<span class="k">def</span> <span class="nf">_len</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Safe len().</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># no len()</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">_len_array</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Array length in bytes.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">itemsize</span>

<span class="k">def</span> <span class="nf">_len_bytearray</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Bytearray size.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">__alloc__</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_len_code</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1"># see .../Lib/test/test_sys.py</span>
    <span class="sd">&#39;&#39;&#39;Length of code object (stack and variables only).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">co_stacksize</span> <span class="o">+</span>      <span class="n">obj</span><span class="o">.</span><span class="n">co_nlocals</span>  \
                            <span class="o">+</span> <span class="n">_len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">co_freevars</span><span class="p">)</span> \
                            <span class="o">+</span> <span class="n">_len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">co_cellvars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">_len_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Dict length in items (estimate).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># active items</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># ma_smalltable ...</span>
       <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># ... in basicsize</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># at least one unused</span>
       <span class="n">n</span> <span class="o">=</span> <span class="n">_power2</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="k">def</span> <span class="nf">_len_frame</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Length of a frame object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;f_code&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
       <span class="n">n</span> <span class="o">=</span> <span class="n">_len_code</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="n">_digit2p2</span> <span class="o">=</span>  <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">_sizeof_Cdigit</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">_digitmax</span> <span class="o">=</span> <span class="n">_digit2p2</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># == (2 * PyLong_MASK + 1)</span>
<span class="n">_digitlog</span> <span class="o">=</span>  <span class="mf">1.0</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="n">_digit2p2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_len_int</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Length of multi-precision int (aka long) in digits.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">_digitmax</span><span class="p">:</span>
             <span class="c1"># no log(x[, base]) in Python 2.2</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">_digitlog</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># zero</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="k">def</span> <span class="nf">_len_iter</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Length (hint) of an iterator.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__length_hint__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
       <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># try len()</span>
       <span class="n">n</span> <span class="o">=</span> <span class="n">_len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="k">def</span> <span class="nf">_len_list</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Length of list (estimate).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
     <span class="c1"># estimate over-allocation</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
       <span class="n">n</span> <span class="o">+=</span> <span class="mi">6</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span><span class="p">:</span>
       <span class="n">n</span> <span class="o">+=</span> <span class="mi">4</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="k">def</span> <span class="nf">_len_module</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Module length.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>  <span class="c1"># _len(dir(obj))</span>

<span class="k">def</span> <span class="nf">_len_set</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Length of frozen/set (estimate).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># assume half filled</span>
       <span class="n">n</span> <span class="o">=</span> <span class="n">_power2</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span><span class="p">:</span>  <span class="c1"># at least 8</span>
       <span class="n">n</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="k">def</span> <span class="nf">_len_slice</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Slice length.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">obj</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">obj</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">obj</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">_len_slots</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Slots length.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">_len_struct</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Struct length in bytes.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">size</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">_len_unicode</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Unicode size.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">_all_lengs</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_len</span><span class="p">,</span>        <span class="n">_len_array</span><span class="p">,</span>  <span class="n">_len_bytearray</span><span class="p">,</span>
                    <span class="n">_len_code</span><span class="p">,</span>   <span class="n">_len_dict</span><span class="p">,</span>   <span class="n">_len_frame</span><span class="p">,</span>
                    <span class="n">_len_int</span><span class="p">,</span>    <span class="n">_len_iter</span><span class="p">,</span>   <span class="n">_len_list</span><span class="p">,</span>
                    <span class="n">_len_module</span><span class="p">,</span> <span class="n">_len_set</span><span class="p">,</span>    <span class="n">_len_slice</span><span class="p">,</span>
                    <span class="n">_len_slots</span><span class="p">,</span>  <span class="n">_len_struct</span><span class="p">,</span> <span class="n">_len_unicode</span><span class="p">)</span>


<span class="c1"># more private functions and classes</span>

<span class="n">_old_style</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>  <span class="c1"># marker</span>
<span class="n">_new_style</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>   <span class="c1"># no marker</span>

<span class="k">class</span> <span class="nc">_Claskey</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Wrapper for class objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_obj&#39;</span><span class="p">,</span> <span class="s1">&#39;_sty&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c1"># XXX Weakref.ref(obj)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sty</span> <span class="o">=</span> <span class="n">style</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1"> def&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sty</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sty</span> <span class="ow">is</span> <span class="n">_old_style</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;class &#39;</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39;class </span><span class="si">%s%s</span><span class="s1"> def&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sty</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1"> def&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sty</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="n">__repr__</span> <span class="o">=</span> <span class="n">__str__</span>

 <span class="c1"># For most objects, the object type is used as the key in the</span>
 <span class="c1"># _typedefs dict further below, except class and type objects</span>
 <span class="c1"># and old-style instances.  Those are wrapped with separate</span>
 <span class="c1"># _Claskey or _Instkey instances to be able (1) to distinguish</span>
 <span class="c1"># instances of different old-style classes by class, (2) to</span>
 <span class="c1"># distinguish class (and type) instances from class (and type)</span>
 <span class="c1"># definitions for new-style classes and (3) provide similar</span>
 <span class="c1"># results for repr() and str() of new- and old-style classes</span>
 <span class="c1"># and instances.</span>

<span class="n">_claskeys</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># [id(obj)] = _Claskey()</span>

<span class="k">def</span> <span class="nf">_claskey</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Wrap an old- or new-style class object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">i</span> <span class="o">=</span>  <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">_claskeys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="p">:</span>
        <span class="n">_claskeys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">=</span> <span class="n">_Claskey</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># no Class- and InstanceType in Python 3.0</span>
    <span class="n">_Types_ClassType</span>    <span class="o">=</span> <span class="n">Types</span><span class="o">.</span><span class="n">ClassType</span>
    <span class="n">_Types_InstanceType</span> <span class="o">=</span> <span class="n">Types</span><span class="o">.</span><span class="n">InstanceType</span>

    <span class="k">class</span> <span class="nc">_Instkey</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Wrapper for old-style class (instances).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_obj&#39;</span><span class="p">,)</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c1"># XXX Weakref.ref(obj)</span>

        <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;class </span><span class="si">%s</span><span class="s1">.</span><span class="si">%s%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">_old_style</span><span class="p">)</span>
        <span class="n">__repr__</span> <span class="o">=</span> <span class="n">__str__</span>

    <span class="n">_instkeys</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># [id(obj)] = _Instkey()</span>

    <span class="k">def</span> <span class="nf">_instkey</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Wrap an old-style class (instance).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">i</span> <span class="o">=</span>  <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">_instkeys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">_instkeys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">=</span> <span class="n">_Instkey</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">_keytuple</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return class and instance keys for a class.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="n">_Types_InstanceType</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span>
            <span class="k">return</span> <span class="n">_claskey</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">_old_style</span><span class="p">),</span> <span class="n">_instkey</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="ow">is</span> <span class="n">_Types_ClassType</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_claskey</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_old_style</span><span class="p">),</span> <span class="n">_instkey</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="ow">is</span> <span class="n">_Type_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_claskey</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_new_style</span><span class="p">),</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># not a class</span>

    <span class="k">def</span> <span class="nf">_objkey</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the key for any object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="n">_Types_InstanceType</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">_instkey</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="ow">is</span> <span class="n">_Types_ClassType</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">_claskey</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_old_style</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="ow">is</span> <span class="n">_Type_type</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">_claskey</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_new_style</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k</span>

<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># Python 3.0</span>

    <span class="k">def</span> <span class="nf">_keytuple</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1">#PYCHOK expected</span>
        <span class="sd">&#39;&#39;&#39;Return class and instance keys for a class.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="n">_Type_type</span><span class="p">:</span>  <span class="c1"># isclass(obj):</span>
            <span class="k">return</span> <span class="n">_claskey</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_new_style</span><span class="p">),</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># not a class</span>

    <span class="k">def</span> <span class="nf">_objkey</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1">#PYCHOK expected</span>
        <span class="sd">&#39;&#39;&#39;Return the key for any object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="n">_Type_type</span><span class="p">:</span>  <span class="c1"># isclass(obj):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">_claskey</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_new_style</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k</span>

<span class="k">class</span> <span class="nc">_NamedRef</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Store referred object along</span>
<span class="sd">       with the name of the referent.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="s1">&#39;typ&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref</span>  <span class="o">=</span> <span class="n">ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span>  <span class="o">=</span> <span class="n">typ</span>  <span class="c1"># see Asized.format</span>

<span class="k">class</span> <span class="nc">_Slots</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Wrapper class for __slots__ attribute at</span>
<span class="sd">       class instances to account for the size</span>
<span class="sd">       of the __slots__ tuple/list containing</span>
<span class="sd">       references to the attribute values.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>

 <span class="c1"># kinds of _Typedefs</span>
<span class="n">_i</span> <span class="o">=</span> <span class="n">_intern</span>
<span class="n">_all_kinds</span> <span class="o">=</span> <span class="p">(</span><span class="n">_kind_static</span><span class="p">,</span> <span class="n">_kind_dynamic</span><span class="p">,</span> <span class="n">_kind_derived</span><span class="p">,</span> <span class="n">_kind_ignored</span><span class="p">,</span> <span class="n">_kind_inferred</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">_i</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">),</span> <span class="n">_i</span><span class="p">(</span><span class="s1">&#39;dynamic&#39;</span><span class="p">),</span> <span class="n">_i</span><span class="p">(</span><span class="s1">&#39;derived&#39;</span><span class="p">),</span> <span class="n">_i</span><span class="p">(</span><span class="s1">&#39;ignored&#39;</span><span class="p">),</span> <span class="n">_i</span><span class="p">(</span><span class="s1">&#39;inferred&#39;</span><span class="p">))</span>
<span class="k">del</span> <span class="n">_i</span>

<span class="k">class</span> <span class="nc">_Typedef</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Type definition class.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>     <span class="c1"># basic size in bytes</span>
        <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>     <span class="c1"># item size in bytes</span>
        <span class="s1">&#39;leng&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># or _len_...() function</span>
        <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># or _..._refs() function</span>
        <span class="s1">&#39;both&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># both data and code if True, code only if False</span>
        <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># _kind_... value</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># original type</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused</span><span class="p">):</span>  <span class="c1"># for Python 3.0</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n/a&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">both</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(code only)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># as args tuple</span>
        <span class="sd">&#39;&#39;&#39;Return all attributes as arguments tuple.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">leng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">both</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Duplicate attributes of dict or other typedef.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">_dict_typedef</span><span class="o">.</span><span class="n">kwds</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span>  <span class="n">other</span><span class="o">.</span><span class="n">kwds</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">flat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the aligned flat size.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leng</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># include items</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leng</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span>
        <span class="k">if</span> <span class="n">_getsizeof</span><span class="p">:</span>  <span class="c1"># _getsizeof prevails</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_getsizeof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>  <span class="c1"># align</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return format dict.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">both</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39; (code only)&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leng</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="s1">&#39; (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">_nameof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leng</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_kwds</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                     <span class="n">code</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>         <span class="n">kind</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">kwds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return all attributes as keywords dict.</span>
<span class="sd">        &#39;&#39;&#39;</span>
         <span class="c1"># no dict(refs=self.refs, ..., kind=self.kind) in Python 2.0</span>
        <span class="k">return</span> <span class="n">_kwds</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">,</span>
                     <span class="n">leng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">leng</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span>
                     <span class="n">both</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">both</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">heap</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Save this typedef plus its class typedef.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">_keytuple</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_typedefs</span><span class="p">:</span>  <span class="c1"># instance key</span>
            <span class="n">_typedefs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_typedefs</span><span class="p">:</span>  <span class="c1"># class key</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">__module__</span> <span class="ow">in</span> <span class="n">_builtin_modules</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">_kind_ignored</span>  <span class="c1"># default</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span>
                <span class="n">_typedefs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Typedef</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">_basicsize</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">heap</span><span class="o">=</span><span class="n">heap</span><span class="p">),</span>
                                        <span class="n">refs</span><span class="o">=</span><span class="n">_type_refs</span><span class="p">,</span>
                                        <span class="n">both</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">isbuiltin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_typedefs</span><span class="p">:</span>  <span class="c1"># array, range, xrange in Python 2.x</span>
            <span class="n">_typedefs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Typedef</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">_basicsize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">),</span>
                                    <span class="n">both</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">_kind_ignored</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;asizeof typedef </span><span class="si">%r</span><span class="s1"> bad: </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">both</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safe_len</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set one or more attributes.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>  <span class="c1"># double check</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwds</span><span class="p">()</span>
            <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">safe_len</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leng</span> <span class="o">=</span> <span class="n">_len</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">both</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reset all specified attributes.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">base</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="n">base</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">if</span> <span class="n">leng</span> <span class="ow">in</span> <span class="n">_all_lengs</span><span class="p">:</span>  <span class="c1"># XXX or _callable(leng)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leng</span> <span class="o">=</span> <span class="n">leng</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;leng&#39;</span><span class="p">,</span> <span class="n">leng</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">_all_refs</span><span class="p">:</span>  <span class="c1"># XXX or _callable(refs)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refs</span> <span class="o">=</span> <span class="n">refs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;refs&#39;</span><span class="p">,</span> <span class="n">refs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">both</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">both</span> <span class="o">=</span> <span class="n">both</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">both</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="n">_all_kinds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;kind&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>

<span class="n">_typedefs</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># [key] = _Typedef()</span>

<span class="k">def</span> <span class="nf">_typedef_both</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">_kind_static</span><span class="p">,</span> <span class="n">heap</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Add new typedef for both data and code.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">_Typedef</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">_basicsize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">),</span> <span class="n">item</span><span class="o">=</span><span class="n">_itemsize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">item</span><span class="p">),</span>
                 <span class="n">refs</span><span class="o">=</span><span class="n">refs</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">leng</span><span class="p">,</span>
                 <span class="n">both</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="n">v</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">heap</span><span class="o">=</span><span class="n">heap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>  <span class="c1"># for _dict_typedef</span>

<span class="k">def</span> <span class="nf">_typedef_code</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">_kind_static</span><span class="p">,</span> <span class="n">heap</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Add new typedef for code only.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">_Typedef</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">_basicsize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">),</span>
                 <span class="n">refs</span><span class="o">=</span><span class="n">refs</span><span class="p">,</span>
                 <span class="n">both</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="n">v</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">heap</span><span class="o">=</span><span class="n">heap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>  <span class="c1"># for _dict_typedef</span>

 <span class="c1"># static typedefs for data and code types</span>
<span class="n">_typedef_both</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">_typedef_both</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">_typedef_both</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span>     <span class="n">refs</span><span class="o">=</span><span class="n">_seq_refs</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_list</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cvoidp</span><span class="p">)</span>  <span class="c1"># sizeof(PyObject*)</span>
<span class="n">_typedef_both</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span>    <span class="n">refs</span><span class="o">=</span><span class="n">_seq_refs</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len</span><span class="p">,</span>      <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cvoidp</span><span class="p">)</span>  <span class="c1"># sizeof(PyObject*)</span>
<span class="n">_typedef_both</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_prop_refs</span><span class="p">)</span>
<span class="n">_typedef_both</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">Ellipsis</span><span class="p">))</span>
<span class="n">_typedef_both</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>

 <span class="c1"># _Slots is a special tuple, see _Slots.__doc__</span>
<span class="n">_typedef_both</span><span class="p">(</span><span class="n">_Slots</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cvoidp</span><span class="p">,</span>
                      <span class="n">leng</span><span class="o">=</span><span class="n">_len_slots</span><span class="p">,</span>  <span class="c1"># length less one</span>
                      <span class="n">refs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># but no referents</span>
                      <span class="n">heap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># plus head</span>

 <span class="c1"># dict, dictproxy, dict_proxy and other dict-like types</span>
<span class="n">_dict_typedef</span> <span class="o">=</span> <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span>        <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_CPyDictEntry</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_dict</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_dict_refs</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>  <span class="c1"># &lt;type dictproxy&gt; only in Python 2.x</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DictProxyType</span><span class="p">,</span>     <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_CPyDictEntry</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_dict</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_dict_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># XXX any class __dict__ is &lt;type dict_proxy&gt; in Python 3.0?</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_Typedef</span><span class="o">.</span><span class="n">__dict__</span><span class="p">),</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_CPyDictEntry</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_dict</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_dict_refs</span><span class="p">)</span>
 <span class="c1"># other dict-like classes and types may be derived or inferred,</span>
 <span class="c1"># provided the module and class name is listed here (see functions</span>
 <span class="c1"># adict, _isdictclass and _infer_dict for further details)</span>
<span class="n">_dict_classes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;UserDict&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;IterableUserDict&#39;</span><span class="p">,</span>  <span class="s1">&#39;UserDict&#39;</span><span class="p">),</span>
                 <span class="s1">&#39;weakref&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="s1">&#39;WeakKeyDictionary&#39;</span><span class="p">,</span> <span class="s1">&#39;WeakValueDictionary&#39;</span><span class="p">)}</span>
<span class="k">try</span><span class="p">:</span>  <span class="c1"># &lt;type module&gt; is essentially a dict</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">_dict_typedef</span><span class="o">.</span><span class="n">base</span><span class="p">,</span>
                                    <span class="n">item</span><span class="o">=</span><span class="n">_dict_typedef</span><span class="o">.</span><span class="n">item</span> <span class="o">+</span> <span class="n">_sizeof_CPyModuleObject</span><span class="p">,</span>
                                    <span class="n">leng</span><span class="o">=</span><span class="n">_len_module</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_module_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

 <span class="c1"># newer or obsolete types</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="k">import</span> <span class="n">array</span>  <span class="c1"># array type</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_array</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cbyte</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># bool has non-zero __itemsize__ in 3.0</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># ignore basestring</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">basestring</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">isbuiltin</span><span class="p">(</span><span class="n">buffer</span><span class="p">):</span>  <span class="c1"># Python 2.2</span>
        <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">buffer</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)),</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cbyte</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len</span><span class="p">)</span>  <span class="c1"># XXX len in bytes?</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_typedef_both</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span>           <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cbyte</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len</span><span class="p">)</span>  <span class="c1"># XXX len in bytes?</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cbyte</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_bytearray</span><span class="p">)</span>  <span class="c1">#PYCHOK bytearray new in 2.6, 3.0</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>  <span class="c1"># bytes is str in 2.6 #PYCHOK bytes new in 2.6, 3.0</span>
      <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cbyte</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len</span><span class="p">)</span>  <span class="c1">#PYCHOK bytes new in 2.6, 3.0</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>  <span class="c1"># XXX like bytes</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">str8</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cbyte</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len</span><span class="p">)</span>  <span class="c1">#PYCHOK str8 new in 2.6, 3.0</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_enum_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># Exception is type in Python 3.0</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_exc_refs</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>  <span class="c1">#PYCHOK OK</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_file_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Csetentry</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_set</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_seq_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span>       <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Csetentry</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_set</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_seq_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># not callable()</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">GetSetDescriptorType</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># if long exists, it is multi-precision ...</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cdigit</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_int</span><span class="p">)</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># ... and int is fixed size</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># no long, only multi-precision int in Python 3.0</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span>  <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cdigit</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_int</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># not callable()</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">MemberDescriptorType</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">NotImplemented</span><span class="p">))</span>  <span class="c1"># == Types.NotImplementedType</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">range</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">reversed</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_enum_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">slice</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cvoidp</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_slice</span><span class="p">)</span>  <span class="c1"># XXX worst-case itemsize?</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">curdir</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">statvfs</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">stat</span><span class="p">(</span>   <span class="n">curdir</span><span class="p">)),</span> <span class="n">refs</span><span class="o">=</span><span class="n">_stat_refs</span><span class="p">)</span>     <span class="c1"># stat_result</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">statvfs</span><span class="p">(</span><span class="n">curdir</span><span class="p">)),</span> <span class="n">refs</span><span class="o">=</span><span class="n">_statvfs_refs</span><span class="p">,</span>  <span class="c1"># statvfs_result</span>
                                         <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cvoidp</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">struct</span> <span class="k">import</span> <span class="n">Struct</span>  <span class="c1"># only in Python 2.5 and 3.0</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">Struct</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cbyte</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_struct</span><span class="p">)</span>  <span class="c1"># len in bytes</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">TracebackType</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_tb_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_unicode</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cunicode</span><span class="p">)</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span>     <span class="n">leng</span><span class="o">=</span><span class="n">_len</span><span class="p">,</span>         <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cbyte</span><span class="p">)</span>  <span class="c1"># 1-byte char</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># str is unicode</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span>     <span class="n">leng</span><span class="o">=</span><span class="n">_len_unicode</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cunicode</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># &lt;type &#39;KeyedRef&#39;&gt;</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">Weakref</span><span class="o">.</span><span class="n">KeyedRef</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_weak_refs</span><span class="p">,</span> <span class="n">heap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># plus head</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># &lt;type &#39;weakproxy&#39;&gt;</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">Weakref</span><span class="o">.</span><span class="n">ProxyType</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># &lt;type &#39;weakref&#39;&gt;</span>
    <span class="n">_typedef_both</span><span class="p">(</span><span class="n">Weakref</span><span class="o">.</span><span class="n">ReferenceType</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_weak_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

 <span class="c1"># some other, callable types</span>
<span class="n">_typedef_code</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span>     <span class="n">kind</span><span class="o">=</span><span class="n">_kind_ignored</span><span class="p">)</span>
<span class="n">_typedef_code</span><span class="p">(</span><span class="nb">super</span><span class="p">,</span>      <span class="n">kind</span><span class="o">=</span><span class="n">_kind_ignored</span><span class="p">)</span>
<span class="n">_typedef_code</span><span class="p">(</span><span class="n">_Type_type</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">_kind_ignored</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_code</span><span class="p">(</span><span class="nb">classmethod</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_im_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_code</span><span class="p">(</span><span class="nb">staticmethod</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_im_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">_typedef_code</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_im_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># generator, code only, no len(), not callable()</span>
    <span class="n">_typedef_code</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">GeneratorType</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_gen_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># &lt;type &#39;weakcallableproxy&#39;&gt;</span>
    <span class="n">_typedef_code</span><span class="p">(</span><span class="n">Weakref</span><span class="o">.</span><span class="n">CallableProxyType</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_weak_refs</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>

 <span class="c1"># any type-specific iterators</span>
<span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">_items</span><span class="p">({}),</span> <span class="n">_keys</span><span class="p">({}),</span> <span class="n">_values</span><span class="p">({})]</span>
<span class="k">try</span><span class="p">:</span>  <span class="c1"># reversed list and tuples iterators</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">reversed</span><span class="p">([]),</span> <span class="nb">reversed</span><span class="p">(())])</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>  <span class="c1"># range iterator</span>
    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>  <span class="c1"># callable-iterator</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="k">import</span> <span class="n">finditer</span>
    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># missing</span>
    <span class="k">pass</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_values</span><span class="p">(</span><span class="n">_typedefs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">leng</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># create an (empty) instance</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">type</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">_typedef_both</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">leng</span><span class="o">=</span><span class="n">_len_iter</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">_iter_refs</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># no itemsize!</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>  <span class="c1"># ignore non-iterables, duplicates, etc.</span>
        <span class="k">pass</span>
<span class="k">del</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span>


<span class="k">def</span> <span class="nf">_typedef</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">derive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">infer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create a new typedef for an object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">t</span> <span class="o">=</span>  <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">_Typedef</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">_basicsize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">),</span>
                 <span class="n">kind</span><span class="o">=</span><span class="n">_kind_dynamic</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
  <span class="c1">##_printf(&#39;new %r %r/%r %s&#39;, t, _basicsize(t), _itemsize(t), _repr(dir(obj)))</span>
    <span class="k">if</span> <span class="n">ismodule</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1"># handle module like dict</span>
        <span class="n">v</span><span class="o">.</span><span class="n">dup</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">_dict_typedef</span><span class="o">.</span><span class="n">item</span> <span class="o">+</span> <span class="n">_sizeof_CPyModuleObject</span><span class="p">,</span>
              <span class="n">leng</span><span class="o">=</span><span class="n">_len_module</span><span class="p">,</span>
              <span class="n">refs</span><span class="o">=</span><span class="n">_module_refs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">isframe</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">_basicsize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">_sizeof_CPyFrameObject</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">),</span>
              <span class="n">item</span><span class="o">=</span><span class="n">_itemsize</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
              <span class="n">leng</span><span class="o">=</span><span class="n">_len_frame</span><span class="p">,</span>
              <span class="n">refs</span><span class="o">=</span><span class="n">_frame_refs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">iscode</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">_basicsize</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">_sizeof_CPyCodeObject</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">),</span>
              <span class="n">item</span><span class="o">=</span><span class="n">_sizeof_Cvoidp</span><span class="p">,</span>
              <span class="n">leng</span><span class="o">=</span><span class="n">_len_code</span><span class="p">,</span>
              <span class="n">refs</span><span class="o">=</span><span class="n">_co_refs</span><span class="p">,</span>
              <span class="n">both</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># code only</span>
    <span class="k">elif</span> <span class="n">_callable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1"># class or type</span>
            <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">refs</span><span class="o">=</span><span class="n">_class_refs</span><span class="p">,</span>
                  <span class="n">both</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># code only</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">__module__</span> <span class="ow">in</span> <span class="n">_builtin_modules</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">_kind_ignored</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">isbuiltin</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1"># function or method</span>
            <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">both</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># code only</span>
                  <span class="n">kind</span><span class="o">=</span><span class="n">_kind_ignored</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">refs</span><span class="o">=</span><span class="n">_func_refs</span><span class="p">,</span>
                  <span class="n">both</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># code only</span>
        <span class="k">elif</span> <span class="n">ismethod</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">refs</span><span class="o">=</span><span class="n">_im_refs</span><span class="p">,</span>
                  <span class="n">both</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># code only</span>
        <span class="k">elif</span> <span class="n">isclass</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>  <span class="c1"># callable instance, e.g. SCons,</span>
             <span class="c1"># handle like any other instance further below</span>
            <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">_itemsize</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">safe_len</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">refs</span><span class="o">=</span><span class="n">_inst_refs</span><span class="p">)</span>  <span class="c1"># not code only!</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">both</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># code only</span>
    <span class="k">elif</span> <span class="n">_issubclass</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">v</span><span class="o">.</span><span class="n">dup</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">_kind_derived</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">_isdictclass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">infer</span> <span class="ow">and</span> <span class="n">_infer_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">)):</span>
        <span class="n">v</span><span class="o">.</span><span class="n">dup</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">_kind_inferred</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__module__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_builtin_modules</span><span class="p">:</span>
        <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">_kind_ignored</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># assume an instance of some class</span>
        <span class="k">if</span> <span class="n">derive</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">_derive_typedef</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>  <span class="c1"># duplicate parent</span>
                <span class="n">v</span><span class="o">.</span><span class="n">dup</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">_kind_derived</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">v</span>
        <span class="k">if</span> <span class="n">_issubclass</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">_itemsize</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">safe_len</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">refs</span><span class="o">=</span><span class="n">_exc_refs</span><span class="p">,</span>
                  <span class="n">kind</span><span class="o">=</span><span class="n">_kind_derived</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">_itemsize</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">safe_len</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">refs</span><span class="o">=</span><span class="n">_exc_refs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">_itemsize</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">safe_len</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">refs</span><span class="o">=</span><span class="n">_inst_refs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>


<span class="k">class</span> <span class="nc">_Prof</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Internal type profile class.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">total</span>  <span class="o">=</span> <span class="mi">0</span>     <span class="c1"># total size</span>
    <span class="n">high</span>   <span class="o">=</span> <span class="mi">0</span>     <span class="c1"># largest size</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span>     <span class="c1"># number of (unique) objects</span>
    <span class="n">objref</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># largest object (weakref)</span>
    <span class="n">weak</span>   <span class="o">=</span> <span class="kc">False</span> <span class="c1"># objref is weakref(object)</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">total</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">total</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">number</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">number</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">+</span><span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>  <span class="c1"># for Python 3.0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">grand</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return format dict.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># avg., plural</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="s1">&#39;s&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objref</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weak</span><span class="p">:</span>  <span class="c1"># weakref&#39;d</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">_SI2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grand</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="s1">&#39; (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">_p100</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span> <span class="n">grand</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_kwds</span><span class="p">(</span><span class="n">avg</span><span class="o">=</span><span class="n">_SI2</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>         <span class="n">high</span><span class="o">=</span><span class="n">_SI2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">),</span>
                     <span class="n">lengstr</span><span class="o">=</span><span class="n">_lengstr</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">obj</span><span class="o">=</span><span class="n">_repr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="n">clip</span><span class="p">),</span>
                     <span class="n">plural</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>            <span class="n">total</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Update this profile.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span>  <span class="o">+=</span> <span class="n">size</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>  <span class="c1"># largest</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">size</span>
           <span class="k">try</span><span class="p">:</span>  <span class="c1"># prefer using weak ref</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">objref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weak</span> <span class="o">=</span> <span class="n">Weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="kc">True</span>
           <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">objref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weak</span> <span class="o">=</span> <span class="n">obj</span><span class="p">,</span> <span class="kc">False</span>


 <span class="c1"># public classes</span>

<div class="viewcode-block" id="Asized"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asized">[docs]</a><span class="k">class</span> <span class="nc">Asized</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Store the results of an  asized object</span>
<span class="sd">       in these 4 attributes:</span>

<span class="sd">       :size: total size of the object</span>
<span class="sd">       :flat: flat size of the object</span>
<span class="sd">       :name: name or repr of the object</span>
<span class="sd">       :refs: tuple containing an instance</span>
<span class="sd">              of  Asized for each referent</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">strf</span> <span class="o">=</span> <span class="p">(</span>    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># default name format</span>
            <span class="s1">&#39;[K] </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># dict key, see _dict_refs</span>
            <span class="s1">&#39;[V] </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># dict value, see _dict_refs</span>

<div class="viewcode-block" id="Asized.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asized.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">flat</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>  <span class="c1"># total size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flat</span> <span class="o">=</span> <span class="n">flat</span>  <span class="c1"># flat size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1"># name, repr or None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asized.__str__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asized.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;size </span><span class="si">%r</span><span class="s1">, flat </span><span class="si">%r</span><span class="s1">, refs[</span><span class="si">%d</span><span class="s1">], name </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asized.format"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asized.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">named</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Format name from _NamedRef instance.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">strf</span><span class="p">[</span><span class="n">named</span><span class="o">.</span><span class="n">typ</span><span class="p">]</span> <span class="o">%</span> <span class="n">named</span><span class="o">.</span><span class="n">name</span></div></div>

<div class="viewcode-block" id="Asizer"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer">[docs]</a><span class="k">class</span> <span class="nc">Asizer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Sizer state and options.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_align_</span>    <span class="o">=</span> <span class="mi">8</span>
    <span class="n">_all_</span>      <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_clip_</span>     <span class="o">=</span> <span class="mi">80</span>
    <span class="n">_code_</span>     <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_derive_</span>   <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_detail_</span>   <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for Asized only</span>
    <span class="n">_infer_</span>    <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_limit_</span>    <span class="o">=</span> <span class="mi">100</span>
    <span class="n">_stats_</span>    <span class="o">=</span> <span class="mi">0</span>

    <span class="n">_cutoff</span>    <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># in percent</span>
    <span class="n">_depth</span>     <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># recursion depth</span>
    <span class="n">_duplicate</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_excl_d</span>    <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># {}</span>
    <span class="n">_ign_d</span>     <span class="o">=</span> <span class="n">_kind_ignored</span>
    <span class="n">_incl</span>      <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># or &#39; (incl. code)&#39;</span>
    <span class="n">_mask</span>      <span class="o">=</span> <span class="mi">7</span>   <span class="c1"># see _align_</span>
    <span class="n">_missed</span>    <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># due to errors</span>
    <span class="n">_profile</span>   <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_profs</span>     <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># {}</span>
    <span class="n">_seen</span>      <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># {}</span>
    <span class="n">_total</span>     <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># total size</span>

<div class="viewcode-block" id="Asizer.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;See method  reset for the available options.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_excl_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer._clear"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._clear">[docs]</a>    <span class="k">def</span> <span class="nf">_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Clear state.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_</span>      <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span>     <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># recursion depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duplicate</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_incl</span>      <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># or &#39; (incl. code)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_missed</span>    <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># due to errors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span>   <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profs</span>     <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span>      <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total</span>     <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># total size</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_excl_d</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_excl_d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Asizer._nameof"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._nameof">[docs]</a>    <span class="k">def</span> <span class="nf">_nameof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the object&#39;s name.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_nameof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer._prepr"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._prepr">[docs]</a>    <span class="k">def</span> <span class="nf">_prepr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Like prepr().</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_prepr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_clip_</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer._prof"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._prof">[docs]</a>    <span class="k">def</span> <span class="nf">_prof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get _Prof object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_profs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span> <span class="o">=</span> <span class="n">_Prof</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="Asizer._repr"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._repr">[docs]</a>    <span class="k">def</span> <span class="nf">_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Like repr().</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_clip_</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer._sizer"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._sizer">[docs]</a>    <span class="k">def</span> <span class="nf">_sizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">sized</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Size an object, recursively.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
         <span class="c1"># skip obj if seen before</span>
         <span class="c1"># or if ref of a given obj</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">sized</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">sized</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nameof</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">_objkey</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_excl_d</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_excl_d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">_typedefs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>  <span class="c1"># new typedef</span>
                    <span class="n">_typedefs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">=</span> <span class="n">_typedef</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">derive</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_derive_</span><span class="p">,</span>
                                                     <span class="n">infer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_infer_</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">both</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_code_</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ign_d</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">f</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">flat</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">)</span>  <span class="c1"># flat size</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="p">:</span>  <span class="c1"># profile type</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                     <span class="c1"># recurse, but not for nested modules</span>
                    <span class="k">if</span> <span class="n">deep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit_</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">deep</span> <span class="ow">and</span> <span class="n">ismodule</span><span class="p">(</span><span class="n">obj</span><span class="p">)):</span>
                         <span class="c1"># add sizes of referents</span>
                        <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sizer</span><span class="p">,</span> <span class="n">deep</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_</span><span class="p">:</span>  <span class="c1"># use &#39;all&#39; referents</span>
                            <span class="n">r</span> <span class="o">=</span> <span class="n">_getreferents</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                                <span class="n">t</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>  <span class="c1"># no sum(&lt;generator_expression&gt;) in Python 2.2</span>
                                        <span class="n">s</span> <span class="o">+=</span> <span class="n">z</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>  <span class="c1"># exclude container</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>  <span class="c1"># no sum(&lt;generator_expression&gt;) in Python 2.2</span>
                                        <span class="n">s</span> <span class="o">+=</span> <span class="n">z</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">r</span><span class="p">:</span>  <span class="c1"># and _callable(r):</span>
                            <span class="k">if</span> <span class="n">sized</span> <span class="ow">and</span> <span class="n">deep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detail_</span><span class="p">:</span>
                                  <span class="c1"># use named referents</span>
                                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">r</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">_NamedRef</span><span class="p">):</span>
                                        <span class="n">t</span> <span class="o">=</span> <span class="n">z</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">sized</span><span class="p">)</span>
                                        <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">t</span> <span class="o">=</span> <span class="n">z</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">sized</span><span class="p">)</span>
                                        <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nameof</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                                    <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                                    <span class="n">s</span> <span class="o">+=</span> <span class="n">t</span><span class="o">.</span><span class="n">size</span>
                            <span class="k">else</span><span class="p">:</span>  <span class="c1"># no sum(&lt;generator_expression&gt;) in Python 2.2</span>
                                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">r</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                                    <span class="n">s</span> <span class="o">+=</span> <span class="n">z</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                         <span class="c1"># recursion depth</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">:</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>  <span class="c1"># XXX RecursionLimitExceeded:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_missed</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">sized</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sized</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nameof</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">refs</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="Asizer._sizes"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._sizes">[docs]</a>    <span class="k">def</span> <span class="nf">_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="n">sized</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the size or an Asized instance for each</span>
<span class="sd">           given object and the total size.  The total</span>
<span class="sd">           includes the size of duplicates only once.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_refs</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">)</span>  <span class="c1"># skip refs to objs</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>  <span class="c1"># duplicate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_duplicate</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sizer</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sized</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sized</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_values</span><span class="p">(</span><span class="n">s</span><span class="p">)])</span>  <span class="c1"># [] for Python 2.2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_sum</span><span class="p">(</span><span class="n">_values</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total</span> <span class="o">+=</span> <span class="n">s</span>  <span class="c1"># accumulate</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer.asized"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.asized">[docs]</a>    <span class="k">def</span> <span class="nf">asized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Size each object and return an Asized instance with</span>
<span class="sd">           size information and referents up to the given detail</span>
<span class="sd">           level (and with modified options, see method  set).</span>

<span class="sd">           If only one object is given, the return value is the</span>
<span class="sd">           Asized instance for that object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sizes</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="n">Asized</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="Asizer.asizeof"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.asizeof">[docs]</a>    <span class="k">def</span> <span class="nf">asizeof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the combined size of the given objects</span>
<span class="sd">           (with modified options, see also method  set).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sizes</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="Asizer.asizesof"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.asizesof">[docs]</a>    <span class="k">def</span> <span class="nf">asizesof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the individual sizes of the given objects</span>
<span class="sd">           (with modified options, see also method  set).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sizes</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="Asizer.exclude_refs"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.exclude_refs">[docs]</a>    <span class="k">def</span> <span class="nf">exclude_refs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">objs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Exclude any references to the specified objects from sizing.</span>

<span class="sd">           While any references to the given objects are excluded, the</span>
<span class="sd">           objects will be sized if specified as positional arguments</span>
<span class="sd">           in subsequent calls to methods  asizeof and  asizesof.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer.exclude_types"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.exclude_types">[docs]</a>    <span class="k">def</span> <span class="nf">exclude_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">objs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Exclude the specified object instances and types from sizing.</span>

<span class="sd">           All instances and types of the given objects are excluded,</span>
<span class="sd">           even objects specified as positional arguments in subsequent</span>
<span class="sd">           calls to methods  asizeof and  asizesof.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_keytuple</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">t</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_excl_d</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_excl_d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Asizer.print_profiles"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.print_profiles">[docs]</a>    <span class="k">def</span> <span class="nf">print_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print the profiles above cutoff percentage.</span>

<span class="sd">               w=0            -- indentation for each line</span>
<span class="sd">               cutoff=0       -- minimum percentage printed</span>
<span class="sd">               print3options  -- print options, as in Python 3.0</span>
<span class="sd">        &#39;&#39;&#39;</span>
         <span class="c1"># get the profiles with non-zero size or count</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profs</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>  <span class="c1"># just show all</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profs</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39; (</span><span class="si">% o</span><span class="s1">f grand total)&#39;</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cutoff</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%*d</span><span class="s1"> profile</span><span class="si">%s</span><span class="s1">:  total</span><span class="si">%s</span><span class="s1">, average, and largest flat size</span><span class="si">%s</span><span class="s1">:  largest object&#39;</span><span class="p">,</span>
                     <span class="n">linesep</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">_plural</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span> <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incl</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_sorted</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;object</span><span class="si">%(plural)s</span><span class="s1">:  </span><span class="si">%(total)s</span><span class="s1">, </span><span class="si">%(avg)s</span><span class="s1">, </span><span class="si">%(high)s</span><span class="s1">:  </span><span class="si">%(obj)s%(lengstr)s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">v</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clip_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total</span><span class="p">)</span>
                <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepr</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">total</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cutoff</span><span class="p">)</span>
                    <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%+*d</span><span class="s1"> profiles below cutoff (</span><span class="si">%.0f%%</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="n">z</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%+*d</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> object</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;zero&#39;</span><span class="p">,</span> <span class="n">_plural</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer.print_stats"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.print_stats">[docs]</a>    <span class="k">def</span> <span class="nf">print_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objs</span><span class="o">=</span><span class="p">(),</span> <span class="n">opts</span><span class="o">=</span><span class="p">{},</span> <span class="n">sized</span><span class="o">=</span><span class="p">(),</span> <span class="n">sizes</span><span class="o">=</span><span class="p">(),</span> <span class="n">stats</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print the statistics.</span>

<span class="sd">               w=0            -- indentation for each line</span>
<span class="sd">               objs=()        -- optional, list of objects</span>
<span class="sd">               opts={}        -- optional, dict of options used</span>
<span class="sd">               sized=()       -- optional, tuple of  Asized instances returned</span>
<span class="sd">               sizes=()       -- optional, tuple of sizes returned</span>
<span class="sd">               stats=3.0      -- print statistics and cutoff percentage</span>
<span class="sd">               print3options  -- print options, as in Python 3.0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stats&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># print stats</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_missed</span> <span class="o">+</span> <span class="n">_sum</span><span class="p">(</span><span class="n">_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">))</span>
            <span class="n">w</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">_kwdstr</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">o</span> <span class="ow">and</span> <span class="n">objs</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span>
             <span class="c1"># print header line(s)</span>
            <span class="k">if</span> <span class="n">sized</span> <span class="ow">and</span> <span class="n">objs</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asized(...</span><span class="si">%s%s</span><span class="s1">) ...&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># no enumerate in Python 2.2.3</span>
                        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sized</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asized(</span><span class="si">%s</span><span class="s1">): </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">sized</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sizes</span> <span class="ow">and</span> <span class="n">objs</span><span class="p">:</span>
                <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizesof(...</span><span class="si">%s%s</span><span class="s1">) ...&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">z</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">objs</span><span class="p">):</span>
                    <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> bytes</span><span class="si">%s%s</span><span class="s1">:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">_SI</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">objs</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span>
                <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s%s%s</span><span class="s1">) ...&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
             <span class="c1"># print summary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">objs</span><span class="o">=</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># print profile</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_profiles</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># print typedefs</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_typedefs</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer.print_summary"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.print_summary">[docs]</a>    <span class="k">def</span> <span class="nf">print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">objs</span><span class="o">=</span><span class="p">(),</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print the summary statistics.</span>

<span class="sd">               w=0            -- indentation for each line</span>
<span class="sd">               objs=()        -- optional, list of objects</span>
<span class="sd">               print3options  -- print options, as in Python 3.0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> bytes</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total</span><span class="p">,</span> <span class="n">_SI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_total</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incl</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">:</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> byte aligned&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> byte sizeof(void*)&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">_sizeof_Cvoidp</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">objs</span> <span class="ow">or</span> <span class="p">())</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duplicate</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="s1">&#39;, </span><span class="si">%d</span><span class="s1"> duplicate&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duplicate</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> object</span><span class="si">%s</span><span class="s1"> given</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">_plural</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">_sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># [] for Python 2.2</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> object</span><span class="si">%s</span><span class="s1"> sized&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">_plural</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_excl_d</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">_sum</span><span class="p">(</span><span class="n">_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_excl_d</span><span class="p">))</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> object</span><span class="si">%s</span><span class="s1"> excluded&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">_plural</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">_sum</span><span class="p">(</span><span class="n">_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seen</span><span class="p">))</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> object</span><span class="si">%s</span><span class="s1"> seen&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">_plural</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_missed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> object</span><span class="si">%s</span><span class="s1"> missed&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_missed</span><span class="p">,</span> <span class="n">_plural</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_missed</span><span class="p">),</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*d</span><span class="s1"> recursion depth&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer.print_typedefs"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.print_typedefs">[docs]</a>    <span class="k">def</span> <span class="nf">print_typedefs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print the types and dict tables.</span>

<span class="sd">               w=0            -- indentation for each line</span>
<span class="sd">               print3options  -- print options, as in Python 3.0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_all_kinds</span><span class="p">:</span>
             <span class="c1"># XXX Python 3.0 doesn&#39;t sort type objects</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prepr</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="n">_typedefs</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">k</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">both</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_code_</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%*d</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> type</span><span class="si">%s</span><span class="s1">:  basicsize, itemsize, _len_(), _refs()&#39;</span><span class="p">,</span>
                         <span class="n">linesep</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">k</span><span class="p">,</span> <span class="n">_plural</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_sorted</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                    <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
         <span class="c1"># dict and dict-like classes</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">_sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_values</span><span class="p">(</span><span class="n">_dict_classes</span><span class="p">)])</span>  <span class="c1"># [] for Python 2.2</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%*d</span><span class="s1"> dict/-like classes:&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="n">_dict_classes</span><span class="p">):</span>
                <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%*s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepr</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="o">**</span><span class="n">print3opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="Asizer.set"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set some options.  Any options not set</span>
<span class="sd">           remain the same as the previous setting.</span>

<span class="sd">               align=8     -- size alignment</span>
<span class="sd">               code=False  -- incl. (byte)code size</span>
<span class="sd">               detail=0    -- Asized refs level</span>
<span class="sd">               limit=100   -- recursion limit</span>
<span class="sd">               stats=0.0   -- print statistics and cutoff percentage</span>
<span class="sd">        &#39;&#39;&#39;</span>
         <span class="c1"># adjust</span>
        <span class="k">if</span> <span class="n">align</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_align_</span> <span class="o">=</span> <span class="n">align</span>
            <span class="k">if</span> <span class="n">align</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">align</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">&amp;</span> <span class="n">align</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;align&#39;</span><span class="p">,</span> <span class="n">align</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_code_</span> <span class="o">=</span> <span class="n">code</span>
            <span class="k">if</span> <span class="n">code</span><span class="p">:</span>  <span class="c1"># incl. (byte)code</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_incl</span> <span class="o">=</span> <span class="s1">&#39; (incl. code)&#39;</span>
        <span class="k">if</span> <span class="n">detail</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_detail_</span> <span class="o">=</span> <span class="n">detail</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_limit_</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="k">if</span> <span class="n">stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stats_</span> <span class="o">=</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cutoff</span> <span class="o">=</span> <span class="p">(</span><span class="n">stats</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># profile types</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Asizer._get_duplicate"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._get_duplicate">[docs]</a>    <span class="k">def</span> <span class="nf">_get_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Number of duplicate objects.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duplicate</span></div>
    <span class="n">duplicate</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_duplicate</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">_get_duplicate</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>

<div class="viewcode-block" id="Asizer._get_missed"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._get_missed">[docs]</a>    <span class="k">def</span> <span class="nf">_get_missed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Number of objects missed due to errors.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_missed</span></div>
    <span class="n">missed</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_missed</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">_get_missed</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>

<div class="viewcode-block" id="Asizer._get_total"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer._get_total">[docs]</a>    <span class="k">def</span> <span class="nf">_get_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Total size accumulated so far.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total</span></div>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_total</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">_get_total</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>

<div class="viewcode-block" id="Asizer.reset"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.Asizer.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>  <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>    <span class="n">clip</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>     <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">derive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1">#PYCHOK expected</span>
                    <span class="n">detail</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignored</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">infer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="n">stats</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reset options, state, etc.</span>

<span class="sd">        The available options and default values are:</span>

<span class="sd">             align=8       -- size alignment</span>
<span class="sd">             all=False     -- all current GC objects and referents</span>
<span class="sd">             clip=80       -- clip repr() strings</span>
<span class="sd">             code=False    -- incl. (byte)code size</span>
<span class="sd">             derive=False  -- derive from super type</span>
<span class="sd">             detail=0      -- Asized refs level</span>
<span class="sd">             ignored=True  -- ignore certain types</span>
<span class="sd">             infer=False   -- try to infer types</span>
<span class="sd">             limit=100     -- recursion limit</span>
<span class="sd">             stats=0.0     -- print statistics and cutoff percentage</span>

<span class="sd">        See function  asizeof for a description of the options.</span>
<span class="sd">        &#39;&#39;&#39;</span>
         <span class="c1"># options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_align_</span>  <span class="o">=</span> <span class="n">align</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_</span>    <span class="o">=</span> <span class="nb">all</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clip_</span>   <span class="o">=</span> <span class="n">clip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_code_</span>   <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_derive_</span> <span class="o">=</span> <span class="n">derive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_detail_</span> <span class="o">=</span> <span class="n">detail</span>  <span class="c1"># for Asized only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_infer_</span>  <span class="o">=</span> <span class="n">infer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_limit_</span>  <span class="o">=</span> <span class="n">limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stats_</span>  <span class="o">=</span> <span class="n">stats</span>
        <span class="k">if</span> <span class="n">ignored</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ign_d</span> <span class="o">=</span> <span class="n">_kind_ignored</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ign_d</span> <span class="o">=</span> <span class="kc">None</span>
         <span class="c1"># clear state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">)</span></div></div>


 <span class="c1"># public functions</span>

<div class="viewcode-block" id="adict"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.adict">[docs]</a><span class="k">def</span> <span class="nf">adict</span><span class="p">(</span><span class="o">*</span><span class="n">classes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Install one or more classes to be handled as dict.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
         <span class="c1"># if class is dict-like, add class</span>
         <span class="c1"># name to _dict_classes[module]</span>
        <span class="k">if</span> <span class="n">isclass</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_infer_dict</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">_dict_classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="p">())</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>  <span class="c1"># extend tuple</span>
                <span class="n">_dict_classes</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">__module__</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">__name__</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># not a dict-like class</span>
            <span class="n">a</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">a</span>  <span class="c1"># all installed if True</span></div>

<span class="n">_asizer</span> <span class="o">=</span> <span class="n">Asizer</span><span class="p">()</span>

<div class="viewcode-block" id="asized"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.asized">[docs]</a><span class="k">def</span> <span class="nf">asized</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return a tuple containing an  Asized instance for each</span>
<span class="sd">       object passed as positional argment using the following</span>
<span class="sd">       options.</span>

<span class="sd">           align=8       -- size alignment</span>
<span class="sd">           all=False     -- all current GC objects and referents</span>
<span class="sd">           clip=80       -- clip repr() strings</span>
<span class="sd">           code=False    -- incl. (byte)code size</span>
<span class="sd">           derive=False  -- derive from super type</span>
<span class="sd">           detail=0      -- Asized refs level</span>
<span class="sd">           ignored=True  -- ignore certain types</span>
<span class="sd">           infer=False   -- try to infer types</span>
<span class="sd">           limit=100     -- recursion limit</span>
<span class="sd">           stats=0.0     -- print statistics and cutoff percentage</span>

<span class="sd">       If only one object is given, the return value is the Asized</span>
<span class="sd">       instance for that object.</span>

<span class="sd">       Set  detail to the desired referents level (recursion depth).</span>

<span class="sd">       See function  asizeof for descriptions of the other options.</span>

<span class="sd">       The length of the returned tuple matches the number of given</span>
<span class="sd">       objects, if more than one object is given.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">_objs</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">_asizer</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">_asizer</span><span class="o">.</span><span class="n">asized</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        <span class="n">_asizer</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">,</span> <span class="n">sized</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
        <span class="n">_asizer</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="asizeof"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.asizeof">[docs]</a><span class="k">def</span> <span class="nf">asizeof</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the combined size in bytes of all objects passed</span>
<span class="sd">       as positional argments.</span>

<span class="sd">       The available options and defaults are the following.</span>

<span class="sd">           align=8       -- size alignment</span>
<span class="sd">           all=False     -- all current GC objects and referents</span>
<span class="sd">           clip=80       -- clip ``repr()`` strings</span>
<span class="sd">           code=False    -- incl. (byte)code size</span>
<span class="sd">           derive=False  -- derive from super type</span>
<span class="sd">           ignored=True  -- ignore certain types</span>
<span class="sd">           infer=False   -- try to infer types</span>
<span class="sd">           limit=100     -- recursion limit</span>
<span class="sd">           stats=0.0     -- print statistics and cutoff percentage</span>

<span class="sd">       Set  align to a power of 2 to align sizes.  Any value less</span>
<span class="sd">       than 2 avoids size alignment.</span>

<span class="sd">       All current GC objects are sized if  all is True and if no</span>
<span class="sd">       positional arguments are supplied.  Also, if  all is True</span>
<span class="sd">       the GC referents are used instead of the limited ones.</span>

<span class="sd">       A positive  clip value truncates all repr() strings to at</span>
<span class="sd">       most  clip characters.</span>

<span class="sd">       The (byte)code size of callable objects like functions,</span>
<span class="sd">       methods, classes, etc. is included only if  code is True.</span>

<span class="sd">       If  derive is True, new types are handled like an existing</span>
<span class="sd">       (super) type provided there is one and only of those.</span>

<span class="sd">       By default, certain base types like object are ignored for</span>
<span class="sd">       sizing.  Set  ignored to False to force all ignored types</span>
<span class="sd">       in the size of objects.</span>

<span class="sd">       By default certain base types like object, super, etc. are</span>
<span class="sd">       ignored.  Set  ignored to False to include those.</span>

<span class="sd">       If  infer is True, new types are inferred from attributes</span>
<span class="sd">       (only implemented for dict types on callable attributes</span>
<span class="sd">       as get, has_key, items, keys and values).</span>

<span class="sd">       Set  limit to a positive value to accumulate the sizes of</span>
<span class="sd">       the referents of each object, recursively up to the limit.</span>
<span class="sd">       Using  limit zero returns the sum of the flat [1] sizes of</span>
<span class="sd">       the given objects.  High  limit values may cause runtime</span>
<span class="sd">       errors and miss objects for sizing.</span>

<span class="sd">       A positive value for  stats prints up to 8 statistics, (1)</span>
<span class="sd">       a summary of the number of objects sized and seen, (2) a</span>
<span class="sd">       simple profile of the sized objects by type and (3+) up to</span>
<span class="sd">       6 tables showing the static, dynamic, derived, ignored,</span>
<span class="sd">       inferred and dict types used, found respectively installed.</span>

<span class="sd">       The fractional part of the  stats value (x 100) is the cutoff</span>
<span class="sd">       percentage for simple profiles.  Objects below the cutoff</span>
<span class="sd">       value are not reported.</span>

<span class="sd">       [1] See the documentation of this module for the definition</span>
<span class="sd">           of flat size.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">_objs</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">_asizer</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">_asizer</span><span class="o">.</span><span class="n">asizeof</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        <span class="n">_asizer</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">)</span>
        <span class="n">_asizer</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="asizesof"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.asizesof">[docs]</a><span class="k">def</span> <span class="nf">asizesof</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return a tuple containing the size in bytes of all objects</span>
<span class="sd">       passed as positional argments using the following options.</span>

<span class="sd">           align=8       -- size alignment</span>
<span class="sd">           all=False     -- use GC objects and referents</span>
<span class="sd">           clip=80       -- clip ``repr()`` strings</span>
<span class="sd">           code=False    -- incl. (byte)code size</span>
<span class="sd">           derive=False  -- derive from super type</span>
<span class="sd">           ignored=True  -- ignore certain types</span>
<span class="sd">           infer=False   -- try to infer types</span>
<span class="sd">           limit=100     -- recursion limit</span>
<span class="sd">           stats=0.0     -- print statistics and cutoff percentage</span>

<span class="sd">       See function  asizeof for a description of the options.</span>

<span class="sd">       The length of the returned tuple equals the number of given</span>
<span class="sd">       objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">_objs</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">_asizer</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">_asizer</span><span class="o">.</span><span class="n">asizesof</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        <span class="n">_asizer</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">,</span> <span class="n">sizes</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
        <span class="n">_asizer</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">return</span> <span class="n">s</span></div>

<span class="k">def</span> <span class="nf">_typedefof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get the typedef for an object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">_objkey</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">_typedefs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>  <span class="c1"># new typedef</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">_typedef</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">_typedefs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">v</span>

<div class="viewcode-block" id="basicsize"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.basicsize">[docs]</a><span class="k">def</span> <span class="nf">basicsize</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the basic size of an object (in bytes).</span>

<span class="sd">       Valid options and defaults are</span>
<span class="sd">           derive=False  -- derive type from super type</span>
<span class="sd">           infer=False   -- try to infer types</span>
<span class="sd">           save=False    -- save typedef if new</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">_typedefof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">base</span>
    <span class="k">return</span> <span class="n">v</span></div>

<div class="viewcode-block" id="flatsize"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.flatsize">[docs]</a><span class="k">def</span> <span class="nf">flatsize</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the flat size of an object (in bytes),</span>
<span class="sd">       optionally aligned to a given power of 2.</span>

<span class="sd">       See function  basicsize for a description of</span>
<span class="sd">       the other options.  See the documentation of</span>
<span class="sd">       this module for the definition of flat size.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">_typedefof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">align</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">align</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">align</span> <span class="o">&amp;</span> <span class="n">m</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;align&#39;</span><span class="p">,</span> <span class="n">align</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">flat</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span></div>

<div class="viewcode-block" id="itemsize"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.itemsize">[docs]</a><span class="k">def</span> <span class="nf">itemsize</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the item size of an object (in bytes).</span>

<span class="sd">       See function  basicsize for a description of</span>
<span class="sd">       the options.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">_typedefof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">item</span>
    <span class="k">return</span> <span class="n">v</span></div>

<div class="viewcode-block" id="leng"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.leng">[docs]</a><span class="k">def</span> <span class="nf">leng</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the length of an object (in items).</span>

<span class="sd">       See function  basicsize for a description</span>
<span class="sd">       of the options.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">_typedefof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">leng</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">_callable</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span></div>

<div class="viewcode-block" id="refs"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.memory_profiling.html#pySPACE.tools.memory_profiling.refs">[docs]</a><span class="k">def</span> <span class="nf">refs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return (a generator for) specific referents of an</span>
<span class="sd">       object.</span>

<span class="sd">       If all is True return the GC referents.</span>

<span class="sd">       See function  basicsize for a description of the</span>
<span class="sd">       options.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">_typedefof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>  <span class="c1"># == True</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">_getreferents</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">refs</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">_callable</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span></div>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">argv</span><span class="p">,</span> <span class="n">MAX</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">getrecursionlimit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_print_asizeof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">infer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">),]</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="n">MAX</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="n">MAX</span><span class="p">,</span> <span class="kc">True</span><span class="p">)):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asizeof</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">infer</span><span class="o">=</span><span class="n">infer</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">))</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s2">&quot; asizeof(</span><span class="si">%s</span><span class="s2">) is </span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_functions</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span>
                              <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">unused</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof functions for </span><span class="si">%s</span><span class="s1"> ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(): </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; basicsize&#39;</span><span class="p">,</span> <span class="n">basicsize</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(): </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; itemsize&#39;</span><span class="p">,</span>  <span class="n">itemsize</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(): </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; leng&#39;</span><span class="p">,</span>      <span class="n">leng</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(): </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; refs&#39;</span><span class="p">,</span>     <span class="n">_repr</span><span class="p">(</span><span class="n">refs</span><span class="p">(</span><span class="n">obj</span><span class="p">)))</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(): </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; flatsize&#39;</span><span class="p">,</span>  <span class="n">flatsize</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">))</span>  <span class="c1"># , code=code</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(): </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; asized&#39;</span><span class="p">,</span>           <span class="n">asized</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="n">detail</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">))</span>
      <span class="c1">##_printf(&#39;%s(): %s&#39;, &#39;.asized&#39;,   _asizer.asized(obj, align=align, detail=detail, code=code, limit=limit))</span>

    <span class="k">def</span> <span class="nf">_bool</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;bool option expected: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">arg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_opts</span><span class="p">(</span><span class="o">*</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return True if any oof the given options</span>
<span class="sd">           was present in the command line arguments.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">opts</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s1">&#39;-im&#39;</span> <span class="ow">in</span> <span class="n">argv</span> <span class="ow">or</span> <span class="s1">&#39;-import&#39;</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">:</span>
         <span class="c1"># import and size modules given as args</span>

        <span class="k">def</span> <span class="nf">_aopts</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Get argv options as typed values.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;import&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">_bool</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">opts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;invalid option: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">opts</span><span class="p">,</span> <span class="n">i</span>

        <span class="n">opts</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">_aopts</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">derive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
            <span class="n">m</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s1">&#39;eval&#39;</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
                <span class="n">o</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">o</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">asizeof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">asizeof(</span><span class="si">%s</span><span class="s2">) is </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">_repr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;clip&#39;</span><span class="p">]),</span> <span class="n">s</span><span class="p">)</span>
            <span class="n">_print_functions</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;-help&#39;</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;-all&#39;</span><span class="p">:</span>               <span class="s1">&#39;all=True example&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-basic&#39;</span><span class="p">:</span>             <span class="s1">&#39;basic examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-C&#39;</span><span class="p">:</span>                 <span class="s1">&#39;Csizeof values&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-class&#39;</span><span class="p">:</span>             <span class="s1">&#39;class and instance examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-code&#39;</span><span class="p">:</span>              <span class="s1">&#39;code examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-dict&#39;</span><span class="p">:</span>              <span class="s1">&#39;dict and UserDict examples&#39;</span><span class="p">,</span>
           <span class="c1">##&#39;-gc&#39;:                &#39;gc examples&#39;,</span>
             <span class="s1">&#39;-gen[erator]&#39;</span><span class="p">:</span>       <span class="s1">&#39;generator examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-glob[als]&#39;</span><span class="p">:</span>         <span class="s1">&#39;globals examples, incl. asized()&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-h[elp]&#39;</span><span class="p">:</span>            <span class="s1">&#39;print this information&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-im[port] &lt;module&gt;&#39;</span><span class="p">:</span> <span class="s1">&#39;imported module example&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-int | -long&#39;</span><span class="p">:</span>       <span class="s1">&#39;int and long examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-iter[ator]&#39;</span><span class="p">:</span>        <span class="s1">&#39;iterator examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-loc[als]&#39;</span><span class="p">:</span>          <span class="s1">&#39;locals examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-pair[s]&#39;</span><span class="p">:</span>           <span class="s1">&#39;key pair examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-slots&#39;</span><span class="p">:</span>             <span class="s1">&#39;slots examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-stack&#39;</span><span class="p">:</span>             <span class="s1">&#39;stack examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-sys&#39;</span><span class="p">:</span>               <span class="s1">&#39;sys.modules examples&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-test&#39;</span><span class="p">:</span>              <span class="s1">&#39;test flatsize() vs sys.getsizeof()&#39;</span><span class="p">,</span>
             <span class="s1">&#39;-type[def]s&#39;</span><span class="p">:</span>        <span class="s1">&#39;type definitions&#39;</span><span class="p">,</span>
             <span class="s1">&#39;- | --&#39;</span><span class="p">:</span>             <span class="s1">&#39;all examples&#39;</span><span class="p">}</span>
        <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">_keys</span><span class="p">(</span><span class="n">d</span><span class="p">)])</span>  <span class="c1"># [] for Python 2.2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">_sorted</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%*s</span><span class="s1"> -- </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="n">d</span><span class="p">)])</span>  <span class="c1"># [] for Python 2.2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">     &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;usage: </span><span class="si">%s</span><span class="s1"> &lt;option&gt; ...</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">C</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
        <span class="n">_attr1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_attr2</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="n">D</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>  <span class="c1">#PYCHOK OK</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attr1</span> <span class="o">=</span> <span class="n">a1</span>  <span class="c1">#PYCHOK OK</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attr2</span> <span class="o">=</span> <span class="n">a2</span>  <span class="c1">#PYCHOK OK</span>

    <span class="k">class</span> <span class="nc">P</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="n">_p</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">def</span> <span class="nf">_get_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_p</span><span class="p">)</span>  <span class="c1">#PYCHOK OK</span>

    <span class="k">class</span> <span class="nc">O</span><span class="p">:</span>  <span class="c1"># old style</span>
        <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">b</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">class</span> <span class="nc">S</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  <span class="c1"># new style</span>
        <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">T</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-all&#39;</span><span class="p">):</span>  <span class="c1"># all=True example</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(limit=</span><span class="si">%s</span><span class="s1">, code=</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;MAX&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;all=True&#39;</span><span class="p">,</span> <span class="s1">&#39;-all&#39;</span><span class="p">)</span>
        <span class="n">asizeof</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-basic&#39;</span><span class="p">):</span>  <span class="c1"># basic examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">) for (limit, code) in </span><span class="si">%s</span><span class="s1"> ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&lt;basic_objects&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;((0, False), (MAX, False), (MAX, True))&#39;</span><span class="p">,</span> <span class="s1">&#39;-basic&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0e100</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span>
                  <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;abcdefg&#39;</span><span class="p">,</span>
                  <span class="p">{},</span> <span class="p">(),</span> <span class="p">[]):</span>
            <span class="n">_print_asizeof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">infer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-C&#39;</span><span class="p">):</span>  <span class="c1"># show all Csizeof values</span>
        <span class="n">_sizeof_Cdouble</span>  <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>  <span class="c1">#PYCHOK OK</span>
        <span class="n">_sizeof_Csize_t</span>  <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>  <span class="c1">#PYCHOK OK</span>
        <span class="n">_sizeof_Cssize_t</span> <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>  <span class="c1">#PYCHOK OK</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_sizeof_&#39;</span><span class="p">)]</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%d</span><span class="s1"> C sizes: (bytes) ... -C&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_sorted</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39; sizeof(</span><span class="si">%s</span><span class="s1">): </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;_sizeof_&#39;</span><span class="p">):],</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-class&#39;</span><span class="p">):</span>  <span class="c1"># class and instance examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">) for (limit, code) in </span><span class="si">%s</span><span class="s1"> ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&lt;non-callable&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;((0, False), (MAX, False), (MAX, True))&#39;</span><span class="p">,</span> <span class="s1">&#39;-class&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="n">C</span><span class="p">(),</span> <span class="n">C</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span>
                  <span class="n">D</span><span class="p">(),</span> <span class="n">D</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span>
                  <span class="n">E</span><span class="p">(),</span> <span class="n">E</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span>
                  <span class="n">P</span><span class="p">(),</span> <span class="n">P</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">P</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
                  <span class="n">O</span><span class="p">(),</span> <span class="n">O</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span>
                  <span class="n">S</span><span class="p">(),</span> <span class="n">S</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span>
                  <span class="n">S</span><span class="p">(),</span> <span class="n">S</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span>
                  <span class="n">T</span><span class="p">(),</span> <span class="n">T</span><span class="o">.</span><span class="n">__dict__</span><span class="p">):</span>
            <span class="n">_print_asizeof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">infer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-code&#39;</span><span class="p">):</span>  <span class="c1"># code examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">) for (limit, code) in </span><span class="si">%s</span><span class="s1"> ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&lt;callable&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;((0, False), (MAX, False), (MAX, True))&#39;</span><span class="p">,</span> <span class="s1">&#39;-code&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span>  <span class="c1"># classes are callable</span>
                  <span class="nb">type</span><span class="p">,</span>
                 <span class="n">_co_refs</span><span class="p">,</span> <span class="n">_dict_refs</span><span class="p">,</span> <span class="n">_inst_refs</span><span class="p">,</span> <span class="n">_len_int</span><span class="p">,</span> <span class="n">_seq_refs</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                <span class="p">(</span><span class="n">_co_refs</span><span class="p">,</span> <span class="n">_dict_refs</span><span class="p">,</span> <span class="n">_inst_refs</span><span class="p">,</span> <span class="n">_len_int</span><span class="p">,</span> <span class="n">_seq_refs</span><span class="p">),</span>
                 <span class="n">_typedefs</span><span class="p">):</span>
            <span class="n">_print_asizeof</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-dict&#39;</span><span class="p">):</span>  <span class="c1"># dict and UserDict examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">) for (limit, code) in </span><span class="si">%s</span><span class="s1"> ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&lt;Dicts&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;((0, False), (MAX, False), (MAX, True))&#39;</span><span class="p">,</span> <span class="s1">&#39;-dict&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">UserDict</span>  <span class="c1"># no UserDict in 3.0</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="n">UserDict</span><span class="o">.</span><span class="n">IterableUserDict</span><span class="p">(),</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">UserDict</span><span class="p">()):</span>
                <span class="n">_print_asizeof</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">class</span> <span class="nc">_Dict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">_Dict</span><span class="p">(),</span>
                  <span class="n">P</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span>  <span class="c1"># dictproxy</span>
                  <span class="n">Weakref</span><span class="o">.</span><span class="n">WeakKeyDictionary</span><span class="p">(),</span> <span class="n">Weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="p">(),</span>
                 <span class="n">_typedefs</span><span class="p">):</span>
            <span class="n">_print_asizeof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">infer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="c1">##if _opts(&#39;-gc&#39;):  # gc examples</span>
      <span class="c1">##_printf(&#39;%sasizeof(limit=%s, code=%s, *%s) ...&#39;, linesep, &#39;MAX&#39;, False, &#39;gc.garbage&#39;)</span>
      <span class="c1">##from gc import collect, garbage  # list()</span>
      <span class="c1">##asizeof(limit=MAX, code=False, stats=1, *garbage)</span>
      <span class="c1">##collect()</span>
      <span class="c1">##asizeof(limit=MAX, code=False, stats=2, *garbage)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-gen&#39;</span><span class="p">,</span> <span class="s1">&#39;-generator&#39;</span><span class="p">):</span>  <span class="c1"># generator examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">, code=</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&lt;generator&gt;&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;-gen[erator]&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">gen</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">i</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">gen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">gen</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">asizeof</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">asizeof</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">asizeof</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-glob&#39;</span><span class="p">,</span> <span class="s1">&#39;-globals&#39;</span><span class="p">):</span>  <span class="c1"># globals examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">, limit=</span><span class="si">%s</span><span class="s1">, code=</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;globals()&#39;</span><span class="p">,</span> <span class="s1">&#39;MAX&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;-glob[als]&#39;</span><span class="p">)</span>
        <span class="n">asizeof</span><span class="p">(</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">_print_functions</span><span class="p">(</span><span class="nb">globals</span><span class="p">(),</span> <span class="s1">&#39;globals()&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;-glob[als]&#39;</span><span class="p">)</span>

        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizesof(</span><span class="si">%s</span><span class="s1">, limit=</span><span class="si">%s</span><span class="s1">, code=</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;globals(), locals()&#39;</span><span class="p">,</span> <span class="s1">&#39;MAX&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;-glob[als]&#39;</span><span class="p">)</span>
        <span class="n">asizesof</span><span class="p">(</span><span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">asized</span><span class="p">(</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">align</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-int&#39;</span><span class="p">,</span> <span class="s1">&#39;-long&#39;</span><span class="p">):</span>  <span class="c1"># int and long examples</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_L5d</span>  <span class="o">=</span> <span class="n">long</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">64</span>
            <span class="n">_L17d</span> <span class="o">=</span> <span class="n">long</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">256</span>
            <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;&lt;int&gt;/&lt;long&gt;&#39;</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="n">_L5d</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">64</span>
            <span class="n">_L17d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">256</span>
            <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;&lt;int&gt;&#39;</span>

        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">, align=</span><span class="si">%s</span><span class="s1">, limit=</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;-int&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span>
                  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0e100</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span>
                  <span class="n">MAX</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">,</span> <span class="n">_L5d</span><span class="p">,</span> <span class="o">-</span><span class="n">_L5d</span><span class="p">,</span> <span class="n">_L17d</span><span class="p">,</span> <span class="o">-</span><span class="n">_L17d</span><span class="p">):</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s2">&quot; asizeof(</span><span class="si">%s</span><span class="s2">) is </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2"> + </span><span class="si">%s</span><span class="s2"> * </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">_repr</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">asizeof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                                         <span class="n">basicsize</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">leng</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">itemsize</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-iter&#39;</span><span class="p">,</span> <span class="s1">&#39;-iterator&#39;</span><span class="p">):</span>  <span class="c1"># iterator examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">, code=</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&lt;iterator&gt;&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;-iter[ator]&#39;</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="s1">&#39;0123456789&#39;</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">({})</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">_items</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">}))</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">_keys</span><span class="p">({</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">}))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">_values</span><span class="p">({</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="mi">6</span><span class="p">}))</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([])</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(())</span>
        <span class="n">asizesof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">asizesof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-loc&#39;</span><span class="p">,</span> <span class="s1">&#39;-locals&#39;</span><span class="p">):</span>  <span class="c1"># locals examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">, limit=</span><span class="si">%s</span><span class="s1">, code=</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;locals()&#39;</span><span class="p">,</span> <span class="s1">&#39;MAX&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;-loc[als]&#39;</span><span class="p">)</span>
        <span class="n">asizeof</span><span class="p">(</span><span class="nb">locals</span><span class="p">(),</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">_print_functions</span><span class="p">(</span><span class="nb">locals</span><span class="p">(),</span> <span class="s1">&#39;locals()&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;-loc[als]&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-pair&#39;</span><span class="p">,</span> <span class="s1">&#39;-pairs&#39;</span><span class="p">):</span>  <span class="c1"># key pair examples</span>
         <span class="c1"># &lt;http://jjinux.blogspot.com/2008/08/python-memory-conservation-tip.html&gt;</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">) vs asizeof(</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;dict[i][j]&#39;</span><span class="p">,</span> <span class="s1">&#39;dict[(i,j)]&#39;</span><span class="p">,</span> <span class="s1">&#39;-pair[s]&#39;</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">200</span>

        <span class="n">p</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># [i][j]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="n">q</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">asizeof</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># [(i,j)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="n">t</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">asizeof</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(dict[i][j]) is </span><span class="si">%s</span><span class="s1"> of asizeof(dict[(i,j)])&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">_p100</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-slots&#39;</span><span class="p">):</span>  <span class="c1"># slots examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">, code=</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&lt;__slots__&gt;&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;-slots&#39;</span><span class="p">)</span>
        <span class="k">class</span> <span class="nc">Old</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># m = None</span>
        <span class="k">class</span> <span class="nc">New</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,)</span>
        <span class="k">class</span> <span class="nc">Sub</span><span class="p">(</span><span class="n">New</span><span class="p">):</span>  <span class="c1">#PYCHOK OK</span>
            <span class="n">__slots__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>  <span class="c1"># duplicate!</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1">#PYCHOK OK</span>
                <span class="n">New</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
         <span class="c1"># basic instance sizes</span>
        <span class="n">o</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Old</span><span class="p">(),</span> <span class="n">New</span><span class="p">(),</span> <span class="n">Sub</span><span class="p">()</span>
        <span class="n">asizesof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
         <span class="c1"># with unique min attr size</span>
        <span class="n">o</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span>
        <span class="n">n</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
        <span class="n">s</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>
        <span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
        <span class="n">asizesof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
         <span class="c1"># with duplicate, intern&#39;ed, 1-char string attrs</span>
        <span class="n">o</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="n">n</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="n">s</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="n">asizesof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
         <span class="c1"># with larger attr size</span>
        <span class="n">o</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="o">*</span><span class="mi">1000</span>
        <span class="n">n</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span><span class="o">*</span><span class="mi">1000</span>
        <span class="n">s</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span><span class="o">*</span><span class="mi">1000</span>
        <span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="o">*</span><span class="mi">1000</span>
        <span class="n">asizesof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-stack&#39;</span><span class="p">):</span>  <span class="c1"># stack examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(</span><span class="si">%s</span><span class="s1">, limit=</span><span class="si">%s</span><span class="s1">, code=</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;stack(MAX)&#39;</span><span class="p">,</span> <span class="s1">&#39;MAX&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">asizeof</span><span class="p">(</span><span class="n">stack</span><span class="p">(</span><span class="n">MAX</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">_print_functions</span><span class="p">(</span><span class="n">stack</span><span class="p">(</span><span class="n">MAX</span><span class="p">),</span> <span class="s1">&#39;stack(MAX)&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;-stack&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-sys&#39;</span><span class="p">):</span>  <span class="c1"># sys.modules examples</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">asizeof(limit=</span><span class="si">%s</span><span class="s1">, code=</span><span class="si">%s</span><span class="s1">, *</span><span class="si">%s</span><span class="s1">) ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;MAX&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;sys.modules.values()&#39;</span><span class="p">,</span> <span class="s1">&#39;-sys&#39;</span><span class="p">)</span>
        <span class="n">asizeof</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">MAX</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">_print_functions</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">,</span> <span class="s1">&#39;sys.modules&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;-sys&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-type&#39;</span><span class="p">,</span> <span class="s1">&#39;-types&#39;</span><span class="p">,</span> <span class="s1">&#39;-typedefs&#39;</span><span class="p">):</span>  <span class="c1"># show all basic _typedefs</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_typedefs</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="s1">&#39; &#39;</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%d</span><span class="s1"> type definitions: basic- and itemsize (leng), kind ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="s1">&#39;-type[def]s&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_sorted</span><span class="p">([(</span><span class="n">_prepr</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_items</span><span class="p">(</span><span class="n">_typedefs</span><span class="p">)]):</span>  <span class="c1"># [] for Python 2.2</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(base)s</span><span class="s1"> and </span><span class="si">%(item)s%(leng)s</span><span class="s1">, </span><span class="si">%(kind)s%(code)s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">v</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">(</span><span class="s1">&#39;-test&#39;</span><span class="p">):</span>
         <span class="c1"># compare the results of flatsize() *without* using sys.getsizeof()</span>
         <span class="c1"># with the accurate sizes returned by sys.getsizeof() but expect</span>
         <span class="c1"># differences for sequences as dicts, lists, sets, tuples, etc.</span>
         <span class="c1"># while this is no proof for the accuracy of flatsize() on Python</span>
         <span class="c1"># builds without sys.getsizeof(), it does provide some evidence</span>
         <span class="c1"># that that flatsize() produces reasonable and usable results</span>
        <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">flatsize() vs sys.getsizeof() ... </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;-test&#39;</span><span class="p">)</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">_getsizeof</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">g</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_values</span><span class="p">(</span><span class="n">_typedefs</span><span class="p">):</span>
                <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>  <span class="c1"># creating one instance</span>
                    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">__module__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;io&#39;</span><span class="p">,):</span>  <span class="c1"># avoid 3.0 RuntimeWarning</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">type</span><span class="p">())</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">SystemError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>  <span class="c1"># ignore errors</span>
                    <span class="k">pass</span>
            <span class="n">t</span><span class="o">.</span><span class="n">extend</span><span class="p">(({</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span>
                      <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                      <span class="s1">&#39;12345678&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">1001</span><span class="p">,</span>
                      <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                      <span class="n">_Slots</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)),</span> <span class="n">_Slots</span><span class="p">((</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">)),</span> <span class="n">_Slots</span><span class="p">((</span><span class="mi">0</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
                      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">128</span><span class="p">,</span>
                      <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
            <span class="n">_getsizeof</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># zap _getsizeof for flatsize()</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">flatsize</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 0 as default #PYCHOK expected</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">s</span><span class="p">:</span>
                     <span class="c1"># flatsize approximates the length of sequences</span>
                     <span class="c1"># (sys.getsizeof(bool) on 3.0b3 is not correct)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                       <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;expected failure&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">_typedefof</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                        <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;flatsize() </span><span class="si">%s</span><span class="s1"> vs sys.getsizeof() </span><span class="si">%s</span><span class="s1"> for </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">a</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_nameof</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)),</span> <span class="n">_repr</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">_getsizeof</span> <span class="o">=</span> <span class="n">g</span>  <span class="c1"># restore</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;Python </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%d</span><span class="s1"> of </span><span class="si">%d</span><span class="s1"> tests failed or </span><span class="si">%s</span><span class="s1"> on </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">_p100</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">g</span><span class="p">:</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;no unexpected failures in </span><span class="si">%d</span><span class="s1"> tests on </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_printf</span><span class="p">(</span><span class="s1">&#39;no sys.</span><span class="si">%s</span><span class="s1">() in this </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;getsizeof&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>


</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pySPACE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, pySPACE Developer Team.
      Last updated on Mar 14, 2017.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>