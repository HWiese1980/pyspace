<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pySPACE.tools.gprof2dot &mdash; pySPACE documentation</title>
    
    <link rel="stylesheet" href="../../../_static/pySPACE.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.3 release',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/pyspace-logo.ico"/>
    <link rel="top" title="pySPACE documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pySPACE documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/pyspace-logo_small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pySPACE.tools.gprof2dot</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot; Generate a dot graph from the output of several profilers.</span>

<span class="sd">    Original script by Jose Fonseca at </span>
<span class="sd">    http://code.google.com/p/jrfonseca/wiki/Gprof2Dot</span>
<span class="sd">    </span>
<span class="sd">    Usage: python gprof2dot.py -f pstats profiling_file -r pySPACE | dot -Tpng -o output.png</span>
<span class="sd">    </span>
<span class="sd">    where profiling_file is the file that is generated by the cProfile module.</span>
<span class="sd">    </span>
<span class="sd">    The option &#39;-r&#39;, &#39;--restrict&#39; is there to  eliminate functions in the</span>
<span class="sd">    profiling, that do not contain this string in their pathname [default: None].</span>
<span class="sd">    This option was added by Hendrik Woehrle and Mario Michael Krell.</span>
<span class="sd">    Furthermore some minor documentation changes were applied.</span>

<span class="sd">    For profiling pySPACE look at the documentation of pySPACE, especially launch.py</span>
<span class="sd">    and use the `--profile` option.</span>

<span class="sd">    Original LGPL 3+ licencing text::</span>

<span class="sd">        Copyright 2008-2009 Jose Fonseca</span>

<span class="sd">        This program is free software: you can redistribute it and/or modify it</span>
<span class="sd">        under the terms of the GNU Lesser General Public License as published</span>
<span class="sd">        by the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">        (at your option) any later version.</span>

<span class="sd">        This program is distributed in the hope that it will be useful,</span>
<span class="sd">        but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">        GNU Lesser General Public License for more details.</span>

<span class="sd">        You should have received a copy of the GNU Lesser General Public License</span>
<span class="sd">        along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>


<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">optparse</span>
<span class="kn">import</span> <span class="nn">xml.parsers.expat</span>


<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Debugging helper module</span>
    <span class="kn">import</span> <span class="nn">debug</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="times"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.times">[docs]</a><span class="k">def</span> <span class="nf">times</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">u&quot;</span><span class="si">%u</span><span class="se">\xd7</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,)</span></div>

<div class="viewcode-block" id="percentage"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.percentage">[docs]</a><span class="k">def</span> <span class="nf">percentage</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%.02f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="mf">100.0</span><span class="p">,)</span></div>

<div class="viewcode-block" id="add"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.add">[docs]</a><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span></div>

<div class="viewcode-block" id="equal"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.equal">[docs]</a><span class="k">def</span> <span class="nf">equal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="fail"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.fail">[docs]</a><span class="k">def</span> <span class="nf">fail</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">assert</span> <span class="bp">False</span></div>


<span class="n">tol</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">23</span>

<div class="viewcode-block" id="ratio"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.ratio">[docs]</a><span class="k">def</span> <span class="nf">ratio</span><span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="c1"># 0/0 is undefined, but 1.0 yields more useful results</span>
        <span class="k">return</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">ratio</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ratio</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">tol</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: negative ratio (</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">))</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">ratio</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ratio</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: ratio greater than one (</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">))</span>
        <span class="k">return</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">ratio</span></div>


<div class="viewcode-block" id="UndefinedEvent"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.UndefinedEvent">[docs]</a><span class="k">class</span> <span class="nc">UndefinedEvent</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when attempting to get an event which is undefined.&quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="UndefinedEvent.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.UndefinedEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">event</span></div>

<div class="viewcode-block" id="UndefinedEvent.__str__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.UndefinedEvent.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;unspecified event </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">name</span></div></div>


<div class="viewcode-block" id="Event"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Event">[docs]</a><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Describe a kind of event, and its basic operations.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Event.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Event.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">aggregator</span><span class="p">,</span> <span class="n">formatter</span> <span class="o">=</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_null</span> <span class="o">=</span> <span class="n">null</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aggregator</span> <span class="o">=</span> <span class="n">aggregator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_formatter</span> <span class="o">=</span> <span class="n">formatter</span></div>

<div class="viewcode-block" id="Event.__eq__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Event.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span></div>

<div class="viewcode-block" id="Event.__hash__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Event.__hash__">[docs]</a>    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Event.null"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Event.null">[docs]</a>    <span class="k">def</span> <span class="nf">null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_null</span></div>

<div class="viewcode-block" id="Event.aggregate"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Event.aggregate">[docs]</a>    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Aggregate two event values.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">val1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">assert</span> <span class="n">val2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregator</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Event.format"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Event.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format an event value.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></div></div>


<span class="n">CALLS</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;Calls&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
<span class="n">SAMPLES</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;Samples&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">add</span><span class="p">)</span>
<span class="n">SAMPLES2</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;Samples&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">add</span><span class="p">)</span>

<span class="n">TIME</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
<span class="n">TIME_RATIO</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;Time ratio&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">percentage</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
<span class="n">TOTAL_TIME</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;Total time&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">fail</span><span class="p">)</span>
<span class="n">TOTAL_TIME_RATIO</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;Total time ratio&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">fail</span><span class="p">,</span> <span class="n">percentage</span><span class="p">)</span>


<div class="viewcode-block" id="Object"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Object">[docs]</a><span class="k">class</span> <span class="nc">Object</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all objects in profile which can store events.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Object.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Object.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">events</span></div>

<div class="viewcode-block" id="Object.__hash__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Object.__hash__">[docs]</a>    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.__eq__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Object.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span></div>

<div class="viewcode-block" id="Object.__contains__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Object.__contains__">[docs]</a>    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span></div>
    
<div class="viewcode-block" id="Object.__getitem__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Object.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">event</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UndefinedEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Object.__setitem__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Object.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">event</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="Call"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Call">[docs]</a><span class="k">class</span> <span class="nc">Call</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A call between functions.</span>
<span class="sd">    </span>
<span class="sd">    There should be at most one call object for every pair of functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Call.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Call.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callee_id</span><span class="p">):</span>
        <span class="n">Object</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callee_id</span> <span class="o">=</span> <span class="n">callee_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="bp">None</span></div></div>


<div class="viewcode-block" id="Function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Function">[docs]</a><span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A function.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Function.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Function.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Object</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span></div>
    
<div class="viewcode-block" id="Function.add_call"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Function.add_call">[docs]</a>    <span class="k">def</span> <span class="nf">add_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">callee_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: overwriting call from function </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">call</span></div>

<div class="viewcode-block" id="Function.get_call"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Function.get_call">[docs]</a>    <span class="k">def</span> <span class="nf">get_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callee_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">callee_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">:</span>
            <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">callee_id</span><span class="p">)</span>
            <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">call</span><span class="p">[</span><span class="n">CALLS</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">call</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee_id</span><span class="p">]</span></div>

    <span class="c1"># TODO: write utility functions</span>

<div class="viewcode-block" id="Function.__repr__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Function.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div></div>


<div class="viewcode-block" id="Cycle"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Cycle">[docs]</a><span class="k">class</span> <span class="nc">Cycle</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cycle made from recursive function calls.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Cycle.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Cycle.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Object</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># XXX: Do cycles need an id?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cycle.add_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Cycle.add_function">[docs]</a>    <span class="k">def</span> <span class="nf">add_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="c1"># XXX: Aggregate events?</span>
        <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">cycle</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">function</span><span class="o">.</span><span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="Profile"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile">[docs]</a><span class="k">class</span> <span class="nc">Profile</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The whole profile.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Profile.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Object</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Profile.add_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.add_function">[docs]</a>    <span class="k">def</span> <span class="nf">add_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: overwriting function </span><span class="si">%s</span><span class="s1"> (id </span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span></div>

<div class="viewcode-block" id="Profile.add_cycle"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.add_cycle">[docs]</a>    <span class="k">def</span> <span class="nf">add_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cycles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span></div>

<div class="viewcode-block" id="Profile.validate"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate the edges.&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">callee_id</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">assert</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee_id</span><span class="p">]</span><span class="o">.</span><span class="n">callee_id</span> <span class="o">==</span> <span class="n">callee_id</span>
                <span class="k">if</span> <span class="n">callee_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: call to undefined function </span><span class="si">%s</span><span class="s1"> from function </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">callee_id</span><span class="p">),</span> <span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="k">del</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="Profile.find_cycles"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.find_cycles">[docs]</a>    <span class="k">def</span> <span class="nf">find_cycles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find cycles using Tarjan&#39;s strongly connected components algorithm.&quot;&quot;&quot;</span>

        <span class="c1"># Apply the Tarjan&#39;s algorithm successively until all functions are visited</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tarjan</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{},</span> <span class="p">{},</span> <span class="n">visited</span><span class="p">)</span>
        <span class="n">cycles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">function</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cycles</span><span class="p">:</span>
                <span class="n">cycles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="n">cycles</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">cycles</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Cycle:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">cycle</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Function </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Profile._tarjan"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile._tarjan">[docs]</a>    <span class="k">def</span> <span class="nf">_tarjan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span> <span class="n">lowlinks</span><span class="p">,</span> <span class="n">visited</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tarjan&#39;s strongly connected components algorithm.</span>

<span class="sd">        See also:</span>
<span class="sd">        - http://en.wikipedia.org/wiki/Tarjan&#39;s_strongly_connected_components_algorithm</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="n">orders</span><span class="p">[</span><span class="n">function</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
        <span class="n">lowlinks</span><span class="p">[</span><span class="n">function</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
        <span class="n">order</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
            <span class="c1"># TODO: use a set to optimize lookup</span>
            <span class="k">if</span> <span class="n">callee</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tarjan</span><span class="p">(</span><span class="n">callee</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span> <span class="n">lowlinks</span><span class="p">,</span> <span class="n">visited</span><span class="p">)</span>
                <span class="n">lowlinks</span><span class="p">[</span><span class="n">function</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lowlinks</span><span class="p">[</span><span class="n">function</span><span class="p">],</span> <span class="n">lowlinks</span><span class="p">[</span><span class="n">callee</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">callee</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">:</span>
                <span class="n">lowlinks</span><span class="p">[</span><span class="n">function</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lowlinks</span><span class="p">[</span><span class="n">function</span><span class="p">],</span> <span class="n">orders</span><span class="p">[</span><span class="n">callee</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">lowlinks</span><span class="p">[</span><span class="n">function</span><span class="p">]</span> <span class="o">==</span> <span class="n">orders</span><span class="p">[</span><span class="n">function</span><span class="p">]:</span>
            <span class="c1"># Strongly connected component found</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
            <span class="k">del</span> <span class="n">stack</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cycle</span> <span class="o">=</span> <span class="n">Cycle</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                    <span class="n">cycle</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">order</span></div>

<div class="viewcode-block" id="Profile.call_ratios"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.call_ratios">[docs]</a>    <span class="k">def</span> <span class="nf">call_ratios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># Aggregate for incoming calls</span>
        <span class="n">cycle_totals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycles</span><span class="p">:</span>
            <span class="n">cycle_totals</span><span class="p">[</span><span class="n">cycle</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">function_totals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">function_totals</span><span class="p">[</span><span class="n">function</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">callee_id</span> <span class="o">!=</span> <span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
                    <span class="n">function_totals</span><span class="p">[</span><span class="n">callee</span><span class="p">]</span> <span class="o">+=</span> <span class="n">call</span><span class="p">[</span><span class="n">event</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">callee</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">callee</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">function</span><span class="o">.</span><span class="n">cycle</span><span class="p">:</span>
                        <span class="n">cycle_totals</span><span class="p">[</span><span class="n">callee</span><span class="o">.</span><span class="n">cycle</span><span class="p">]</span> <span class="o">+=</span> <span class="n">call</span><span class="p">[</span><span class="n">event</span><span class="p">]</span>

        <span class="c1"># Compute the ratios</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">assert</span> <span class="n">call</span><span class="o">.</span><span class="n">ratio</span> <span class="ow">is</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">callee_id</span> <span class="o">!=</span> <span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">callee</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">callee</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">function</span><span class="o">.</span><span class="n">cycle</span><span class="p">:</span>
                        <span class="n">total</span> <span class="o">=</span> <span class="n">cycle_totals</span><span class="p">[</span><span class="n">callee</span><span class="o">.</span><span class="n">cycle</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">total</span> <span class="o">=</span> <span class="n">function_totals</span><span class="p">[</span><span class="n">callee</span><span class="p">]</span>
                    <span class="n">call</span><span class="o">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">(</span><span class="n">call</span><span class="p">[</span><span class="n">event</span><span class="p">],</span> <span class="n">total</span><span class="p">)</span></div>

<div class="viewcode-block" id="Profile.integrate"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.integrate">[docs]</a>    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Propagate function time ratio allong the function calls.</span>

<span class="sd">        Must be called after finding the cycles.</span>

<span class="sd">        See also:</span>
<span class="sd">        - http://citeseer.ist.psu.edu/graham82gprof.html</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Sanity checking</span>
        <span class="k">assert</span> <span class="n">outevent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">outevent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">function</span>
            <span class="k">assert</span> <span class="n">inevent</span> <span class="ow">in</span> <span class="n">function</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">assert</span> <span class="n">outevent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">call</span>
                <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">callee_id</span> <span class="o">!=</span> <span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">call</span><span class="o">.</span><span class="n">ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

        <span class="c1"># Aggregate the input for each cycle </span>
        <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycles</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">inevent</span><span class="o">.</span><span class="n">null</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">inevent</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">function</span><span class="p">[</span><span class="n">inevent</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">inevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>

        <span class="c1"># Integrate along the edges</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">inevent</span><span class="o">.</span><span class="n">null</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">inevent</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">function</span><span class="p">[</span><span class="n">inevent</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_integrate_function</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span></div>

<div class="viewcode-block" id="Profile._integrate_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile._integrate_function">[docs]</a>    <span class="k">def</span> <span class="nf">_integrate_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_integrate_cycle</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">cycle</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">outevent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">function</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">function</span><span class="p">[</span><span class="n">inevent</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">callee_id</span> <span class="o">!=</span> <span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                        <span class="n">total</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_integrate_call</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">)</span>
                <span class="n">function</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Profile._integrate_call"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile._integrate_call">[docs]</a>    <span class="k">def</span> <span class="nf">_integrate_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">outevent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">call</span>
        <span class="k">assert</span> <span class="n">call</span><span class="o">.</span><span class="n">ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
        <span class="n">subtotal</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">ratio</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_integrate_function</span><span class="p">(</span><span class="n">callee</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">)</span>
        <span class="n">call</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">subtotal</span>
        <span class="k">return</span> <span class="n">subtotal</span></div>

<div class="viewcode-block" id="Profile._integrate_cycle"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile._integrate_cycle">[docs]</a>    <span class="k">def</span> <span class="nf">_integrate_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outevent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">:</span>

            <span class="c1"># Compute the outevent for the whole cycle</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">inevent</span><span class="o">.</span><span class="n">null</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">cycle</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                <span class="n">subtotal</span> <span class="o">=</span> <span class="n">member</span><span class="p">[</span><span class="n">inevent</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                    <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">callee</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">cycle</span><span class="p">:</span>
                        <span class="n">subtotal</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_integrate_call</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">)</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">subtotal</span>
            <span class="n">cycle</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>
            
            <span class="c1"># Compute the time propagated to callers of this cycle</span>
            <span class="n">callees</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">cycle</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                        <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">callee</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="n">cycle</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">callees</span><span class="p">[</span><span class="n">callee</span><span class="p">]</span> <span class="o">+=</span> <span class="n">call</span><span class="o">.</span><span class="n">ratio</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="n">callees</span><span class="p">[</span><span class="n">callee</span><span class="p">]</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">ratio</span>
            
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">cycle</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                <span class="n">member</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">outevent</span><span class="o">.</span><span class="n">null</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">callee</span><span class="p">,</span> <span class="n">call_ratio</span> <span class="ow">in</span> <span class="n">callees</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">ranks</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">call_ratios</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">partials</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rank_cycle_function</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">callee</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ranks</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_call_ratios_cycle</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">callee</span><span class="p">,</span> <span class="n">ranks</span><span class="p">,</span> <span class="n">call_ratios</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
                <span class="n">partial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_integrate_cycle_function</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">callee</span><span class="p">,</span> <span class="n">call_ratio</span><span class="p">,</span> <span class="n">partials</span><span class="p">,</span> <span class="n">ranks</span><span class="p">,</span> <span class="n">call_ratios</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">partial</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">partials</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="n">total</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">partial</span><span class="o">/</span><span class="p">(</span><span class="n">call_ratio</span><span class="o">*</span><span class="n">total</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mf">0.001</span>

        <span class="k">return</span> <span class="n">cycle</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span></div>

<div class="viewcode-block" id="Profile._rank_cycle_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile._rank_cycle_function">[docs]</a>    <span class="k">def</span> <span class="nf">_rank_cycle_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">ranks</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ranks</span> <span class="ow">or</span> <span class="n">ranks</span><span class="p">[</span><span class="n">function</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rank</span><span class="p">:</span>
            <span class="n">ranks</span><span class="p">[</span><span class="n">function</span><span class="p">]</span> <span class="o">=</span> <span class="n">rank</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">callee_id</span> <span class="o">!=</span> <span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">callee</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="n">cycle</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_rank_cycle_function</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">callee</span><span class="p">,</span> <span class="n">rank</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ranks</span><span class="p">)</span></div>

<div class="viewcode-block" id="Profile._call_ratios_cycle"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile._call_ratios_cycle">[docs]</a>    <span class="k">def</span> <span class="nf">_call_ratios_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">ranks</span><span class="p">,</span> <span class="n">call_ratios</span><span class="p">,</span> <span class="n">visited</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">callee_id</span> <span class="o">!=</span> <span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">callee</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="n">cycle</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ranks</span><span class="p">[</span><span class="n">callee</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ranks</span><span class="p">[</span><span class="n">function</span><span class="p">]:</span>
                            <span class="n">call_ratios</span><span class="p">[</span><span class="n">callee</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_ratios</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">callee</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">call</span><span class="o">.</span><span class="n">ratio</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_call_ratios_cycle</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">callee</span><span class="p">,</span> <span class="n">ranks</span><span class="p">,</span> <span class="n">call_ratios</span><span class="p">,</span> <span class="n">visited</span><span class="p">)</span></div>

<div class="viewcode-block" id="Profile._integrate_cycle_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile._integrate_cycle_function">[docs]</a>    <span class="k">def</span> <span class="nf">_integrate_cycle_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">partial_ratio</span><span class="p">,</span> <span class="n">partials</span><span class="p">,</span> <span class="n">ranks</span><span class="p">,</span> <span class="n">call_ratios</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">partials</span><span class="p">:</span>
            <span class="n">partial</span> <span class="o">=</span> <span class="n">partial_ratio</span><span class="o">*</span><span class="n">function</span><span class="p">[</span><span class="n">inevent</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">callee_id</span> <span class="o">!=</span> <span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">callee</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">cycle</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">outevent</span> <span class="ow">in</span> <span class="n">call</span>
                        <span class="n">partial</span> <span class="o">+=</span> <span class="n">partial_ratio</span><span class="o">*</span><span class="n">call</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ranks</span><span class="p">[</span><span class="n">callee</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ranks</span><span class="p">[</span><span class="n">function</span><span class="p">]:</span>
                            <span class="n">callee_partial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_integrate_cycle_function</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">callee</span><span class="p">,</span> <span class="n">partial_ratio</span><span class="p">,</span> <span class="n">partials</span><span class="p">,</span> <span class="n">ranks</span><span class="p">,</span> <span class="n">call_ratios</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">)</span>
                            <span class="n">call_ratio</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span> <span class="n">call_ratios</span><span class="p">[</span><span class="n">callee</span><span class="p">])</span>
                            <span class="n">call_partial</span> <span class="o">=</span> <span class="n">call_ratio</span><span class="o">*</span><span class="n">callee_partial</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">call</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">+=</span> <span class="n">call_partial</span>
                            <span class="k">except</span> <span class="n">UndefinedEvent</span><span class="p">:</span>
                                <span class="n">call</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_partial</span>
                            <span class="n">partial</span> <span class="o">+=</span> <span class="n">call_partial</span>
            <span class="n">partials</span><span class="p">[</span><span class="n">function</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">function</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">+=</span> <span class="n">partial</span>
            <span class="k">except</span> <span class="n">UndefinedEvent</span><span class="p">:</span>
                <span class="n">function</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span>
        <span class="k">return</span> <span class="n">partials</span><span class="p">[</span><span class="n">function</span><span class="p">]</span></div>

<div class="viewcode-block" id="Profile.aggregate"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.aggregate">[docs]</a>    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Aggregate an event for the whole profile.&quot;&quot;&quot;</span>

        <span class="n">total</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">null</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">function</span><span class="p">[</span><span class="n">event</span><span class="p">])</span>
            <span class="k">except</span> <span class="n">UndefinedEvent</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span></div>

<div class="viewcode-block" id="Profile.ratio"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.ratio">[docs]</a>    <span class="k">def</span> <span class="nf">ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outevent</span><span class="p">,</span> <span class="n">inevent</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">outevent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="k">assert</span> <span class="n">inevent</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">outevent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">function</span>
            <span class="k">assert</span> <span class="n">inevent</span> <span class="ow">in</span> <span class="n">function</span>
            <span class="n">function</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">(</span><span class="n">function</span><span class="p">[</span><span class="n">inevent</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="n">inevent</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">assert</span> <span class="n">outevent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">call</span>
                <span class="k">if</span> <span class="n">inevent</span> <span class="ow">in</span> <span class="n">call</span><span class="p">:</span>
                    <span class="n">call</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">(</span><span class="n">call</span><span class="p">[</span><span class="n">inevent</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="n">inevent</span><span class="p">])</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">outevent</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="Profile.prune"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.prune">[docs]</a>    <span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_thres</span><span class="p">,</span> <span class="n">edge_thres</span><span class="p">,</span><span class="n">restrict_string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prune the profile&quot;&quot;&quot;</span>

        <span class="c1"># compute the prune ratios</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">function</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">function</span><span class="p">[</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">]</span>
            <span class="k">except</span> <span class="n">UndefinedEvent</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">TOTAL_TIME_RATIO</span> <span class="ow">in</span> <span class="n">call</span><span class="p">:</span>
                    <span class="c1"># handle exact cases first</span>
                    <span class="n">call</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">call</span><span class="p">[</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">]</span> 
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># make a safe estimate</span>
                        <span class="n">call</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">function</span><span class="p">[</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">],</span> <span class="n">callee</span><span class="p">[</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">])</span> 
                    <span class="k">except</span> <span class="n">UndefinedEvent</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="c1"># prune the nodes</span>
        <span class="k">for</span> <span class="n">function_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">function_id</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">weight</span> <span class="o">&lt;</span> <span class="n">node_thres</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">function_id</span><span class="p">]</span>
                    
        <span class="k">for</span> <span class="n">function_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">function_id</span><span class="p">]</span>
            <span class="c1">#print function</span>
            <span class="c1">#print function.path</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">restrict_string</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">function_id</span><span class="p">]</span>        

        <span class="c1"># prune the egdes</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">callee_id</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">call</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee_id</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">callee_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="ow">or</span> <span class="n">call</span><span class="o">.</span><span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">call</span><span class="o">.</span><span class="n">weight</span> <span class="o">&lt;</span> <span class="n">edge_thres</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee_id</span><span class="p">]</span></div>
                    

    
<div class="viewcode-block" id="Profile.dump"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Function </span><span class="si">%s</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">,))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dump_events</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Call </span><span class="si">%s</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">callee</span><span class="o">.</span><span class="n">name</span><span class="p">,))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dump_events</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycles</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Cycle:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dump_events</span><span class="p">(</span><span class="n">cycle</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">cycle</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Function </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">,))</span></div>

<div class="viewcode-block" id="Profile._dump_events"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Profile._dump_events">[docs]</a>    <span class="k">def</span> <span class="nf">_dump_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">events</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span></div></div>


<div class="viewcode-block" id="Struct"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Struct">[docs]</a><span class="k">class</span> <span class="nc">Struct</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Masquerade a dictionary with a structure-like behavior.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Struct.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Struct.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_attrs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span></div>
    
<div class="viewcode-block" id="Struct.__getattr__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Struct.__getattr__">[docs]</a>    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Struct.__setattr__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Struct.__setattr__">[docs]</a>    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Struct.__str__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Struct.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Struct.__repr__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Struct.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="p">)</span></div></div>
    

<div class="viewcode-block" id="ParseError"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.ParseError">[docs]</a><span class="k">class</span> <span class="nc">ParseError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when parsing to signal mismatches.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ParseError.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.ParseError.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="c1"># TODO: store more source line information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">line</span></div>

<div class="viewcode-block" id="ParseError.__str__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.ParseError.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Parser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Parser">[docs]</a><span class="k">class</span> <span class="nc">Parser</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Parser interface.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Parser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Parser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Parser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Parser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>

    
<div class="viewcode-block" id="LineParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.LineParser">[docs]</a><span class="k">class</span> <span class="nc">LineParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for parsers that read line-based formats.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="LineParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.LineParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
        <span class="n">Parser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__line</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__eof</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_no</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="LineParser.readline"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.LineParser.readline">[docs]</a>    <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__eof</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_no</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LineParser.lookahead"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.LineParser.lookahead">[docs]</a>    <span class="k">def</span> <span class="nf">lookahead</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__line</span></div>

<div class="viewcode-block" id="LineParser.consume"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.LineParser.consume">[docs]</a>    <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="LineParser.eof"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.LineParser.eof">[docs]</a>    <span class="k">def</span> <span class="nf">eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eof</span></div></div>


<span class="n">XML_ELEMENT_START</span><span class="p">,</span> <span class="n">XML_ELEMENT_END</span><span class="p">,</span> <span class="n">XML_CHARACTER_DATA</span><span class="p">,</span> <span class="n">XML_EOF</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>


<div class="viewcode-block" id="XmlToken"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlToken">[docs]</a><span class="k">class</span> <span class="nc">XmlToken</span><span class="p">:</span>

<div class="viewcode-block" id="XmlToken.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlToken.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name_or_data</span><span class="p">,</span> <span class="n">attrs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">XML_ELEMENT_START</span><span class="p">,</span> <span class="n">XML_ELEMENT_END</span><span class="p">,</span> <span class="n">XML_CHARACTER_DATA</span><span class="p">,</span> <span class="n">XML_EOF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">=</span> <span class="n">name_or_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span></div>

<div class="viewcode-block" id="XmlToken.__str__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlToken.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">+</span> <span class="s1">&#39; ...&gt;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_END</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_CHARACTER_DATA</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_or_data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_EOF</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;end of file&#39;</span>
        <span class="k">assert</span> <span class="mi">0</span></div></div>


<div class="viewcode-block" id="XmlTokenizer"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenizer">[docs]</a><span class="k">class</span> <span class="nc">XmlTokenizer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Expat based XML tokenizer.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="XmlTokenizer.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenizer.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">skip_ws</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_ws</span> <span class="o">=</span> <span class="n">skip_ws</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">character_pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">parsers</span><span class="o">.</span><span class="n">expat</span><span class="o">.</span><span class="n">ParserCreate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">StartElementHandler</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_element_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">EndElementHandler</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_element_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">CharacterDataHandler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_character_data</span></div>
    
<div class="viewcode-block" id="XmlTokenizer.handle_element_start"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenizer.handle_element_start">[docs]</a>    <span class="k">def</span> <span class="nf">handle_element_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_character_data</span><span class="p">()</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">XmlToken</span><span class="p">(</span><span class="n">XML_ELEMENT_START</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="XmlTokenizer.handle_element_end"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenizer.handle_element_end">[docs]</a>    <span class="k">def</span> <span class="nf">handle_element_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_character_data</span><span class="p">()</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">XmlToken</span><span class="p">(</span><span class="n">XML_ELEMENT_END</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlTokenizer.handle_character_data"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenizer.handle_character_data">[docs]</a>    <span class="k">def</span> <span class="nf">handle_character_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">character_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span> <span class="o">+=</span> <span class="n">data</span></div>
    
<div class="viewcode-block" id="XmlTokenizer.finish_character_data"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenizer.finish_character_data">[docs]</a>    <span class="k">def</span> <span class="nf">finish_character_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_ws</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span> 
                <span class="n">line</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_pos</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">XmlToken</span><span class="p">(</span><span class="n">XML_CHARACTER_DATA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></div>
    
<div class="viewcode-block" id="XmlTokenizer.next"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenizer.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">16</span><span class="o">*</span><span class="mi">1024</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">xml</span><span class="o">.</span><span class="n">parsers</span><span class="o">.</span><span class="n">expat</span><span class="o">.</span><span class="n">ExpatError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1">#if e.code == xml.parsers.expat.errors.XML_ERROR_NO_ELEMENTS:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">):</span>
            <span class="n">line</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">XmlToken</span><span class="p">(</span><span class="n">XML_EOF</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">token</span></div>

<div class="viewcode-block" id="XmlTokenizer.pos"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenizer.pos">[docs]</a>    <span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">CurrentLineNumber</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">CurrentColumnNumber</span></div></div>


<div class="viewcode-block" id="XmlTokenMismatch"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenMismatch">[docs]</a><span class="k">class</span> <span class="nc">XmlTokenMismatch</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

<div class="viewcode-block" id="XmlTokenMismatch.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenMismatch.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">found</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">expected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">found</span> <span class="o">=</span> <span class="n">found</span></div>

<div class="viewcode-block" id="XmlTokenMismatch.__str__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlTokenMismatch.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> expected, </span><span class="si">%s</span><span class="s1"> found&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">found</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">found</span><span class="o">.</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">found</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="XmlParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlParser">[docs]</a><span class="k">class</span> <span class="nc">XmlParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base XML document parser.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="XmlParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="n">Parser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">XmlTokenizer</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="XmlParser.consume"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlParser.consume">[docs]</a>    <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">next</span><span class="p">()</span></div>

<div class="viewcode-block" id="XmlParser.match_element_start"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlParser.match_element_start">[docs]</a>    <span class="k">def</span> <span class="nf">match_element_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">==</span> <span class="n">name</span></div>
    
<div class="viewcode-block" id="XmlParser.match_element_end"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlParser.match_element_end">[docs]</a>    <span class="k">def</span> <span class="nf">match_element_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_END</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">==</span> <span class="n">name</span></div>

<div class="viewcode-block" id="XmlParser.element_start"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlParser.element_start">[docs]</a>    <span class="k">def</span> <span class="nf">element_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_CHARACTER_DATA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XmlTokenMismatch</span><span class="p">(</span><span class="n">XmlToken</span><span class="p">(</span><span class="n">XML_ELEMENT_START</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">!=</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XmlTokenMismatch</span><span class="p">(</span><span class="n">XmlToken</span><span class="p">(</span><span class="n">XML_ELEMENT_START</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">attrs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">attrs</span></div>
    
<div class="viewcode-block" id="XmlParser.element_end"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlParser.element_end">[docs]</a>    <span class="k">def</span> <span class="nf">element_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_CHARACTER_DATA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">XML_ELEMENT_END</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XmlTokenMismatch</span><span class="p">(</span><span class="n">XmlToken</span><span class="p">(</span><span class="n">XML_ELEMENT_END</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">!=</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XmlTokenMismatch</span><span class="p">(</span><span class="n">XmlToken</span><span class="p">(</span><span class="n">XML_ELEMENT_END</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span></div>

<div class="viewcode-block" id="XmlParser.character_data"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XmlParser.character_data">[docs]</a>    <span class="k">def</span> <span class="nf">character_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strip</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_CHARACTER_DATA</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span></div></div>


<div class="viewcode-block" id="GprofParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.GprofParser">[docs]</a><span class="k">class</span> <span class="nc">GprofParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for GNU gprof output.</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        - Chapter &quot;Interpreting gprof&#39;s Output&quot; from the GNU gprof manual</span>
<span class="sd">          http://sourceware.org/binutils/docs-2.18/gprof/Call-Graph.html#Call-Graph</span>

<span class="sd">        - File &quot;cg_print.c&quot; from the GNU gprof source code</span>
<span class="sd">          http://sourceware.org/cgi-bin/cvsweb.cgi/~checkout~/src/gprof/cg_print.c?rev=1.12&amp;cvsroot=src</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GprofParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.GprofParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="n">Parser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="GprofParser.readline"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.GprofParser.readline">[docs]</a>    <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;error: unexpected end of file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span></div>

    <span class="n">_int_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;^\d+$&#39;</span><span class="p">)</span>
    <span class="n">_float_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;^\d+\.\d+$&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="GprofParser.translate"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.GprofParser.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extract a structure from a match object, while translating the types in the process.&quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">groupdict</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">groupdict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_int_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_float_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Struct</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span></div>

    <span class="n">_cg_header_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="c1"># original gprof header</span>
        <span class="s1">r&#39;^\s+called/total\s+parents\s*$|&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;^index\s+%time\s+self\s+descendents\s+called\+self\s+name\s+index\s*$|&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;^\s+called/total\s+children\s*$|&#39;</span> <span class="o">+</span>
        <span class="c1"># GNU gprof header</span>
        <span class="s1">r&#39;^index\s+%\s+time\s+self\s+children\s+called\s+name\s*$&#39;</span>
    <span class="p">)</span>

    <span class="n">_cg_ignore_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="c1"># spontaneous</span>
        <span class="s1">r&#39;^\s+&lt;spontaneous&gt;\s*$|&#39;</span>
        <span class="c1"># internal calls (such as &quot;mcount&quot;)</span>
        <span class="s1">r&#39;^.*\((\d+)\)$&#39;</span>
    <span class="p">)</span>

    <span class="n">_cg_primary_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s1">r&#39;^\[(?P&lt;index&gt;\d+)\]?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;percentage_time&gt;\d+\.\d+)&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;self&gt;\d+\.\d+)&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;descendants&gt;\d+\.\d+)&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?:(?P&lt;called&gt;\d+)(?:\+(?P&lt;called_self&gt;\d+))?)?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;name&gt;\S.*?)&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;(?:\s+&lt;cycle\s(?P&lt;cycle&gt;\d+)&gt;)?&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;\s\[(\d+)\]$&#39;</span>
    <span class="p">)</span>

    <span class="n">_cg_parent_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s1">r&#39;^\s+(?P&lt;self&gt;\d+\.\d+)?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;descendants&gt;\d+\.\d+)?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;called&gt;\d+)(?:/(?P&lt;called_total&gt;\d+))?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;name&gt;\S.*?)&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;(?:\s+&lt;cycle\s(?P&lt;cycle&gt;\d+)&gt;)?&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;\s\[(?P&lt;index&gt;\d+)\]$&#39;</span>
    <span class="p">)</span>

    <span class="n">_cg_child_re</span> <span class="o">=</span> <span class="n">_cg_parent_re</span>

    <span class="n">_cg_cycle_header_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s1">r&#39;^\[(?P&lt;index&gt;\d+)\]?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;percentage_time&gt;\d+\.\d+)&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;self&gt;\d+\.\d+)&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;descendants&gt;\d+\.\d+)&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?:(?P&lt;called&gt;\d+)(?:\+(?P&lt;called_self&gt;\d+))?)?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+&lt;cycle\s(?P&lt;cycle&gt;\d+)\sas\sa\swhole&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;\s\[(\d+)\]$&#39;</span>
    <span class="p">)</span>

    <span class="n">_cg_cycle_member_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s1">r&#39;^\s+(?P&lt;self&gt;\d+\.\d+)?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;descendants&gt;\d+\.\d+)?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;called&gt;\d+)(?:\+(?P&lt;called_self&gt;\d+))?&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;name&gt;\S.*?)&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;(?:\s+&lt;cycle\s(?P&lt;cycle&gt;\d+)&gt;)?&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;\s\[(?P&lt;index&gt;\d+)\]$&#39;</span>
    <span class="p">)</span>

    <span class="n">_cg_sep_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;^--+$&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="GprofParser.parse_function_entry"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.GprofParser.parse_function_entry">[docs]</a>    <span class="k">def</span> <span class="nf">parse_function_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: unexpected end of entry</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">):</span>
                <span class="k">break</span>
        
            <span class="c1"># read function parent line</span>
            <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_parent_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_ignore_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: unrecognized call graph entry: </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
                <span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="c1"># read primary line</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_primary_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: unrecognized call graph entry: </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
            <span class="c1"># read function subroutine line</span>
            <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_child_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_ignore_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: unrecognized call graph entry: </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        
        <span class="n">function</span><span class="o">.</span><span class="n">parents</span> <span class="o">=</span> <span class="n">parents</span>
        <span class="n">function</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">children</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">function</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span></div>

<div class="viewcode-block" id="GprofParser.parse_cycle_entry"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.GprofParser.parse_cycle_entry">[docs]</a>    <span class="k">def</span> <span class="nf">parse_cycle_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>

        <span class="c1"># read cycle header line</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_cycle_header_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: unrecognized call graph entry: </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>

        <span class="c1"># read cycle member lines</span>
        <span class="n">cycle</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_cycle_member_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: unrecognized call graph entry: </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
            <span class="n">cycle</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">cycles</span><span class="p">[</span><span class="n">cycle</span><span class="o">.</span><span class="n">cycle</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle</span></div>

<div class="viewcode-block" id="GprofParser.parse_cg_entry"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.GprofParser.parse_cg_entry">[docs]</a>    <span class="k">def</span> <span class="nf">parse_cg_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_cycle_entry</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_function_entry</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="GprofParser.parse_cg"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.GprofParser.parse_cg">[docs]</a>    <span class="k">def</span> <span class="nf">parse_cg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the call graph.&quot;&quot;&quot;</span>

        <span class="c1"># skip call graph header</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_header_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()):</span>
            <span class="k">pass</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_header_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="c1"># process call graph entries</span>
        <span class="n">entry_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">line</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\014</span><span class="s1">&#39;</span><span class="p">:</span> <span class="c1"># form feed</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg_sep_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_cg_entry</span><span class="p">(</span><span class="n">entry_lines</span><span class="p">)</span>
                    <span class="n">entry_lines</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">entry_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>            
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="GprofParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.GprofParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_cg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span>
        <span class="n">profile</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="n">cycles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycles</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
            <span class="n">cycles</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cycle</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="c1"># populate the function</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">function</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">self</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">called</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">function</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">called</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">called_self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">call</span><span class="p">[</span><span class="n">CALLS</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">called_self</span>
                <span class="n">function</span><span class="o">.</span><span class="n">called</span> <span class="o">+=</span> <span class="n">entry</span><span class="o">.</span><span class="n">called_self</span>
            
            <span class="c1"># populate the function calls</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                
                <span class="k">assert</span> <span class="n">child</span><span class="o">.</span><span class="n">called</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
                <span class="n">call</span><span class="p">[</span><span class="n">CALLS</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">called</span>

                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                    <span class="c1"># NOTE: functions that were never called but were discovered by gprof&#39;s </span>
                    <span class="c1"># static call graph analysis dont have a call graph entry so we need</span>
                    <span class="c1"># to add them here</span>
                    <span class="n">missing</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">function</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">function</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>

                <span class="n">function</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>

            <span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cycle</span> <span class="o">=</span> <span class="n">cycles</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">cycle</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: &lt;cycle </span><span class="si">%u</span><span class="s1"> as a whole&gt; entry missing</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">entry</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span> 
                    <span class="n">cycle</span> <span class="o">=</span> <span class="n">Cycle</span><span class="p">()</span>
                    <span class="n">cycles</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">cycle</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle</span>
                <span class="n">cycle</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

            <span class="n">profile</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">+</span> <span class="n">function</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">cycles</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">add_cycle</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span>

        <span class="c1"># Compute derived events</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TIME_RATIO</span><span class="p">,</span> <span class="n">TIME</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">call_ratios</span><span class="p">(</span><span class="n">CALLS</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">TOTAL_TIME</span><span class="p">,</span> <span class="n">TIME</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TOTAL_TIME</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">profile</span></div></div>


<div class="viewcode-block" id="CallgrindParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser">[docs]</a><span class="k">class</span> <span class="nc">CallgrindParser</span><span class="p">(</span><span class="n">LineParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for valgrind&#39;s callgrind tool.</span>
<span class="sd">    </span>
<span class="sd">    See also:</span>
<span class="sd">    - http://valgrind.org/docs/manual/cl-format.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_call_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^calls=\s*(\d+)\s+((\d+|\+\d+|-\d+|\*)\s+)+$&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CallgrindParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">):</span>
        <span class="n">LineParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">)</span>

        <span class="c1"># Textual positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Numeric positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_positions</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_positions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_positions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_events</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_events</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="CallgrindParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># read lookahead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parse_key</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_key</span><span class="p">(</span><span class="s1">&#39;creator&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_part</span><span class="p">()</span>

        <span class="c1"># compute derived data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">find_cycles</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TIME_RATIO</span><span class="p">,</span> <span class="n">SAMPLES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">call_ratios</span><span class="p">(</span><span class="n">CALLS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TIME_RATIO</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_part"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_part">[docs]</a>    <span class="k">def</span> <span class="nf">parse_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_header_line</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_body_line</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: line </span><span class="si">%u</span><span class="s1">: unexpected line</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_no</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_header_line"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_header_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_header_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_empty</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_comment</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_part_detail</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_description</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_event_specification</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_cost_line_def</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_cost_summary</span><span class="p">()</span></div>

    <span class="n">_detail_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="s1">&#39;thread&#39;</span><span class="p">,</span> <span class="s1">&#39;part&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="CallgrindParser.parse_part_detail"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_part_detail">[docs]</a>    <span class="k">def</span> <span class="nf">parse_part_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_detail_keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_description"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_description">[docs]</a>    <span class="k">def</span> <span class="nf">parse_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_key</span><span class="p">(</span><span class="s1">&#39;desc&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_event_specification"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_event_specification">[docs]</a>    <span class="k">def</span> <span class="nf">parse_event_specification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_key</span><span class="p">(</span><span class="s1">&#39;event&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_cost_line_def"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_cost_line_def">[docs]</a>    <span class="k">def</span> <span class="nf">parse_cost_line_def</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_keys</span><span class="p">((</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="s1">&#39;positions&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">pair</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pair</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;events&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_events</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cost_events</span> <span class="o">=</span> <span class="n">items</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;positions&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_positions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cost_positions</span> <span class="o">=</span> <span class="n">items</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_positions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_positions</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_cost_summary"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_cost_summary">[docs]</a>    <span class="k">def</span> <span class="nf">parse_cost_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_keys</span><span class="p">((</span><span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;totals&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">pair</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_body_line"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_body_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_body_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_empty</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_comment</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_cost_line</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_position_spec</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_association_spec</span><span class="p">()</span></div>

    <span class="n">__subpos_re</span> <span class="o">=</span> <span class="s1">r&#39;(0x[0-9a-fA-F]+|\d+|\+\d+|-\d+|\*)&#39;</span>
    <span class="n">_cost_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;^&#39;</span> <span class="o">+</span> 
        <span class="n">__subpos_re</span> <span class="o">+</span> <span class="s1">r&#39;( +&#39;</span> <span class="o">+</span> <span class="n">__subpos_re</span> <span class="o">+</span> <span class="s1">r&#39;)*&#39;</span> <span class="o">+</span>
        <span class="s1">r&#39;( +\d+)*&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;$&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CallgrindParser.parse_cost_line"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_cost_line">[docs]</a>    <span class="k">def</span> <span class="nf">parse_cost_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cost_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_positions</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_events</span>

        <span class="n">positions</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_positions</span><span class="p">]</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_positions</span> <span class="p">:</span> <span class="p">]</span>
        <span class="n">events</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_events</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_positions</span><span class="p">):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;-+&#39;</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">position</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;0x&#39;</span><span class="p">):</span>
                <span class="n">position</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>

        <span class="n">events</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">events</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">calls</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_callee</span><span class="p">()</span>
            <span class="n">callee</span><span class="o">.</span><span class="n">called</span> <span class="o">+=</span> <span class="n">calls</span>
    
            <span class="k">try</span><span class="p">:</span>
                <span class="n">call</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">callee</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">call</span><span class="p">[</span><span class="n">CALLS</span><span class="p">]</span> <span class="o">=</span> <span class="n">calls</span>
                <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">function</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">call</span><span class="p">[</span><span class="n">CALLS</span><span class="p">]</span> <span class="o">+=</span> <span class="n">calls</span>
                <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_association_spec"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_association_spec">[docs]</a>    <span class="k">def</span> <span class="nf">parse_association_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;calls=&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">calls</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">call_position</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parse_cost_line</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">True</span></div>

    <span class="n">_position_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^(?P&lt;position&gt;[cj]?(?:ob|fl|fi|fe|fn))=\s*(?:\((?P&lt;id&gt;\d+)\))?(?:\s*(?P&lt;name&gt;.+))?&#39;</span><span class="p">)</span>

    <span class="n">_position_table_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ob&#39;</span><span class="p">:</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fl&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fi&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fe&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fn&#39;</span><span class="p">:</span> <span class="s1">&#39;fn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cob&#39;</span><span class="p">:</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cfl&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cfi&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cfe&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cfn&#39;</span><span class="p">:</span> <span class="s1">&#39;fn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;jfi&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_position_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ob&#39;</span><span class="p">:</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fl&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fi&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fe&#39;</span><span class="p">:</span> <span class="s1">&#39;fl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fn&#39;</span><span class="p">:</span> <span class="s1">&#39;fn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cob&#39;</span><span class="p">:</span> <span class="s1">&#39;cob&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cfl&#39;</span><span class="p">:</span> <span class="s1">&#39;cfl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cfi&#39;</span><span class="p">:</span> <span class="s1">&#39;cfl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cfe&#39;</span><span class="p">:</span> <span class="s1">&#39;cfl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cfn&#39;</span><span class="p">:</span> <span class="s1">&#39;cfn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;jfi&#39;</span><span class="p">:</span> <span class="s1">&#39;jfi&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="CallgrindParser.parse_position_spec"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_position_spec">[docs]</a>    <span class="k">def</span> <span class="nf">parse_position_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;jump=&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;jcnd=&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">position</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position_table_map</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">position_ids</span><span class="p">[(</span><span class="n">table</span><span class="p">,</span> <span class="nb">id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_ids</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">table</span><span class="p">,</span> <span class="nb">id</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_position_map</span><span class="p">[</span><span class="n">position</span><span class="p">]]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_empty"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_empty">[docs]</a>    <span class="k">def</span> <span class="nf">parse_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_comment"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_comment">[docs]</a>    <span class="k">def</span> <span class="nf">parse_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span></div>

    <span class="n">_key_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;^(\w+):&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CallgrindParser.parse_key"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_key">[docs]</a>    <span class="k">def</span> <span class="nf">parse_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_keys</span><span class="p">((</span><span class="n">key</span><span class="p">,))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pair</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pair</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="CallgrindParser.parse_keys"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.parse_keys">[docs]</a>    <span class="k">def</span> <span class="nf">parse_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span></div>

<div class="viewcode-block" id="CallgrindParser.make_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.make_function">[docs]</a>    <span class="k">def</span> <span class="nf">make_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># FIXME: module and filename are not being tracked reliably</span>
        <span class="c1">#id = &#39;|&#39;.join((module, filename, name))</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">function</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">function</span></div>

<div class="viewcode-block" id="CallgrindParser.get_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.get_function">[docs]</a>    <span class="k">def</span> <span class="nf">get_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ob&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fl&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> 
        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fn&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_function</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></div>

<div class="viewcode-block" id="CallgrindParser.get_callee"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.CallgrindParser.get_callee">[docs]</a>    <span class="k">def</span> <span class="nf">get_callee</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cob&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfi&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> 
        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfn&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_function</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="OprofileParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser">[docs]</a><span class="k">class</span> <span class="nc">OprofileParser</span><span class="p">(</span><span class="n">LineParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for oprofile callgraph output.</span>
<span class="sd">    </span>
<span class="sd">    See also:</span>
<span class="sd">    - http://oprofile.sourceforge.net/doc/opreport.html#opreport-callgraph</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_fields_re</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="s1">r&#39;(\d+)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;%&#39;</span><span class="p">:</span> <span class="s1">r&#39;(\S+)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;linenr info&#39;</span><span class="p">:</span> <span class="s1">r&#39;(?P&lt;source&gt;\(no location information\)|\S+:\d+)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;image name&#39;</span><span class="p">:</span> <span class="s1">r&#39;(?P&lt;image&gt;\S+(?:\s\(tgid:[^)]*\))?)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;app name&#39;</span><span class="p">:</span> <span class="s1">r&#39;(?P&lt;application&gt;\S+)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;symbol name&#39;</span><span class="p">:</span> <span class="s1">r&#39;(?P&lt;symbol&gt;\(no symbols\)|.+?)&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="OprofileParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">):</span>
        <span class="n">LineParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_re</span> <span class="o">=</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="OprofileParser.add_entry"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.add_entry">[docs]</a>    <span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callers</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">callees</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">callers</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">callees</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">callers_total</span><span class="p">,</span> <span class="n">function_total</span><span class="p">,</span> <span class="n">callees_total</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_subentries_dict</span><span class="p">(</span><span class="n">callers_total</span><span class="p">,</span> <span class="n">callers</span><span class="p">)</span>
            <span class="n">function_total</span><span class="o">.</span><span class="n">samples</span> <span class="o">+=</span> <span class="n">function</span><span class="o">.</span><span class="n">samples</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_subentries_dict</span><span class="p">(</span><span class="n">callees_total</span><span class="p">,</span> <span class="n">callees</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="OprofileParser.update_subentries_dict"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.update_subentries_dict">[docs]</a>    <span class="k">def</span> <span class="nf">update_subentries_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">totals</span><span class="p">,</span> <span class="n">partials</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">partial</span> <span class="ow">in</span> <span class="n">partials</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">totals</span><span class="p">[</span><span class="n">partial</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">totals</span><span class="p">[</span><span class="n">partial</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total</span><span class="o">.</span><span class="n">samples</span> <span class="o">+=</span> <span class="n">partial</span><span class="o">.</span><span class="n">samples</span></div>
        
<div class="viewcode-block" id="OprofileParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># read lookahead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parse_header</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_entry</span><span class="p">()</span>

        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span>

        <span class="n">reverse_call_samples</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># populate the profile</span>
        <span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">_callers</span><span class="p">,</span> <span class="n">_function</span><span class="p">,</span> <span class="n">_callees</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">_function</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">_function</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="n">_function</span><span class="o">.</span><span class="n">samples</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_function</span><span class="o">.</span><span class="n">samples</span>

            <span class="k">if</span> <span class="n">_function</span><span class="o">.</span><span class="n">application</span><span class="p">:</span>
                <span class="n">function</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">_function</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_function</span><span class="o">.</span><span class="n">image</span><span class="p">:</span>
                <span class="n">function</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">_function</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

            <span class="n">total_callee_samples</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">_callee</span> <span class="ow">in</span> <span class="n">_callees</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="n">total_callee_samples</span> <span class="o">+=</span> <span class="n">_callee</span><span class="o">.</span><span class="n">samples</span>

            <span class="k">for</span> <span class="n">_callee</span> <span class="ow">in</span> <span class="n">_callees</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_callee</span><span class="o">.</span><span class="n">self</span><span class="p">:</span>
                    <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">_callee</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_callee</span><span class="o">.</span><span class="n">samples</span>
                    <span class="n">function</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
                
        <span class="c1"># compute derived data</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">find_cycles</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TIME_RATIO</span><span class="p">,</span> <span class="n">SAMPLES</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">call_ratios</span><span class="p">(</span><span class="n">SAMPLES2</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TIME_RATIO</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">profile</span></div>

<div class="viewcode-block" id="OprofileParser.parse_header"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.parse_header">[docs]</a>    <span class="k">def</span> <span class="nf">parse_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_header</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">r&#39;\s\s+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="n">entry_re</span> <span class="o">=</span> <span class="s1">r&#39;^\s*&#39;</span> <span class="o">+</span> <span class="s1">r&#39;\s+&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields_re</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">])</span> <span class="o">+</span> <span class="s1">r&#39;(?P&lt;self&gt;\s+\[self\])?$&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">entry_re</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_separator</span><span class="p">()</span></div>

<div class="viewcode-block" id="OprofileParser.parse_entry"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.parse_entry">[docs]</a>    <span class="k">def</span> <span class="nf">parse_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">callers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_subentries</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_primary</span><span class="p">():</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_subentry</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">callees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_subentries</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_entry</span><span class="p">(</span><span class="n">callers</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">callees</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_separator</span><span class="p">()</span></div>

<div class="viewcode-block" id="OprofileParser.parse_subentries"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.parse_subentries">[docs]</a>    <span class="k">def</span> <span class="nf">parse_subentries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subentries</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_secondary</span><span class="p">():</span>
            <span class="n">subentry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_subentry</span><span class="p">()</span>
            <span class="n">subentries</span><span class="p">[</span><span class="n">subentry</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">subentry</span>
        <span class="k">return</span> <span class="n">subentries</span></div>

<div class="viewcode-block" id="OprofileParser.parse_subentry"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.parse_subentry">[docs]</a>    <span class="k">def</span> <span class="nf">parse_subentry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;failed to parse&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;source&#39;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;(no location information)&#39;</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;application&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;symbol&#39;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;(no symbols)&#39;</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">symbol</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">symbol</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">symbol</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">entry</span><span class="o">.</span><span class="n">application</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">symbol</span><span class="p">))</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">self</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">self</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">id</span> <span class="o">+=</span> <span class="s1">&#39;:self&#39;</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">symbol</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">symbol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">image</span>
        <span class="k">return</span> <span class="n">entry</span></div>

<div class="viewcode-block" id="OprofileParser.skip_separator"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.skip_separator">[docs]</a>    <span class="k">def</span> <span class="nf">skip_separator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_separator</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span></div>

<div class="viewcode-block" id="OprofileParser.match_header"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.match_header">[docs]</a>    <span class="k">def</span> <span class="nf">match_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OprofileParser.match_separator"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.match_separator">[docs]</a>    <span class="k">def</span> <span class="nf">match_separator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="OprofileParser.match_primary"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.match_primary">[docs]</a>    <span class="k">def</span> <span class="nf">match_primary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">line</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="OprofileParser.match_secondary"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.OprofileParser.match_secondary">[docs]</a>    <span class="k">def</span> <span class="nf">match_secondary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">line</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="HProfParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.HProfParser">[docs]</a><span class="k">class</span> <span class="nc">HProfParser</span><span class="p">(</span><span class="n">LineParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for java hprof output</span>
<span class="sd">    </span>
<span class="sd">    See also:</span>
<span class="sd">    - http://java.sun.com/developer/technicalArticles/Programming/HPROF.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">trace_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;\t(.*)\((.*):(.*)\)&#39;</span><span class="p">)</span>
    <span class="n">trace_id_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;^TRACE (\d+):$&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="HProfParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.HProfParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">):</span>
        <span class="n">LineParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traces</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="HProfParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.HProfParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># read lookahead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;------&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TRACE &#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parse_traces</span><span class="p">()</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CPU&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parse_samples</span><span class="p">()</span>

        <span class="c1"># populate the profile</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span>
        <span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">functions</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># build up callgraph</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">last</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">trace</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
                    <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                    <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
                    <span class="n">functions</span><span class="p">[</span><span class="n">func</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span>

                <span class="n">function</span> <span class="o">=</span> <span class="n">functions</span><span class="p">[</span><span class="n">func</span><span class="p">]</span>
                <span class="c1"># allocate time to the deepest method in the trace</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">last</span><span class="p">:</span>
                    <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mtime</span>
                    <span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mtime</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">get_call</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
                    <span class="n">c</span><span class="p">[</span><span class="n">SAMPLES2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mtime</span>

                <span class="n">last</span> <span class="o">=</span> <span class="n">func</span>

        <span class="c1"># compute derived data</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">find_cycles</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TIME_RATIO</span><span class="p">,</span> <span class="n">SAMPLES</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">call_ratios</span><span class="p">(</span><span class="n">SAMPLES2</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TIME_RATIO</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">profile</span></div>

<div class="viewcode-block" id="HProfParser.parse_traces"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.HProfParser.parse_traces">[docs]</a>    <span class="k">def</span> <span class="nf">parse_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TRACE &#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_trace</span><span class="p">()</span></div>

<div class="viewcode-block" id="HProfParser.parse_trace"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.HProfParser.parse_trace">[docs]</a>    <span class="k">def</span> <span class="nf">parse_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_id_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">tid</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">last</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="c1">#sys.stderr.write(&#39;Invalid line: %s\n&#39; % l)</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">function_name</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                <span class="n">trace</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">function_name</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">line</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">traces</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">trace</span></div>

<div class="viewcode-block" id="HProfParser.parse_samples"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.HProfParser.parse_samples">[docs]</a>    <span class="k">def</span> <span class="nf">parse_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CPU&#39;</span><span class="p">):</span>
            <span class="n">rank</span><span class="p">,</span> <span class="n">percent_self</span><span class="p">,</span> <span class="n">percent_accum</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">traceid</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">traceid</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">),</span> <span class="n">method</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="SysprofParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SysprofParser">[docs]</a><span class="k">class</span> <span class="nc">SysprofParser</span><span class="p">(</span><span class="n">XmlParser</span><span class="p">):</span>

<div class="viewcode-block" id="SysprofParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SysprofParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="n">XmlParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span></div>

<div class="viewcode-block" id="SysprofParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SysprofParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">==</span> <span class="s1">&#39;objects&#39;</span><span class="p">:</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="n">objects</span>
                <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_items</span><span class="p">(</span><span class="s1">&#39;objects&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span><span class="p">:</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="n">nodes</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_items</span><span class="p">(</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_profile</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></div>

<div class="viewcode-block" id="SysprofParser.parse_items"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SysprofParser.parse_items">[docs]</a>    <span class="k">def</span> <span class="nf">parse_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="nb">id</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_item</span><span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">assert</span> <span class="nb">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">items</span>
            <span class="n">items</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span></div>

<div class="viewcode-block" id="SysprofParser.parse_item"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SysprofParser.parse_item">[docs]</a>    <span class="k">def</span> <span class="nf">parse_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_values</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">,</span> <span class="n">values</span></div>

<div class="viewcode-block" id="SysprofParser.parse_values"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SysprofParser.parse_values">[docs]</a>    <span class="k">def</span> <span class="nf">parse_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span>
            <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="SysprofParser.parse_value"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SysprofParser.parse_value">[docs]</a>    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="SysprofParser.build_profile"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SysprofParser.build_profile">[docs]</a>    <span class="k">def</span> <span class="nf">build_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span>
        
        <span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c1"># Ignore fake objects (process names, modules, &quot;Everything&quot;, &quot;kernel&quot;, etc.)</span>
            <span class="k">if</span> <span class="nb">object</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">object</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="nb">object</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span>

        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c1"># Ignore fake calls</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Find a non-ignored parent</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">parent_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span>
                <span class="n">caller_id</span> <span class="o">=</span> <span class="n">parent</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">objects</span><span class="p">[</span><span class="n">caller_id</span><span class="p">][</span><span class="s1">&#39;self&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">parent_id</span> <span class="o">=</span> <span class="n">parent</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">parent_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">callee_id</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>

            <span class="k">assert</span> <span class="n">objects</span><span class="p">[</span><span class="n">caller_id</span><span class="p">][</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">objects</span><span class="p">[</span><span class="n">callee_id</span><span class="p">][</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>

            <span class="n">function</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">caller_id</span><span class="p">]</span>

            <span class="n">samples</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">call</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee_id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">callee_id</span><span class="p">)</span>
                <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES2</span><span class="p">]</span> <span class="o">=</span> <span class="n">samples</span>
                <span class="n">function</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">samples</span>

        <span class="c1"># Compute derived events</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">find_cycles</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TIME_RATIO</span><span class="p">,</span> <span class="n">SAMPLES</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">call_ratios</span><span class="p">(</span><span class="n">SAMPLES2</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TIME_RATIO</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">profile</span></div></div>


<div class="viewcode-block" id="SharkParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SharkParser">[docs]</a><span class="k">class</span> <span class="nc">SharkParser</span><span class="p">(</span><span class="n">LineParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for MacOSX Shark output.</span>

<span class="sd">    Author: tom@dbservice.com</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SharkParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SharkParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">):</span>
        <span class="n">LineParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="SharkParser.add_entry"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SharkParser.add_entry">[docs]</a>    <span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="p">{</span> <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">function_total</span><span class="p">,</span> <span class="n">callees_total</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="n">function_total</span><span class="o">.</span><span class="n">samples</span> <span class="o">+=</span> <span class="n">function</span><span class="o">.</span><span class="n">samples</span></div>
    
<div class="viewcode-block" id="SharkParser.add_callee"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SharkParser.add_callee">[docs]</a>    <span class="k">def</span> <span class="nf">add_callee</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">callee</span><span class="p">):</span>
        <span class="n">func</span><span class="p">,</span> <span class="n">callees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">callees</span><span class="p">[</span><span class="n">callee</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">callees</span><span class="p">[</span><span class="n">callee</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">callee</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">samples</span> <span class="o">+=</span> <span class="n">callee</span><span class="o">.</span><span class="n">samples</span></div>
        
<div class="viewcode-block" id="SharkParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SharkParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?P&lt;prefix&gt;[|+ ]*)(?P&lt;samples&gt;\d+), (?P&lt;symbol&gt;[^,]+), (?P&lt;image&gt;.*)&#39;</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookahead</span><span class="p">():</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">()</span>
            <span class="n">mo</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;failed to parse&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

            <span class="n">fields</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">symbol</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">image</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">()</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">symbol</span><span class="p">,</span> <span class="n">image</span><span class="p">])</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">symbol</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>

            <span class="c1"># adjust the callstack</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">prefix</span><span class="p">:]</span>

            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

            <span class="c1"># if the callstack has had an entry, it&#39;s this functions caller</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_callee</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">prefix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">entry</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">add_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                
        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span>
        <span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">_function</span><span class="p">,</span> <span class="n">_callees</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">_function</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">_function</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="n">_function</span><span class="o">.</span><span class="n">samples</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_function</span><span class="o">.</span><span class="n">samples</span>

            <span class="k">if</span> <span class="n">_function</span><span class="o">.</span><span class="n">image</span><span class="p">:</span>
                <span class="n">function</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">_function</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_callee</span> <span class="ow">in</span> <span class="n">_callees</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">_callee</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="n">_callee</span><span class="o">.</span><span class="n">samples</span>
                <span class="n">function</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
                
        <span class="c1"># compute derived data</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">find_cycles</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TIME_RATIO</span><span class="p">,</span> <span class="n">SAMPLES</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">call_ratios</span><span class="p">(</span><span class="n">SAMPLES</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TIME_RATIO</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">profile</span></div></div>


<div class="viewcode-block" id="XPerfParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XPerfParser">[docs]</a><span class="k">class</span> <span class="nc">XPerfParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for CSVs generted by XPerf, from Microsoft Windows Performance Tools.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="XPerfParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XPerfParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="n">Parser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="XPerfParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XPerfParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">csv</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">,</span> 
            <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span>
            <span class="n">quotechar</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
            <span class="n">escapechar</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
            <span class="n">doublequote</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
            <span class="n">skipinitialspace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
            <span class="n">lineterminator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">quoting</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span><span class="p">)</span>
        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_header</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                
        <span class="c1"># compute derived data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">find_cycles</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TIME_RATIO</span><span class="p">,</span> <span class="n">SAMPLES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">call_ratios</span><span class="p">(</span><span class="n">SAMPLES2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TIME_RATIO</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span></div>

<div class="viewcode-block" id="XPerfParser.parse_header"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XPerfParser.parse_header">[docs]</a>    <span class="k">def</span> <span class="nf">parse_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span></div>

<div class="viewcode-block" id="XPerfParser.parse_row"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XPerfParser.parse_row">[docs]</a>    <span class="k">def</span> <span class="nf">parse_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">factory</span> <span class="ow">in</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        
        <span class="n">process</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Process Name&#39;</span><span class="p">]</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Module&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span> <span class="o">+</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Function&#39;</span><span class="p">]</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Count&#39;</span><span class="p">]</span>

        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
        <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">count</span>

        <span class="n">stack</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Stack&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">stack</span> <span class="o">!=</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;[Root]&#39;</span>
            <span class="k">if</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">symbol</span><span class="p">:</span>
                <span class="c1"># XXX: some cases the sampled function does not appear in the stack</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
            <span class="n">caller</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">caller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">call</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">callee</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES2</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
                        <span class="n">caller</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">count</span>
                <span class="n">caller</span> <span class="o">=</span> <span class="n">callee</span></div>

<div class="viewcode-block" id="XPerfParser.get_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.XPerfParser.get_function">[docs]</a>    <span class="k">def</span> <span class="nf">get_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>
        <span class="n">function_id</span> <span class="o">=</span> <span class="n">process</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span> <span class="o">+</span> <span class="n">symbol</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">function_id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">module</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">function_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">function</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">process</span>
            <span class="n">function</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>
            <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">function</span></div></div>


<div class="viewcode-block" id="SleepyParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SleepyParser">[docs]</a><span class="k">class</span> <span class="nc">SleepyParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for GNU gprof output.</span>

<span class="sd">    See also:</span>
<span class="sd">    - http://www.codersnotes.com/sleepy/</span>
<span class="sd">    - http://sleepygraph.sourceforge.net/</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SleepyParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SleepyParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">Parser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calls</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span></div>
    
    <span class="n">_symbol_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s1">r&#39;^(?P&lt;id&gt;\w+)&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+&quot;(?P&lt;module&gt;[^&quot;]*)&quot;&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+&quot;(?P&lt;procname&gt;[^&quot;]*)&quot;&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+&quot;(?P&lt;sourcefile&gt;[^&quot;]*)&quot;&#39;</span> <span class="o">+</span> 
        <span class="s1">r&#39;\s+(?P&lt;sourceline&gt;\d+)$&#39;</span>
    <span class="p">)</span>

<div class="viewcode-block" id="SleepyParser.parse_symbols"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SleepyParser.parse_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">parse_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;symbols.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symbol_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mo</span><span class="p">:</span>
                <span class="n">symbol_id</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">procname</span><span class="p">,</span> <span class="n">sourcefile</span><span class="p">,</span> <span class="n">sourceline</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    
                <span class="n">function_id</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">module</span><span class="p">,</span> <span class="n">procname</span><span class="p">])</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">function_id</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">function_id</span><span class="p">,</span> <span class="n">procname</span><span class="p">)</span>
                    <span class="n">function</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>
                    <span class="n">function</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span></div>

<div class="viewcode-block" id="SleepyParser.parse_callstacks"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SleepyParser.parse_callstacks">[docs]</a>    <span class="k">def</span> <span class="nf">parse_callstacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;callstacks.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">callstack</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="n">callstack</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">symbol_id</span> <span class="ow">in</span> <span class="n">callstack</span><span class="p">]</span>

            <span class="n">callee</span> <span class="o">=</span> <span class="n">callstack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">callee</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">samples</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">+=</span> <span class="n">samples</span>
            
            <span class="k">for</span> <span class="n">caller</span> <span class="ow">in</span> <span class="n">callstack</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">call</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="n">callee</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">callee</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES2</span><span class="p">]</span> <span class="o">=</span> <span class="n">samples</span>
                    <span class="n">caller</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">call</span><span class="p">[</span><span class="n">SAMPLES2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">samples</span>

                <span class="n">callee</span> <span class="o">=</span> <span class="n">caller</span></div>

<div class="viewcode-block" id="SleepyParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.SleepyParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">profile</span><span class="p">[</span><span class="n">SAMPLES</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parse_symbols</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_callstacks</span><span class="p">()</span>

        <span class="c1"># Compute derived events</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">find_cycles</span><span class="p">()</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TIME_RATIO</span><span class="p">,</span> <span class="n">SAMPLES</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">call_ratios</span><span class="p">(</span><span class="n">SAMPLES2</span><span class="p">)</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TIME_RATIO</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">profile</span></div></div>


<div class="viewcode-block" id="AQtimeTable"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeTable">[docs]</a><span class="k">class</span> <span class="nc">AQtimeTable</span><span class="p">:</span>

<div class="viewcode-block" id="AQtimeTable.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeTable.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_column</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field_column</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="n">column</span><span class="p">]]</span> <span class="o">=</span> <span class="n">column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="AQtimeTable.__len__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeTable.__len__">[docs]</a>    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span></div>

<div class="viewcode-block" id="AQtimeTable.__iter__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeTable.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">values</span><span class="p">,</span> <span class="n">children</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">children</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
            <span class="k">yield</span> <span class="n">fields</span><span class="p">,</span> <span class="n">children</span>
        <span class="k">raise</span> <span class="ne">StopIteration</span></div>

<div class="viewcode-block" id="AQtimeTable.add_row"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeTable.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">values</span><span class="p">,</span> <span class="n">children</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="AQtimeParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser">[docs]</a><span class="k">class</span> <span class="nc">AQtimeParser</span><span class="p">(</span><span class="n">XmlParser</span><span class="p">):</span>

<div class="viewcode-block" id="AQtimeParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="n">XmlParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="AQtimeParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;AQtime_Results&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_headers</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_results</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;AQtime_Results&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_profile</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> </div>

<div class="viewcode-block" id="AQtimeParser.parse_headers"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.parse_headers">[docs]</a>    <span class="k">def</span> <span class="nf">parse_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;HEADERS&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_table_header</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;HEADERS&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AQtimeParser.parse_table_header"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.parse_table_header">[docs]</a>    <span class="k">def</span> <span class="nf">parse_table_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;TABLE_HEADER&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span>
        <span class="n">field_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">field_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="n">field_type</span><span class="p">,</span> <span class="n">field_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_table_field</span><span class="p">()</span>
            <span class="n">field_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span>
            <span class="n">field_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;TABLE_HEADER&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="n">field_names</span></div>

<div class="viewcode-block" id="AQtimeParser.parse_table_field"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.parse_table_field">[docs]</a>    <span class="k">def</span> <span class="nf">parse_table_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;TABLE_FIELD&#39;</span><span class="p">)</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;TABLE_FIELD&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span></div>

<div class="viewcode-block" id="AQtimeParser.parse_results"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.parse_results">[docs]</a>    <span class="k">def</span> <span class="nf">parse_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;RESULTS&#39;</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;RESULTS&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table</span></div>

<div class="viewcode-block" id="AQtimeParser.parse_data"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.parse_data">[docs]</a>    <span class="k">def</span> <span class="nf">parse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;DATA&#39;</span><span class="p">)</span>
        <span class="n">table_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;TABLE_ID&#39;</span><span class="p">])</span>
        <span class="n">table_name</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="n">field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_id</span><span class="p">]</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">AQtimeTable</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">field_names</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_row</span><span class="p">(</span><span class="n">field_types</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;DATA&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table</span></div>

<div class="viewcode-block" id="AQtimeParser.parse_row"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.parse_row">[docs]</a>    <span class="k">def</span> <span class="nf">parse_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_types</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">field_types</span><span class="p">)</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;ROW&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">==</span> <span class="s1">&#39;FIELD&#39;</span><span class="p">:</span>
                <span class="n">field_id</span><span class="p">,</span> <span class="n">field_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_field</span><span class="p">(</span><span class="n">field_types</span><span class="p">)</span>
                <span class="n">row</span><span class="p">[</span><span class="n">field_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_value</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">name_or_data</span> <span class="o">==</span> <span class="s1">&#39;CHILDREN&#39;</span><span class="p">:</span>
                <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_children</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">XmlTokenMismatch</span><span class="p">(</span><span class="s2">&quot;&lt;FIELD ...&gt; or &lt;CHILDREN ...&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;ROW&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row</span><span class="p">,</span> <span class="n">children</span></div>

<div class="viewcode-block" id="AQtimeParser.parse_field"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.parse_field">[docs]</a>    <span class="k">def</span> <span class="nf">parse_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_types</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;FIELD&#39;</span><span class="p">)</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="n">field_types</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;Integer&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;Float&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;Address&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;String&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;FIELD&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">,</span> <span class="n">value</span></div>

<div class="viewcode-block" id="AQtimeParser.parse_children"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.parse_children">[docs]</a>    <span class="k">def</span> <span class="nf">parse_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_start</span><span class="p">(</span><span class="s1">&#39;CHILDREN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">XML_ELEMENT_START</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_data</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">children</span>
            <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_end</span><span class="p">(</span><span class="s1">&#39;CHILDREN&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">children</span></div>

<div class="viewcode-block" id="AQtimeParser.build_profile"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.build_profile">[docs]</a>    <span class="k">def</span> <span class="nf">build_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">results</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Routines&#39;</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span>
        <span class="n">profile</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_function</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="s1">&#39;Children&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">fields</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_call</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
                <span class="n">function</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="n">profile</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">+</span> <span class="n">function</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span>
        <span class="n">profile</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TOTAL_TIME</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">profile</span></div>
    
<div class="viewcode-block" id="AQtimeParser.build_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.build_function">[docs]</a>    <span class="k">def</span> <span class="nf">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_id</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_name</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
        <span class="n">function</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
        <span class="n">function</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Time with Children&#39;</span><span class="p">]</span>
        <span class="c1">#function[TIME_RATIO] = fields[&#39;% Time&#39;]/100.0</span>
        <span class="c1">#function[TOTAL_TIME_RATIO] = fields[&#39;% with Children&#39;]/100.0</span>
        <span class="k">return</span> <span class="n">function</span></div>

<div class="viewcode-block" id="AQtimeParser.build_call"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.build_call">[docs]</a>    <span class="k">def</span> <span class="nf">build_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_id</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
        <span class="n">call</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
        <span class="n">call</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Time with Children&#39;</span><span class="p">]</span>
        <span class="c1">#call[TIME_RATIO] = fields[&#39;% Time&#39;]/100.0</span>
        <span class="c1">#call[TOTAL_TIME_RATIO] = fields[&#39;% with Children&#39;]/100.0</span>
        <span class="k">return</span> <span class="n">call</span></div>

<div class="viewcode-block" id="AQtimeParser.build_id"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.build_id">[docs]</a>    <span class="k">def</span> <span class="nf">build_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Module Name&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Unit Name&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Routine Name&#39;</span><span class="p">]])</span></div>

<div class="viewcode-block" id="AQtimeParser.build_name"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.AQtimeParser.build_name">[docs]</a>    <span class="k">def</span> <span class="nf">build_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="c1"># TODO: use more fields</span>
        <span class="k">return</span> <span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Routine Name&#39;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="PstatsParser"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.PstatsParser">[docs]</a><span class="k">class</span> <span class="nc">PstatsParser</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Parser python profiling statistics saved with te pstats module.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PstatsParser.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.PstatsParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">filename</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">pstats</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pstats</span><span class="o">.</span><span class="n">Stats</span><span class="p">(</span><span class="o">*</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">hotshot.stats</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">hotshot</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_ids</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="PstatsParser.get_function_name"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.PstatsParser.get_function_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_function_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="PstatsParser.get_function"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.PstatsParser.get_function">[docs]</a>    <span class="k">def</span> <span class="nf">get_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_ids</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_ids</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function_name</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_ids</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">function</span></div>

<div class="viewcode-block" id="PstatsParser.parse"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.PstatsParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">total_tt</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">callers</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">callee</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="n">nc</span>
            <span class="n">callee</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">ct</span>
            <span class="n">callee</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">tt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">TIME</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">],</span> <span class="n">ct</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">callers</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                <span class="n">call</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="n">callee</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="mi">4</span><span class="p">):</span>
                        <span class="n">nc</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">CALLS</span> <span class="ow">in</span> <span class="n">call</span><span class="p">:</span>
                            <span class="n">call</span><span class="p">[</span><span class="n">CALLS</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cc</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">call</span><span class="p">[</span><span class="n">CALLS</span><span class="p">]</span> <span class="o">=</span> <span class="n">cc</span>

                        <span class="k">if</span> <span class="n">TOTAL_TIME</span> <span class="ow">in</span> <span class="n">call</span><span class="p">:</span>
                            <span class="n">call</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ct</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">call</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">ct</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">call</span><span class="p">[</span><span class="n">CALLS</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">call</span><span class="p">[</span><span class="n">TOTAL_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span><span class="o">*</span><span class="n">ct</span>

                <span class="n">caller</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
        <span class="c1">#self.stats.print_stats()</span>
        <span class="c1">#self.stats.print_callees()</span>

        <span class="c1"># Compute derived events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TIME_RATIO</span><span class="p">,</span> <span class="n">TIME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TOTAL_TIME</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span></div></div>


<div class="viewcode-block" id="Theme"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme">[docs]</a><span class="k">class</span> <span class="nc">Theme</span><span class="p">:</span>

<div class="viewcode-block" id="Theme.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">mincolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="n">maxcolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">fontname</span> <span class="o">=</span> <span class="s2">&quot;Arial&quot;</span><span class="p">,</span>
            <span class="n">minfontsize</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
            <span class="n">maxfontsize</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
            <span class="n">minpenwidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="n">maxpenwidth</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="mf">2.2</span><span class="p">,</span>
            <span class="n">skew</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span> <span class="o">=</span> <span class="n">bgcolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mincolor</span> <span class="o">=</span> <span class="n">mincolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxcolor</span> <span class="o">=</span> <span class="n">maxcolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontname</span> <span class="o">=</span> <span class="n">fontname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minfontsize</span> <span class="o">=</span> <span class="n">minfontsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfontsize</span> <span class="o">=</span> <span class="n">maxfontsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minpenwidth</span> <span class="o">=</span> <span class="n">minpenwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxpenwidth</span> <span class="o">=</span> <span class="n">maxpenwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skew</span> <span class="o">=</span> <span class="n">skew</span></div>

<div class="viewcode-block" id="Theme.graph_bgcolor"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.graph_bgcolor">[docs]</a>    <span class="k">def</span> <span class="nf">graph_bgcolor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_to_rgb</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theme.graph_fontname"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.graph_fontname">[docs]</a>    <span class="k">def</span> <span class="nf">graph_fontname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontname</span></div>

<div class="viewcode-block" id="Theme.graph_fontsize"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.graph_fontsize">[docs]</a>    <span class="k">def</span> <span class="nf">graph_fontsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minfontsize</span></div>

<div class="viewcode-block" id="Theme.node_bgcolor"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.node_bgcolor">[docs]</a>    <span class="k">def</span> <span class="nf">node_bgcolor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theme.node_fgcolor"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.node_fgcolor">[docs]</a>    <span class="k">def</span> <span class="nf">node_fgcolor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_bgcolor</span><span class="p">()</span></div>

<div class="viewcode-block" id="Theme.node_fontsize"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.node_fontsize">[docs]</a>    <span class="k">def</span> <span class="nf">node_fontsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theme.edge_color"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.edge_color">[docs]</a>    <span class="k">def</span> <span class="nf">edge_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theme.edge_fontsize"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.edge_fontsize">[docs]</a>    <span class="k">def</span> <span class="nf">edge_fontsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theme.edge_penwidth"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.edge_penwidth">[docs]</a>    <span class="k">def</span> <span class="nf">edge_penwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">maxpenwidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minpenwidth</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theme.edge_arrowsize"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.edge_arrowsize">[docs]</a>    <span class="k">def</span> <span class="nf">edge_arrowsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_penwidth</span><span class="p">(</span><span class="n">weight</span><span class="p">))</span></div>

<div class="viewcode-block" id="Theme.fontsize"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.fontsize">[docs]</a>    <span class="k">def</span> <span class="nf">fontsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">weight</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxfontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minfontsize</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theme.color"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.color">[docs]</a>    <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
    
        <span class="n">hmin</span><span class="p">,</span> <span class="n">smin</span><span class="p">,</span> <span class="n">lmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mincolor</span>
        <span class="n">hmax</span><span class="p">,</span> <span class="n">smax</span><span class="p">,</span> <span class="n">lmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxcolor</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skew</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skew must be greater than 0&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">skew</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">hmin</span> <span class="o">+</span> <span class="n">weight</span><span class="o">*</span><span class="p">(</span><span class="n">hmax</span> <span class="o">-</span> <span class="n">hmin</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">smin</span> <span class="o">+</span> <span class="n">weight</span><span class="o">*</span><span class="p">(</span><span class="n">smax</span> <span class="o">-</span> <span class="n">smin</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">lmin</span> <span class="o">+</span> <span class="n">weight</span><span class="o">*</span><span class="p">(</span><span class="n">lmax</span> <span class="o">-</span> <span class="n">lmin</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skew</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">hmin</span> <span class="o">+</span> <span class="p">((</span><span class="n">hmax</span><span class="o">-</span><span class="n">hmin</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">base</span> <span class="o">**</span> <span class="n">weight</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">smin</span> <span class="o">+</span> <span class="p">((</span><span class="n">smax</span><span class="o">-</span><span class="n">smin</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">base</span> <span class="o">**</span> <span class="n">weight</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">lmin</span> <span class="o">+</span> <span class="p">((</span><span class="n">lmax</span><span class="o">-</span><span class="n">lmin</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">base</span> <span class="o">**</span> <span class="n">weight</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_to_rgb</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theme.hsl_to_rgb"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme.hsl_to_rgb">[docs]</a>    <span class="k">def</span> <span class="nf">hsl_to_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a color from HSL color-model to RGB.</span>

<span class="sd">        See also:</span>
<span class="sd">        - http://www.w3.org/TR/css3-color/#hsl-color</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">%</span> <span class="mf">1.0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">l</span><span class="o">*</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">s</span> <span class="o">-</span> <span class="n">l</span><span class="o">*</span><span class="n">s</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">l</span><span class="o">*</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">m2</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hue_to_rgb</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hue_to_rgb</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hue_to_rgb</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>

        <span class="c1"># Apply gamma correction</span>
        <span class="n">r</span> <span class="o">**=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
        <span class="n">g</span> <span class="o">**=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
        <span class="n">b</span> <span class="o">**=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theme._hue_to_rgb"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Theme._hue_to_rgb">[docs]</a>    <span class="k">def</span> <span class="nf">_hue_to_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">+=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">-=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">h</span><span class="o">*</span><span class="mi">6</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">m1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="mf">6.0</span>
        <span class="k">elif</span> <span class="n">h</span><span class="o">*</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">m2</span>
        <span class="k">elif</span> <span class="n">h</span><span class="o">*</span><span class="mi">3</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">m1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="mf">6.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">m1</span></div></div>


<span class="n">TEMPERATURE_COLORMAP</span> <span class="o">=</span> <span class="n">Theme</span><span class="p">(</span>
    <span class="n">mincolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="c1"># dark blue</span>
    <span class="n">maxcolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="c1"># satured red</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="p">)</span>

<span class="n">PINK_COLORMAP</span> <span class="o">=</span> <span class="n">Theme</span><span class="p">(</span>
    <span class="n">mincolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">),</span> <span class="c1"># pink</span>
    <span class="n">maxcolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="c1"># satured red</span>
<span class="p">)</span>

<span class="n">GRAY_COLORMAP</span> <span class="o">=</span> <span class="n">Theme</span><span class="p">(</span>
    <span class="n">mincolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">),</span> <span class="c1"># light gray</span>
    <span class="n">maxcolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="c1"># black</span>
<span class="p">)</span>

<span class="n">BW_COLORMAP</span> <span class="o">=</span> <span class="n">Theme</span><span class="p">(</span>
    <span class="n">minfontsize</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
    <span class="n">maxfontsize</span> <span class="o">=</span> <span class="mf">24.0</span><span class="p">,</span>
    <span class="n">mincolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="c1"># black</span>
    <span class="n">maxcolor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="c1"># black</span>
    <span class="n">minpenwidth</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">maxpenwidth</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="DotWriter"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter">[docs]</a><span class="k">class</span> <span class="nc">DotWriter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Writer for the DOT language.</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        - &quot;The DOT Language&quot; specification</span>
<span class="sd">          http://www.graphviz.org/doc/info/lang.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DotWriter.__init__"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span></div>

<div class="viewcode-block" id="DotWriter.graph"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.graph">[docs]</a>    <span class="k">def</span> <span class="nf">graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">theme</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">begin_graph</span><span class="p">()</span>

        <span class="n">fontname</span> <span class="o">=</span> <span class="n">theme</span><span class="o">.</span><span class="n">graph_fontname</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="n">fontname</span><span class="p">,</span> <span class="n">ranksep</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">nodesep</span><span class="o">=</span><span class="mf">0.125</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="n">fontname</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;filled&quot;</span><span class="p">,</span> <span class="n">fontcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="n">fontname</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">TIME_RATIO</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">function</span><span class="p">[</span><span class="n">event</span><span class="p">])</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">called</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">u&quot;</span><span class="si">%u</span><span class="se">\xd7</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">called</span><span class="p">,))</span>

            <span class="k">if</span> <span class="n">function</span><span class="o">.</span><span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">weight</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> 
                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span> 
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">node_bgcolor</span><span class="p">(</span><span class="n">weight</span><span class="p">)),</span> 
                <span class="n">fontcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">node_fgcolor</span><span class="p">(</span><span class="n">weight</span><span class="p">)),</span> 
                <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">theme</span><span class="o">.</span><span class="n">node_fontsize</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="n">callee</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">]</span>

                <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">TOTAL_TIME_RATIO</span><span class="p">,</span> <span class="n">CALLS</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">call</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">call</span><span class="p">[</span><span class="n">event</span><span class="p">])</span>
                        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">weight</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">weight</span>
                <span class="k">elif</span> <span class="n">callee</span><span class="o">.</span><span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">weight</span> <span class="o">=</span> <span class="n">callee</span><span class="o">.</span><span class="n">weight</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.0</span>

                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">call</span><span class="o">.</span><span class="n">callee_id</span><span class="p">,</span> 
                    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span> 
                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">edge_color</span><span class="p">(</span><span class="n">weight</span><span class="p">)),</span> 
                    <span class="n">fontcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">edge_color</span><span class="p">(</span><span class="n">weight</span><span class="p">)),</span>
                    <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">theme</span><span class="o">.</span><span class="n">edge_fontsize</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span> 
                    <span class="n">penwidth</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">theme</span><span class="o">.</span><span class="n">edge_penwidth</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span> 
                    <span class="n">labeldistance</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">theme</span><span class="o">.</span><span class="n">edge_penwidth</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span> 
                    <span class="n">arrowsize</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">theme</span><span class="o">.</span><span class="n">edge_arrowsize</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_graph</span><span class="p">()</span></div>

<div class="viewcode-block" id="DotWriter.begin_graph"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.begin_graph">[docs]</a>    <span class="k">def</span> <span class="nf">begin_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;digraph {</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DotWriter.end_graph"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.end_graph">[docs]</a>    <span class="k">def</span> <span class="nf">end_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DotWriter.attr"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.attr">[docs]</a>    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr_list</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DotWriter.node"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.node">[docs]</a>    <span class="k">def</span> <span class="nf">node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr_list</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DotWriter.edge"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.edge">[docs]</a>    <span class="k">def</span> <span class="nf">edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; -&gt; &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr_list</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DotWriter.attr_list"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.attr_list">[docs]</a>    <span class="k">def</span> <span class="nf">attr_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; [&#39;</span><span class="p">)</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DotWriter.id"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.id">[docs]</a>    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">id</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">id</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;0x&#39;</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="DotWriter.color"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.color">[docs]</a>    <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)):</span>

        <span class="k">def</span> <span class="nf">float2int</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">255</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="mf">255.0</span><span class="o">*</span><span class="n">f</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">float2int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)])</span></div>

<div class="viewcode-block" id="DotWriter.escape"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.escape">[docs]</a>    <span class="k">def</span> <span class="nf">escape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">r&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">r&#39;\n&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">r&#39;\t&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">r&#39;\&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span></div>

<div class="viewcode-block" id="DotWriter.write"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.DotWriter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Main"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Main">[docs]</a><span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Main program.&quot;&quot;&quot;</span>

    <span class="n">themes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">TEMPERATURE_COLORMAP</span><span class="p">,</span>
            <span class="s2">&quot;pink&quot;</span><span class="p">:</span> <span class="n">PINK_COLORMAP</span><span class="p">,</span>
            <span class="s2">&quot;gray&quot;</span><span class="p">:</span> <span class="n">GRAY_COLORMAP</span><span class="p">,</span>
            <span class="s2">&quot;bw&quot;</span><span class="p">:</span> <span class="n">BW_COLORMAP</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Main.main"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Main.main">[docs]</a>    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Main program.&quot;&quot;&quot;</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span>
            <span class="n">usage</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">%prog [options] [file] ...&quot;</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%%</span><span class="s2">prog </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__version__</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FILE&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;output filename [stdout]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--node-thres&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PERCENTAGE&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;node_thres&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;eliminate nodes below this threshold [default: </span><span class="si">%d</span><span class="s2">efault]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;--edge-thres&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PERCENTAGE&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;edge_thres&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;eliminate edges below this threshold [default: </span><span class="si">%d</span><span class="s2">efault]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--format&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;choice&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;prof&#39;</span><span class="p">,</span> <span class="s1">&#39;callgrind&#39;</span><span class="p">,</span> <span class="s1">&#39;oprofile&#39;</span><span class="p">,</span> <span class="s1">&#39;hprof&#39;</span><span class="p">,</span> <span class="s1">&#39;sysprof&#39;</span><span class="p">,</span> <span class="s1">&#39;pstats&#39;</span><span class="p">,</span> <span class="s1">&#39;shark&#39;</span><span class="p">,</span> <span class="s1">&#39;sleepy&#39;</span><span class="p">,</span> <span class="s1">&#39;aqtime&#39;</span><span class="p">,</span> <span class="s1">&#39;xperf&#39;</span><span class="p">),</span>
            <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;prof&quot;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;profile format: prof, callgrind, oprofile, hprof, sysprof, shark, sleepy, aqtime, pstats, or xperf [default: </span><span class="si">%d</span><span class="s2">efault]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--colormap&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;choice&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;bw&#39;</span><span class="p">),</span>
            <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;theme&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;color map: color, pink, gray, or bw [default: </span><span class="si">%d</span><span class="s2">efault]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="s1">&#39;--strip&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;strip&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;strip function parameters, template parameters, and const modifiers from demangled C++ function names&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-w&#39;</span><span class="p">,</span> <span class="s1">&#39;--wrap&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;wrap function names&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--restrict&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;restrict_string&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;eliminate functions that do not contain this string in their pathname [default: None]&quot;</span><span class="p">)</span>
        <span class="c1"># add a new option to control skew of the colorization curve</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;--skew&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;theme_skew&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;skew the colorization curve.  Values &lt; 1.0 give more variety to lower percentages.  Value &gt; 1.0 give less variety to lower percentages&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">!=</span> <span class="s1">&#39;pstats&#39;</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;incorrect number of arguments&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">themes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">theme</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;invalid colormap </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">theme</span><span class="p">)</span>
        
        <span class="c1"># set skew on the theme now that it has been picked.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">theme_skew</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">skew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">theme_skew</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;prof&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">GprofParser</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;callgrind&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">CallgrindParser</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;oprofile&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">OprofileParser</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;sysprof&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">SysprofParser</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;hprof&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">HProfParser</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;pstats&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;at least a file must be specified for pstats input&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">PstatsParser</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;xperf&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">XPerfParser</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;shark&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">SharkParser</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;sleepy&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;exactly one file must be specified for sleepy input&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">SleepyParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;aqtime&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">AQtimeParser</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;invalid format </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_graph</span><span class="p">()</span></div>

    <span class="n">_parenthesis_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;\([^()]*\)&#39;</span><span class="p">)</span>
    <span class="n">_angles_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;&lt;[^&lt;&gt;]*&gt;&#39;</span><span class="p">)</span>
    <span class="n">_const_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;\s+const$&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Main.strip_function_name"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Main.strip_function_name">[docs]</a>    <span class="k">def</span> <span class="nf">strip_function_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove extraneous information from C++ demangled function names.&quot;&quot;&quot;</span>

        <span class="c1"># Strip function parameters from name by recursively removing paired parenthesis</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parenthesis_re</span><span class="o">.</span><span class="n">subn</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Strip const qualifier</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_const_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1"># Strip template parameters from name by recursively removing paired angles</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles_re</span><span class="o">.</span><span class="n">subn</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Main.wrap_function_name"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Main.wrap_function_name">[docs]</a>    <span class="k">def</span> <span class="nf">wrap_function_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Split the function name on multiple lines.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">/</span><span class="n">height</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
            <span class="c1"># TODO: break lines in symbols</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">break_long_words</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="c1"># Take away spaces</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&gt; &gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&gt; &gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">)</span> <span class="c1"># catch consecutive</span>

        <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Main.compress_function_name"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Main.compress_function_name">[docs]</a>    <span class="k">def</span> <span class="nf">compress_function_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compress function name according to the user preferences.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">strip</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip_function_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">wrap</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_function_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># TODO: merge functions with same resulting name</span>

        <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Main.write_graph"><a class="viewcode-back" href="../../../api/generated/pySPACE.tools.gprof2dot.html#pySPACE.tools.gprof2dot.Main.write_graph">[docs]</a>    <span class="k">def</span> <span class="nf">write_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dot</span> <span class="o">=</span> <span class="n">DotWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">node_thres</span><span class="o">/</span><span class="mf">100.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">edge_thres</span><span class="o">/</span><span class="mf">100.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">restrict_string</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">function</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_function_name</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">dot</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">Main</span><span class="p">()</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pySPACE documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, pySPACE Developer Team.
      Last updated on Sep 04, 2016.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.2.
    </div>
  </body>
</html>